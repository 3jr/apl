<!DOCTYPE html>  <html> <head>   <title>vocabulary.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="apl.html">                 apl.coffee               </a>                                           <a class="source" href="browser.html">                 browser.coffee               </a>                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="compiler.html">                 compiler.coffee               </a>                                           <a class="source" href="complex.html">                 complex.coffee               </a>                                           <a class="source" href="formatter.html">                 formatter.coffee               </a>                                           <a class="source" href="helpers.html">                 helpers.coffee               </a>                                           <a class="source" href="lexer.html">                 lexer.coffee               </a>                                           <a class="source" href="parser.html">                 parser.coffee               </a>                                           <a class="source" href="vocabulary.html">                 vocabulary.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               vocabulary.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><code>vocabulary.coffee</code> is our big mama implementation of APL's built-in verbs,
adverbs, conjunctions, and pronouns, with a propensity to grow morbidly
obese.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>JavaScript representation of APL arrays</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>APL's data structures are multidimensional arrays:</p>

<ul>
<li><p>(rank 0) Scalars—they can be:</p>

<ul><li><p>simple scalars, like numbers and characters</p></li>
<li><p>a <em>boxed</em> APL array of rank zero, containing exactly one element</p></li></ul></li>
<li><p>(rank 1) Vectors—sequences of APL objects with zero or more elements</p></li>
<li><p>(rank 2) Matrices—two-dimensional arrays of APL objects</p></li>
<li><p>(rank 3+) Cubes, tesseracts, and higher-delusional stuff.</p></li>
</ul>

<p>APL arrays are not necessarily homogenous, they may contain data of mixed
types.</p>

<p>An array in APL is aware of its own dimensions, so there is an essential
difference between a vector of vectors and a matrix.  To reflect this in
JavaScript objects, we use the following convention:</p>

<ul>
<li><p>APL scalars:</p>

<ul><li><p>Simple scalars: APL numbers are JavaScript numbers and APL characters
are JavaScript one-character strings.</p></li>
<li><p>A rank-zero APL array is a JavaScript array of size one with a
<code>shape</code> property of <code>[]</code>, e.g. created by:</p>

<pre><code>  var a = [123]; a.shape = [];
</code></pre></li></ul></li>
<li><p>An APL vector is a JavaScript array.</p></li>
<li><p>An APL matrix, cube, etc is a JavaScript array with an additional <code>shape</code>
property, describing the dimensions of the APL array.  E.g. a 2-by-2-by-3
cube of zeroes may be constructed via:</p>

<pre><code>  function createSomeCube() {
      var cube = [
          0, // Element at indices [0;0;0]
          0, // Element at indices [0;0;1]
          // ... indices iterated in lexicographic order ...
          0  // Element at indices [1;1;2]
      ];
      cube.shape = [2, 2, 3];
      return cube;
  }
</code></pre>

<p>A vector's representation, as opposed to that of higher-dimensional
arrays, is not required to have a <code>shape</code> property.  The shape of a
vector <code>v</code> is assumed to be <code>[v.length]</code> by convention.  Similarly, we
could say that a scalar's shape is <code>[]</code> by convention.</p></li>
</ul>

<h2>APL prototypes</h2>

<p>Every object in APL, including empty arrays, has an <em>prototype</em>, used
whenever "padding material" is needed, such as in the <em>take</em> verb:</p>

<pre><code>5 ↑ 1 2 3     ⍝ returns      1 2 3 0 0
5 ↑ 'abc'     ⍝ returns      'abc  '
</code></pre>

<p>Prototypes are defined recursively:</p>

<ul>
<li><p>For numbers, the prototype is <code>0</code>.</p></li>
<li><p>For characters, the prototype is a space, <code>' '</code>.</p></li>
<li><p>For non-empty arrays, the prototype is the prototype of the first
element, repeated and arranged to fit the first element's shape.  E.g. the
prototype of <code>((1 2) 'a' (1 2 3))</code> is <code>(0 0)</code>.</p></li>
<li><p>For empty arrays, the prototype is determined by the operation used to
construct the array.  Usually it is copied from another array.</p></li>
</ul>

<p>To represent this in JavaScript, we simply use the first elements of arrays
and calculate it dynamically.  For empty arrays, we put an additional
<code>aplPrototype</code> property on the array, like so:</p>

<pre><code>var a = [];
a.aplPrototype = ' ';

var b = [];
b.aplPrototype = [0, 0, 0, 0];
b.aplPrototype.shape = [2, 2];
</code></pre>

<p>If an empty array has a prototype of <code>0</code>, we can skip <code>aplPrototype</code> and
leave <code>0</code> as an implicit default.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">{</span><span class="nx">assert</span><span class="p">,</span> <span class="nx">die</span><span class="p">,</span> <span class="nx">inherit</span><span class="p">,</span> <span class="nx">isSimple</span><span class="p">,</span> <span class="nx">shapeOf</span><span class="p">,</span> <span class="nx">withShape</span><span class="p">,</span> <span class="nx">prod</span><span class="p">,</span> <span class="nx">prototypeOf</span><span class="p">,</span>
  <span class="nx">withPrototype</span><span class="p">,</span> <span class="nx">withPrototypeCopiedFrom</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s">&#39;./helpers&#39;</span>
<span class="p">{</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">,</span> <span class="nx">floor</span><span class="p">,</span> <span class="nx">ceil</span><span class="p">,</span> <span class="nx">round</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">random</span><span class="p">,</span> <span class="nx">exp</span><span class="p">,</span> <span class="nx">pow</span><span class="p">,</span> <span class="nx">log</span><span class="p">,</span> <span class="nx">PI</span><span class="p">,</span> <span class="nx">sqrt</span><span class="p">,</span> <span class="nx">sin</span><span class="p">,</span>
  <span class="nx">cos</span><span class="p">,</span> <span class="nx">tan</span><span class="p">,</span> <span class="nx">asin</span><span class="p">,</span> <span class="nx">acos</span><span class="p">,</span> <span class="nx">atan</span><span class="p">}</span> <span class="o">=</span> <span class="nb">Math</span>
<span class="nv">formatter = </span><span class="nx">require</span> <span class="s">&#39;./formatter&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h1>Type coersion helpers</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">array = </span><span class="nf">(x) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">x</span> <span class="k">then</span> <span class="p">(</span><span class="nv">x = </span><span class="p">[</span><span class="nx">x</span><span class="p">]).</span><span class="nv">shape = </span><span class="p">[]</span>
  <span class="nx">x</span>

<span class="nv">num = </span><span class="nf">(x) -&gt;</span>
  <span class="k">if</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span>
    <span class="nx">assert</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Numeric scalar or singleton expected&#39;</span>
    <span class="nv">x = </span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span><span class="p">,</span> <span class="s">&#39;Numeric scalar or singleton expected&#39;</span>
  <span class="nx">x</span>

<span class="nv">bool = </span><span class="nf">(x) -&gt;</span>
  <span class="nv">x = </span><span class="nx">num</span> <span class="nx">x</span>
  <span class="nx">assert</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s">&#39;Boolean values must be either 0 or 1&#39;</span>
  <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h1>DSL for defining built-in symbols</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">tmp = monadic: </span><span class="p">{},</span> <span class="nv">dyadic: </span><span class="p">{}</span>

<span class="nv">def = </span><span class="nf">(h, name, description, f) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">name</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">description</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
  <span class="nx">f</span> <span class="o">?=</span> <span class="o">-&gt;</span> <span class="nx">die</span> <span class="s">&quot;Verb </span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">description</span><span class="si">}</span><span class="s"> is not implemented.&quot;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nx">assert</span> <span class="o">not</span> <span class="nx">h</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span><span class="p">,</span> <span class="s">&quot;Redefinition of verb </span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">description</span><span class="si">}</span><span class="s">&quot;</span>
  <span class="nx">h</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span>

<span class="nv">monadic = </span><span class="nf">(a...) -&gt;</span> <span class="nx">def</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">monadic</span><span class="p">,</span> <span class="nx">a</span><span class="p">...</span>
<span class="nv">dyadic = </span><span class="nf">(a...) -&gt;</span> <span class="nx">def</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">dyadic</span><span class="p">,</span> <span class="nx">a</span><span class="p">...</span>
<span class="nv">prefixAdverb = </span><span class="nf">(a...) -&gt;</span>
  <span class="p">((</span><span class="nx">def</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">monadic</span><span class="p">,</span> <span class="nx">a</span><span class="p">...).</span><span class="nx">aplMetaInfo</span> <span class="o">?=</span> <span class="p">{}).</span><span class="nv">isPrefixAdverb = </span><span class="kc">true</span>
<span class="nv">postfixAdverb = </span><span class="nf">(a...) -&gt;</span>
  <span class="p">((</span><span class="nx">def</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">monadic</span><span class="p">,</span> <span class="nx">a</span><span class="p">...).</span><span class="nx">aplMetaInfo</span> <span class="o">?=</span> <span class="p">{}).</span><span class="nv">isPostfixAdverb = </span><span class="kc">true</span>
<span class="nv">conjunction = </span><span class="nf">(a...) -&gt;</span>
  <span class="p">((</span><span class="nx">def</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">dyadic</span><span class="p">,</span>  <span class="nx">a</span><span class="p">...).</span><span class="nx">aplMetaInfo</span> <span class="o">?=</span> <span class="p">{}).</span><span class="nv">isConjunction = </span><span class="kc">true</span>

<span class="nv">withMetaInfoFrom = </span><span class="nf">(f, g) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">g</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nv">g.aplMetaInfo = </span><span class="k">if</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplMetaInfo</span> <span class="k">then</span> <span class="nx">inherit</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplMetaInfo</span> <span class="k">else</span> <span class="p">{}</span>
  <span class="nx">g</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Overloadable verbs</p>

<pre><code>x ← «{'⍟': function (y) { return y + 1234; }}» ◇ x ⍟ 1
... ⍝ returns 1235
x ← «{'right_⍟': function (y) { return y + 1234; }}» ◇ 1 ⍟ x
... ⍝ returns 1235
x ← «{'⍟': function (y) { return y + 1234; }}» ◇ x ⍟ 1 1
... ⍝ returns 1235 1235
x ← «{'⍟': function (y) { return y + 1234; }}» ◇ x x ⍟ 1
... ⍝ returns 1235 1235
x ← «{'⍟': function () { return 1234; }}» ◇ ⍟ x
... ⍝ returns 1234
x ← «{'⍟': function () { return 1234; }}» ◇ ⍟ x
... ⍝ returns 1234
x ← «{'⍟': function () { return 1234; }}» ◇ ⍟ x x
... ⍝ returns 1234 1234
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">overloadable = </span><span class="nf">(symbol, f) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">symbol</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nx">withMetaInfoFrom</span> <span class="nx">f</span><span class="p">,</span>
    <span class="nf">(b, a, args...) -&gt;</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="o">?</span> <span class="c1"># monadic application</span>
        <span class="k">if</span> <span class="k">typeof</span> <span class="nx">b</span><span class="o">?</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]</span> <span class="nx">args</span><span class="p">...</span>
        <span class="k">else</span> <span class="nx">f</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">args</span><span class="p">...</span>
      <span class="k">else</span> <span class="c1"># dyadic application</span>
        <span class="k">if</span> <span class="k">typeof</span> <span class="nx">a</span><span class="o">?</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
          <span class="nx">a</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">args</span><span class="p">...</span>
        <span class="k">else</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">b</span><span class="o">?</span><span class="p">[</span><span class="s">&#39;right_&#39;</span> <span class="o">+</span> <span class="nx">symbol</span><span class="p">]</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
          <span class="nx">b</span><span class="p">[</span><span class="s">&#39;right_&#39;</span> <span class="o">+</span> <span class="nx">symbol</span><span class="p">]</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">args</span><span class="p">...</span>
        <span class="k">else</span>
          <span class="nx">f</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">args</span><span class="p">...</span>

<span class="nv">ambivalent = </span><span class="nf">(symbol, f1, f2) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">symbol</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">f1</span> <span class="o">and</span> <span class="nx">f2</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">f1</span> <span class="o">or</span> <span class="nx">f2</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f1</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f2</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nv">F = </span><span class="nf">(b, a, args...) -&gt;</span> <span class="k">if</span> <span class="nx">a</span><span class="o">?</span> <span class="k">then</span> <span class="nx">f2</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">args</span><span class="p">...</span> <span class="k">else</span> <span class="nx">f1</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">args</span><span class="p">...</span>

<span class="nv">vocabulary = </span><span class="nx">@</span>
<span class="nv">endOfVocabulary = </span><span class="o">-&gt;</span>
  <span class="nv">ks = </span><span class="p">(</span><span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">monadic</span> <span class="k">then</span> <span class="nx">k</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span>
    <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">dyadic</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">monadic</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="nx">k</span>
  <span class="p">)</span>
  <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ks</span>
    <span class="nv">f1 = </span><span class="nx">tmp</span><span class="p">.</span><span class="nx">monadic</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">f1</span><span class="o">?</span>
      <span class="nv">f1 = </span><span class="nx">overloadable</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">f1</span>
      <span class="nv">f1 = </span><span class="nx">maybeMakePervasive</span> <span class="nx">f1</span>
    <span class="nv">f2 = </span><span class="nx">tmp</span><span class="p">.</span><span class="nx">dyadic</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">f2</span><span class="o">?</span>
      <span class="nv">f2 = </span><span class="nx">overloadable</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">f2</span>
      <span class="nv">f2 = </span><span class="nx">maybeMakePervasive</span> <span class="nx">f2</span>
    <span class="nx">vocabulary</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ambivalent</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">f1</span><span class="p">,</span> <span class="nx">f2</span><span class="p">)</span>
  <span class="nv">tmp = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><code>pervasive(f)</code> only marks <code>f</code> as pervasive.  It will actually be made
pervasive later in <code>endOfVocabulary()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">pervasive = </span><span class="nf">(f) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplMetaInfo</span> <span class="o">?=</span> <span class="p">{}).</span><span class="nv">isPervasive = </span><span class="kc">true</span>
  <span class="nx">f</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>maybeMakePervasive(f)</code> is a decorator which takes a scalar function <code>f</code>
and makes it propagate through arrays, if it has
<code>f.aplMetaInfo.isPervasive</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">maybeMakePervasive = </span><span class="nf">(f) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplMetaInfo</span><span class="o">?</span><span class="p">.</span><span class="nx">isPervasive</span>
    <span class="nx">f</span>
  <span class="k">else</span>
    <span class="nx">withMetaInfoFrom</span> <span class="nx">f</span><span class="p">,</span> <span class="p">(</span><span class="nv">F = </span><span class="nf">(b, a) -&gt;</span>
      <span class="k">if</span> <span class="nx">a</span><span class="o">?</span> <span class="c1"># dyadic pervasiveness</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">isSimple</span> <span class="nx">a</span><span class="p">)</span> <span class="o">and</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">isSimple</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">then</span> <span class="nv">a = </span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">isSimple</span> <span class="nx">b</span><span class="p">)</span> <span class="o">and</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">isSimple</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">then</span> <span class="nv">b = </span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">and</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">withShape</span> <span class="nx">b</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">withShape</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span><span class="p">;</span> <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
          <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">min</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
            <span class="nx">assert</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">is</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="s">&#39;Length error&#39;</span>
          <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
            <span class="nv">k = </span><span class="nx">prod</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">...]</span>
            <span class="nx">withShape</span> <span class="nx">sa</span><span class="p">,</span>
              <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">b</span><span class="p">[</span><span class="nx">floor</span> <span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
          <span class="k">else</span> <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
            <span class="nv">k = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">...]</span>
            <span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span>
              <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="nx">floor</span> <span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">])</span>
          <span class="k">else</span>
            <span class="nx">withShape</span> <span class="nx">sa</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
      <span class="k">else</span> <span class="c1"># monadic pervasiveness</span>
        <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">b</span>
        <span class="k">else</span> <span class="nx">withShape</span> <span class="nx">b</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">x</span><span class="p">)</span>
    <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h1>Built-in verbs</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Conjugate (<code>+</code>)</p>

<pre><code>+4              ⍝ returns 4
++4             ⍝ returns 4
+ 4 5           ⍝ returns 4 5
+((5 6) (7 1))  ⍝ returns (5 6) (7 1)
+ (5 6) (7 1)   ⍝ returns (5 6) (7 1)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;Conjugate&#39;</span><span class="p">,</span>      <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Add (<code>+</code>)</p>

<pre><code>1 + 2                           ⍝ returns 3
2 3 + 5 8                       ⍝ returns 7 11
(2 3 ⍴ 1 2 3 4 5 6) +       ¯2  ⍝ returns 2 3 ⍴ ¯1 0 1 2 3 4
(2 3 ⍴ 1 2 3 4 5 6) +   2 ⍴ ¯2  ⍝ returns 2 3 ⍴ ¯1 0 1 2 3 4
(2 3 ⍴ 1 2 3 4 5 6) + 2 3 ⍴ ¯2  ⍝ returns 2 3 ⍴ ¯1 0 1 2 3 4
1 2 3 + 4 5                     ⍝ fails 'Length error'
(2 3⍴⍳6) + 3 2⍴⍳6               ⍝ fails 'Length error'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;Add&#39;</span><span class="p">,</span>            <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Negate (<code>−</code>)</p>

<pre><code>−4         ⍝ returns ¯4
− 1 2 3    ⍝ returns ¯1 ¯2 ¯3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;−&#39;</span><span class="p">,</span> <span class="s">&#39;Negate&#39;</span><span class="p">,</span>         <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="o">-</span><span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Subtract (<code>−</code>)</p>

<pre><code>1 − 3      ⍝ returns ¯2
5 − ¯3     ⍝ returns 8
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;−&#39;</span><span class="p">,</span> <span class="s">&#39;Subtract&#39;</span><span class="p">,</span>       <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">x</span> <span class="o">-</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Sign of (<code>×</code>)</p>

<pre><code>× ¯2 ¯1 0 1 2 ⍝ returns ¯1 ¯1 0 1 1
× 0÷0         ⍝ returns 0
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;×&#39;</span><span class="p">,</span> <span class="s">&#39;Sign of&#39;</span><span class="p">,</span>        <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Multiply (<code>×</code>)</p>

<pre><code>7 × 8       ⍝ returns 56
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;×&#39;</span><span class="p">,</span> <span class="s">&#39;Multiply&#39;</span><span class="p">,</span>       <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Reciprocal (<code>÷</code>)</p>

<pre><code>÷2          ⍝ returns .5
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;÷&#39;</span><span class="p">,</span> <span class="s">&#39;Reciprocal&#39;</span><span class="p">,</span>     <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Divide (<code>÷</code>)</p>

<pre><code>27 ÷ 9      ⍝ returns 3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;÷&#39;</span><span class="p">,</span> <span class="s">&#39;Divide&#39;</span><span class="p">,</span>         <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">x</span> <span class="o">/</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Ceiling (<code>⌈</code>)</p>

<pre><code>⌈ 0 5 ¯5 (○1) ¯1.5   ⍝ returns 0 5 ¯5 4 ¯1
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⌈&#39;</span><span class="p">,</span> <span class="s">&#39;Ceiling&#39;</span><span class="p">,</span>        <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">ceil</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Greater of (<code>⌈</code>)</p>

<pre><code>3 ⌈ 5       ⍝ returns 5
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;⌈&#39;</span><span class="p">,</span> <span class="s">&#39;Greater of&#39;</span><span class="p">,</span>     <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">max</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Floor (<code>⌊</code>)</p>

<pre><code>⌊ 0 5 ¯5 (○1) ¯1.5   ⍝ returns 0 5 ¯5 3 ¯2
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⌊&#39;</span><span class="p">,</span> <span class="s">&#39;Floor&#39;</span><span class="p">,</span>          <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">floor</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Lesser of (<code>⌊</code>)</p>

<pre><code>3 ⌊ 5       ⍝ returns 3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;⌊&#39;</span><span class="p">,</span> <span class="s">&#39;Lesser of&#39;</span><span class="p">,</span>      <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">min</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Absolute value (<code>∣</code>)</p>

<pre><code>∣ ¯8 0 8 ¯3.5   ⍝ returns 8 0 8 3.5
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;∣&#39;</span><span class="p">,</span> <span class="s">&#39;Absolute value&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">abs</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Residue (<code>∣</code>)</p>

<pre><code>3 ∣ 5       ⍝ returns 2
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;∣&#39;</span><span class="p">,</span> <span class="s">&#39;Residue&#39;</span><span class="p">,</span>        <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">y</span> <span class="o">%</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Index generate (<code>⍳</code>)</p>

<pre><code>⍳ 5         ⍝ returns 0 1 2 3 4
⍴ ⍳ 5       ⍝ returns 1 ⍴ 5
⍳ 0         ⍝ returns ⍬
⍴ ⍳ 0       ⍝ returns ,0
⍳ 2 3 4     ⍝ returns (2 3 4 3 ⍴
...             0 0 0  0 0 1  0 0 2  0 0 3
...             0 1 0  0 1 1  0 1 2  0 1 3
...             0 2 0  0 2 1  0 2 2  0 2 3
...             1 0 0  1 0 1  1 0 2  1 0 3
...             1 1 0  1 1 1  1 1 2  1 1 3
...             1 2 0  1 2 1  1 2 2  1 2 3)
⍴⍳ 2 3 4    ⍝ returns 2 3 4 3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⍳&#39;</span><span class="p">,</span> <span class="s">&#39;Index generate&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span> <span class="k">then</span> <span class="k">return</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">i</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="nv">indices = </span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="k">then</span> <span class="mi">0</span>
  <span class="nv">i = </span><span class="mi">0</span>
  <span class="k">while</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">indices</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">v</span>
    <span class="nv">i = </span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">and</span> <span class="o">++</span><span class="nx">indices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">is</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="nx">indices</span><span class="p">[</span><span class="nx">i</span><span class="o">--</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nx">withShape</span> <span class="nx">a</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">shapeOf</span> <span class="nx">a</span><span class="p">),</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Index of (<code>⍳</code>)</p>

<pre><code>2 5 9 14 20 ⍳ 9                           ⍝ returns 1 ⍴ 2
2 5 9 14 20 ⍳ 6                           ⍝ returns 1 ⍴ 5
"GORSUCH" ⍳ "S"                           ⍝ returns 1 ⍴ 3
"ABCDEFGHIJKLMNOPQRSTUVWXYZ" ⍳ "CARP"     ⍝ returns 2 0 17 15
"ABCDEFGHIJKLMNOPQRSTUVWXYZ" ⍳ "PORK PIE"
... ⍝ returns 15 14 17 10 26 15 8 4
"MON" "TUES" "WED" ⍳ "MON" "THURS"        ⍝ returns 0 3
1 3 2 0 3 ⍳ ⍳ 5                           ⍝ returns 3 0 2 1 5
"CAT" "DOG" "MOUSE" ⍳ "DOG" "BIRD"        ⍝ returns 1 3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span>  <span class="s">&#39;⍳&#39;</span><span class="p">,</span> <span class="s">&#39;Index of&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">else</span> <span class="nx">assert</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;Left argument to ⍳ must be of rank no more than 1.&#39;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">b</span>
    <span class="nv">pos = </span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">for</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">when</span> <span class="nx">match</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="k">then</span> <span class="nv">pos = </span><span class="nx">i</span><span class="p">;</span> <span class="k">break</span>
    <span class="nx">pos</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Roll (<code>?</code>)</p>

<pre><code>n←6 ◇ r←?n ◇ (0≤r)∧(r&lt;n)   ⍝ returns 1
?0                         ⍝ returns 0
?1                         ⍝ returns 0
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="s">&#39;Roll&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">floor</span> <span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">floor</span> <span class="nx">num</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Deal (<code>?</code>)</p>

<pre><code>n←100 ◇ (+/n?n)=(+/⍳n)
... ⍝ returns 1 # a permutation (an "n?n" dealing) contains all 0...n
n←100 ◇ A←(n÷2)?n ◇ ∧/(0≤A),A&lt;n
... ⍝ returns 1 # any number x in a dealing is 0 &lt;= x &lt; n
0 ? 100  ⍝ returns ⍬
0 ? 0    ⍝ returns ⍬
1 ? 1    ⍝ returns ,0
5 ? 3    ⍝ fails
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="s">&#39;Deal&#39;</span><span class="p">,</span> <span class="nf">(y, x) -&gt;</span>
  <span class="nv">x = </span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">floor</span> <span class="nx">num</span> <span class="nx">x</span>
  <span class="nv">y = </span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">floor</span> <span class="nx">num</span> <span class="nx">y</span>
  <span class="nx">assert</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">y</span><span class="p">,</span> <span class="s">&#39;Domain error: left argument of ? must not be greater &#39;</span> <span class="o">+</span>
                 <span class="s">&#39;than its right argument.&#39;</span>
  <span class="nv">available = </span><span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">y</span><span class="p">]</span>
  <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">x</span><span class="p">]</span> <span class="k">then</span> <span class="nx">available</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">floor</span><span class="p">(</span><span class="nx">available</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="nx">random</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nx">monadic</span> <span class="s">&#39;⋆&#39;</span><span class="p">,</span> <span class="s">&#39;Exponentiate&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">exp</span> <span class="nx">num</span> <span class="nx">x</span>
<span class="nx">dyadic</span> <span class="s">&#39;⋆&#39;</span><span class="p">,</span> <span class="s">&#39;To the power of&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">pow</span> <span class="nx">num</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">num</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
<span class="nx">monadic</span> <span class="s">&#39;⍟&#39;</span><span class="p">,</span> <span class="s">&#39;Natural logarithm&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">log</span> <span class="nx">x</span>
<span class="nx">dyadic</span> <span class="s">&#39;⍟&#39;</span><span class="p">,</span> <span class="s">&#39;Logarithm to the base&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>

<span class="nx">monadic</span> <span class="s">&#39;○&#39;</span><span class="p">,</span> <span class="s">&#39;Pi times&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span> <span class="nx">PI</span> <span class="o">*</span> <span class="nx">x</span>
<span class="nx">dyadic</span> <span class="s">&#39;○&#39;</span><span class="p">,</span> <span class="s">&#39;Circular and hyperbolic functions&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(x, i) -&gt;</span>
  <span class="k">switch</span> <span class="nx">i</span>
    <span class="k">when</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span>
    <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">sin</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="mi">2</span> <span class="k">then</span> <span class="nx">cos</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="mi">3</span> <span class="k">then</span> <span class="nx">tan</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="mi">4</span> <span class="k">then</span> <span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span>
    <span class="k">when</span> <span class="mi">5</span> <span class="k">then</span> <span class="p">(</span><span class="nx">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># sinh</span>
    <span class="k">when</span> <span class="mi">6</span> <span class="k">then</span> <span class="p">(</span><span class="nx">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># cosh</span>
    <span class="k">when</span> <span class="mi">7</span> <span class="k">then</span> <span class="nv">ex = </span><span class="nx">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">x</span><span class="p">);</span> <span class="p">(</span><span class="nx">ex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># tanh</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nx">asin</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">2</span> <span class="k">then</span> <span class="nx">acos</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">3</span> <span class="k">then</span> <span class="nx">atan</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">4</span> <span class="k">then</span> <span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">5</span> <span class="k">then</span> <span class="nx">log</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># arcsinh</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">6</span> <span class="k">then</span> <span class="nx">log</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># arccosh</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">7</span> <span class="k">then</span> <span class="nx">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">x</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># arctanh</span>
    <span class="k">else</span> <span class="nx">die</span> <span class="s">&#39;Unknown circular or hyperbolic function &#39;</span> <span class="o">+</span> <span class="nx">i</span>

<span class="nv">Gamma = </span><span class="nf">(x) -&gt;</span>
  <span class="nv">p = </span><span class="p">[</span><span class="mf">0.99999999999980993</span><span class="p">,</span> <span class="mf">676.5203681218851</span><span class="p">,</span> <span class="o">-</span><span class="mf">1259.1392167224028</span><span class="p">,</span>
       <span class="mf">771.32342877765313</span><span class="p">,</span> <span class="o">-</span><span class="mf">176.61502916214059</span><span class="p">,</span> <span class="mf">12.507343278686905</span><span class="p">,</span>
       <span class="o">-</span><span class="mf">0.13857109526572012</span><span class="p">,</span> <span class="mf">9.9843695780195716</span><span class="nx">e</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mf">1.5056327351493116</span><span class="nx">e</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">PI</span> <span class="o">/</span> <span class="p">(</span><span class="nx">sin</span><span class="p">(</span><span class="nx">PI</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="nx">Gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">x</span><span class="p">))</span>
  <span class="nx">x</span><span class="o">--</span>
  <span class="nv">a = </span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">t = </span><span class="nx">x</span> <span class="o">+</span> <span class="mf">7.5</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">...</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
    <span class="nx">a</span> <span class="o">+=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">PI</span><span class="p">)</span> <span class="o">*</span> <span class="nx">pow</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="nx">exp</span><span class="p">(</span><span class="o">-</span><span class="nx">t</span><span class="p">)</span> <span class="o">*</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Factorial (<code>!</code>)</p>

<pre><code>!5    ⍝ returns 120
!21   ⍝ returns 51090942171709440000
!0    ⍝ returns 1
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;Factorial&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nv">factorial = </span><span class="nf">(x) -&gt;</span>
  <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">25</span> <span class="o">and</span> <span class="nx">x</span> <span class="o">is</span> <span class="nx">floor</span> <span class="nx">x</span>
    <span class="nv">r = </span><span class="mi">1</span><span class="p">;</span> <span class="nv">i = </span><span class="mi">2</span><span class="p">;</span> <span class="p">(</span><span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">r</span> <span class="o">*=</span> <span class="nx">i</span><span class="o">++</span><span class="p">);</span> <span class="nx">r</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span>
    <span class="mi">0</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">150</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
  <span class="k">else</span>
    <span class="nx">Gamma</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Binomial (<code>!</code>)</p>

<pre><code>2 ! 4         ⍝ returns 6
3 ! 20        ⍝ returns 1140
2 ! 6 12 20   ⍝ returns 15 66 190
(2 3 ⍴ 1 + ⍳ 6) ! 2 3 ⍴ 3 6 9 12 15 18
... ⍝ returns 2 3⍴ 3 15 84 495 3003 18564
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;Binomial&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(n, k) -&gt;</span>
  <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">and</span> <span class="nx">n</span> <span class="o">is</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">and</span> <span class="nx">k</span> <span class="o">is</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">k</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">k</span> <span class="o">&gt;</span> <span class="nx">n</span> <span class="k">then</span> <span class="nv">k = </span><span class="nx">n</span> <span class="o">-</span> <span class="nx">k</span> <span class="c1"># do less work</span>
    <span class="nv">u = v = </span><span class="mi">1</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">k</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="k">then</span> <span class="p">(</span><span class="nx">u</span> <span class="o">*=</span> <span class="nx">n</span> <span class="o">-</span> <span class="nx">i</span><span class="p">;</span> <span class="nx">v</span> <span class="o">*=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">u</span> <span class="o">/</span> <span class="nx">v</span>
  <span class="k">else</span>
    <span class="nx">factorial</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">factorial</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">*</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="nx">k</span><span class="p">))</span>

<span class="nx">monadic</span> <span class="s">&#39;⌹&#39;</span><span class="p">,</span> <span class="s">&#39;Matrix inverse&#39;</span> <span class="c1"># todo</span>
<span class="nx">dyadic</span> <span class="s">&#39;⌹&#39;</span><span class="p">,</span> <span class="s">&#39;Matrix divide&#39;</span> <span class="c1"># todo</span>

<span class="nx">dyadic</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;Less than&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">y</span><span class="p">)</span>
<span class="nx">dyadic</span> <span class="s">&#39;≤&#39;</span><span class="p">,</span> <span class="s">&#39;Less than or equal&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Equals (<code>=</code>)</p>

<pre><code>12 = 12               ⍝ returns 1
2 = 12                ⍝ returns 0
"Q" = "Q"             ⍝ returns 1
1 = "1"               ⍝ returns 0
"1" = 1               ⍝ returns 0
11 7 2 9 = 11 3 2 6   ⍝ returns 1 0 1 0
"STOAT" = "TOAST"     ⍝ returns 0 0 0 0 1
8 = 2 + 2 + 2 + 2     ⍝ returns 1
(2 3⍴1 2 3 4 5 6) = 2 3⍴3 3 3 5 5 5   ⍝ returns 2 3 ⍴ 0 0 1 0 1 0
3 = 2 3⍴1 2 3 4 5 6   ⍝ returns 2 3 ⍴ 0 0 1 0 0 0
3 = (2 3⍴1 2 3 4 5 6) (2 3⍴3 3 3 5 5 5)
... ⍝ returns (2 3 ⍴ 0 0 1 0 0 0) (2 3 ⍴ 1 1 1 0 0 0)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="s">&#39;Equal&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">is</span> <span class="nx">y</span><span class="p">)</span>

<span class="nx">dyadic</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;Greater than&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">y</span><span class="p">)</span>
<span class="nx">dyadic</span> <span class="s">&#39;≥&#39;</span><span class="p">,</span> <span class="s">&#39;Greater than or equal&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="nx">y</span><span class="p">)</span>
<span class="nx">dyadic</span> <span class="s">&#39;≠&#39;</span><span class="p">,</span> <span class="s">&#39;Not equal&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">isnt</span> <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Depth (<code>≡</code>)</p>

<pre><code>≡4                             ⍝ returns 0
≡⍳4                            ⍝ returns 1
≡2 2⍴⍳4                        ⍝ returns 1
≡"abc" 1 2 3 (23 55)           ⍝ returns 2
≡"abc" (2 4⍴("abc" 2 3 "k"))   ⍝ returns 3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;≡&#39;</span><span class="p">,</span> <span class="s">&#39;Depth&#39;</span><span class="p">,</span> <span class="nv">depthOf = </span><span class="nf">(a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="nv">r = </span><span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">r = </span><span class="nx">max</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">depthOf</span> <span class="nx">x</span><span class="p">);</span> <span class="nx">r</span> <span class="o">+</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Match (<code>≡</code>)</p>

<pre><code>3≡3                       ⍝ returns 1
3≡,3                      ⍝ returns 0
4 7.1 8 ≡ 4 7.2 8         ⍝ returns 0
(3 4⍴⍳12) ≡ 3 4⍴⍳12       ⍝ returns 1
(3 4⍴⍳12) ≡ ⊂3 4⍴⍳12      ⍝ returns 0
("ABC" "DEF") ≡ "ABCDEF"  ⍝ returns 0
(⍳0)≡""                   ⍝ returns 0
(2 0⍴0)≡(0 2⍴0)           ⍝ returns 0
(0⍴1 2 3)≡0⍴⊂2 2⍴⍳4       ⍝ returns 0
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;≡&#39;</span><span class="p">,</span> <span class="s">&#39;Match&#39;</span><span class="p">,</span> <span class="nv">match = </span><span class="nf">(b, a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">and</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="o">+</span><span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="nx">b</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">isnt</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Compare by shape</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">when</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Compare by elements</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">match</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Compare by prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">1</span>
  <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">aplPrototype</span><span class="o">?</span> <span class="o">or</span> <span class="nx">b</span><span class="p">.</span><span class="nx">aplPrototype</span><span class="o">?</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">1</span>
  <span class="nx">match</span> <span class="nx">prototypeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">prototypeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Not match (<code>≢</code>)</p>

<pre><code>3≢3   ⍝ returns 0
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;≢&#39;</span><span class="p">,</span> <span class="s">&#39;Not match&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span> <span class="o">+not</span> <span class="nx">match</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Enlist (<code>∈</code>)</p>

<pre><code>∈ 17                        ⍝ returns ,17
⍴ ∈ (1 2 3) "ABC" (4 5 6)   ⍝ returns ,9
∈ 2 2⍴(1 + 2 2⍴⍳4) "DEF" (1 + 2 3⍴⍳6) (7 8 9)
... ⍝ returns 1 2 3 4,'DEF',1 2 3 4 5 6 7 8 9
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;∈&#39;</span><span class="p">,</span> <span class="s">&#39;Enlist&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="nv">rec = </span><span class="nf">(x) -&gt;</span> <span class="p">(</span><span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">x</span> <span class="k">else</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">y</span><span class="p">);</span> <span class="nx">r</span>
  <span class="nx">rec</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Membership (<code>∈</code>)</p>

<pre><code>2 3 4 5 6 ∈ 1 2 3 5 8 13 21   ⍝ returns 1 1 0 1 0
5 ∈ 1 2 3 5 8 13 21           ⍝ returns 1
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;∈&#39;</span><span class="p">,</span> <span class="s">&#39;Membership&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">b = </span><span class="nx">array</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="o">+</span><span class="p">(</span><span class="nx">a</span> <span class="k">in</span> <span class="nx">b</span><span class="p">)</span>
  <span class="k">else</span> <span class="nx">withShape</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Find (<code>⍷</code>)</p>

<pre><code>"AN"⍷"BANANA"                          ⍝ returns 0 1 0 1 0 0
"BIRDS" "NEST"⍷"BIRDS" "NEST" "SOUP"   ⍝ returns 1 0 0
"ME"⍷"HOME AGAIN"                      ⍝ returns 0 0 1 0 0 0 0 0 0 0

"DAY"⍷7 9⍴,/("SUNDAY   "
...          "MONDAY   "
...          "TUESDAY  "
...          "WEDNESDAY"
...          "THURSDAY "
...          "FRIDAY   "
...          "SATURDAY ")
...   ⍝ returns (7 9 ⍴
...          0 0 0 1 0 0 0 0 0
...          0 0 0 1 0 0 0 0 0
...          0 0 0 0 1 0 0 0 0
...          0 0 0 0 0 0 1 0 0
...          0 0 0 0 0 1 0 0 0
...          0 0 0 1 0 0 0 0 0
...          0 0 0 0 0 1 0 0 0)

(2 2⍴"ABCD")⍷"ABCD"   ⍝ returns 4 ⍴ 0
(1 2) (3 4) ⍷ "START" (1 2 3) (1 2) (3 4)   ⍝ returns 0 0 1 0

(2 2⍴7 8 12 13)⍷ 1+ 4 5⍴⍳20
... ⍝ returns 4 5 ⍴ (0 0 0 0 0
...                  0 1 0 0 0
...                  0 0 0 0 0
...                  0 0 0 0 0)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;⍷&#39;</span><span class="p">,</span> <span class="s">&#39;Find&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">and</span> <span class="nx">match</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="nv">r = </span><span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="mi">0</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">r</span>
  <span class="k">while</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">unshift</span> <span class="mi">1</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="k">if</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">r</span>

  <span class="nv">indices = </span><span class="nb">Array</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>

  <span class="nv">rec = </span><span class="nf">(d, ir) -&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">-</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="nx">indices</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span>
        <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ir</span> <span class="o">*</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">i</span>
    <span class="k">else</span>
      <span class="nx">r</span><span class="p">[</span><span class="nx">ir</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rec2</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

  <span class="nv">rec2 = </span><span class="nf">(d, ia, ib) -&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sa</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">rec2</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ia</span> <span class="o">*</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ib</span> <span class="o">*</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">indices</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">i</span>
          <span class="k">return</span> <span class="mi">0</span>
      <span class="mi">1</span>
    <span class="k">else</span>
      <span class="nx">match</span> <span class="nx">a</span><span class="p">[</span><span class="nx">ia</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">ib</span><span class="p">]</span>

  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Unique (<code>∪</code>)</p>

<pre><code>∪ 3 17 17 17 ¯3 17 0   ⍝ returns 3 17 ¯3 0
∪ 3 17                 ⍝ returns 3 17
∪ 17                   ⍝ returns ,17
∪ ⍬                    ⍝ returns ⍬
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;∪&#39;</span><span class="p">,</span> <span class="s">&#39;Unique&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">array</span> <span class="nx">a</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">contains</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">x</span>
  <span class="nx">r</span>

<span class="nv">contains = </span><span class="nf">(a, x) -&gt;</span> <span class="c1"># a helper</span>
  <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">when</span> <span class="nx">match</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">true</span>
  <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Union (<code>∪</code>)</p>

<pre><code>1 2 ∪ 2 3   ⍝ returns 1 2 3
'SHOCK' ∪ 'CHOCOLATE'   ⍝ returns 'SHOCKLATE'

'lentils' 'bulghur' (3 4 5) ∪ 'lentils' 'rice'
...     ⍝ returns 'lentils' 'bulghur' (3 4 5) 'rice'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;∪&#39;</span><span class="p">,</span> <span class="s">&#39;Union&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">a = </span><span class="nx">array</span> <span class="nx">a</span>
  <span class="nv">b = </span><span class="nx">array</span> <span class="nx">b</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">contains</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Intersection (<code>∩</code>)</p>

<pre><code>'ABRA'∩'CAR'      ⍝ returns 'ARA'
1 'PLUS' 2 ∩ ⍳5   ⍝ returns 1 2
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;∩&#39;</span><span class="p">,</span> <span class="s">&#39;Intersection&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">a = </span><span class="nx">array</span> <span class="nx">a</span>
  <span class="nv">b = </span><span class="nx">array</span> <span class="nx">b</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">when</span> <span class="nx">contains</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">x</span>

<span class="nx">monadic</span> <span class="s">&#39;∼&#39;</span><span class="p">,</span> <span class="s">&#39;Not&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(x) -&gt;</span>
  <span class="o">+!</span><span class="nx">bool</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Without (<code>∼</code>)</p>

<pre><code>"ABCDEFGHIJKLMNOPQRSTUVWXYZ"∼"AEIOU" ⍝ returns 'BCDFGHJKLMNPQRSTVWXYZ'
1 2 3 4 5 6 ∼ 2 4 6                  ⍝ returns 1 3 5
"THIS IS TEXT" ∼ " "                 ⍝ returns 'THISISTEXT'
"THIS" "AND" "THAT" ∼ "T"            ⍝ returns 'THIS' 'AND' 'THAT'
"THIS" "AND" "THAT" ∼ "AND"          ⍝ returns 'THIS' 'AND' 'THAT'
"THIS" "AND" "THAT" ∼ ⊂"AND"         ⍝ returns 'THIS' 'THAT'
"THIS" "AND" "THAT" ∼ "TH" "AND"     ⍝ returns 'THIS' 'THAT'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;∼&#39;</span><span class="p">,</span> <span class="s">&#39;Without&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">else</span> <span class="nx">assert</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;Left argument to ∼ must be of rank no more than 1.&#39;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
    <span class="nv">excluded = </span><span class="kc">false</span>
    <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">b</span>
      <span class="k">if</span> <span class="nx">match</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>
        <span class="nv">excluded = </span><span class="kc">true</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">excluded</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">x</span>
  <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Or (LCM) (<code>∨</code>)</p>

<pre><code>1∨1                ⍝ returns 1
1∨0                ⍝ returns 1
0∨1                ⍝ returns 1
0∨0                ⍝ returns 0
0 0 1 1 ∨ 0 1 0 1  ⍝ returns 0 1 1 1
12∨18              ⍝ returns 6   # 12=2×2×3, 18=2×3×3
299∨323            ⍝ returns 1   # 299=13×23, 323=17×19
12345∨12345        ⍝ returns 12345
0∨123              ⍝ returns 123
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;∨&#39;</span><span class="p">,</span> <span class="s">&#39;Or&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span>
  <span class="nv">x = </span><span class="nx">abs</span> <span class="nx">num</span> <span class="nx">x</span>
  <span class="nv">y = </span><span class="nx">abs</span> <span class="nx">num</span> <span class="nx">y</span>
  <span class="nx">assert</span> <span class="nx">x</span> <span class="o">is</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">and</span> <span class="nx">y</span> <span class="o">is</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">y</span><span class="p">),</span> <span class="s">&#39;∨ is defined only for integers&#39;</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">y</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">y</span> <span class="k">then</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="p">]</span>
  <span class="k">while</span> <span class="nx">y</span> <span class="k">then</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span> <span class="o">%</span> <span class="nx">y</span><span class="p">]</span> <span class="c1"># Euclid&#39;s algorithm</span>
  <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>And (GCD) (<code>∧</code>)</p>

<pre><code>1∧1                                   ⍝ returns 1
1∧0                                   ⍝ returns 0
0∧1                                   ⍝ returns 0
0∧0                                   ⍝ returns 0
0 0 1 1 ∧ 0 1 0 1                     ⍝ returns 0 0 0 1
0 0 0 1 1 ∧ 1 1 1 1 0                 ⍝ returns 0 0 0 1 0
t ← 3 3 ⍴ 1 1 1 0 0 0 1 0 1  ◇  1∧t   ⍝ returns 3 3 ⍴ 1 1 1 0 0 0 1 0 1
t ← 3 3 ⍴ 1 1 1 0 0 0 1 0 1  ◇  ∧/ t  ⍝ returns 1 0 0
12∧18       # 12=2×2×3, 18=2×3×3      ⍝ returns 36
299∧323     # 299=13×23, 323=17×19    ⍝ returns 96577
12345∧12345                           ⍝ returns 12345
0∧123                                 ⍝ returns 0
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;∧&#39;</span><span class="p">,</span> <span class="s">&#39;And&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span>
  <span class="nv">x = </span><span class="nx">abs</span> <span class="nx">num</span> <span class="nx">x</span>
  <span class="nv">y = </span><span class="nx">abs</span> <span class="nx">num</span> <span class="nx">y</span>
  <span class="nx">assert</span> <span class="nx">x</span> <span class="o">is</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">and</span> <span class="nx">y</span> <span class="o">is</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">y</span><span class="p">),</span> <span class="s">&#39;∧ is defined only for integers&#39;</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">y</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="nv">p = </span><span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">y</span> <span class="k">then</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="p">]</span>
  <span class="k">while</span> <span class="nx">y</span> <span class="k">then</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span> <span class="o">%</span> <span class="nx">y</span><span class="p">]</span> <span class="c1"># Euclid&#39;s algorithm</span>
  <span class="nx">p</span> <span class="o">/</span> <span class="nx">x</span> <span class="c1"># LCM(x, y) = x * y / GCD(x, y)</span>

<span class="nx">dyadic</span> <span class="s">&#39;⍱&#39;</span><span class="p">,</span> <span class="s">&#39;Nor&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+!</span><span class="p">(</span><span class="nx">bool</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nx">bool</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span>
<span class="nx">dyadic</span> <span class="s">&#39;⍲&#39;</span><span class="p">,</span> <span class="s">&#39;Nand&#39;</span><span class="p">,</span> <span class="nx">pervasive</span> <span class="nf">(y, x) -&gt;</span> <span class="o">+!</span><span class="p">(</span><span class="nx">bool</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">and</span> <span class="nx">bool</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span>

<span class="nx">monadic</span> <span class="s">&#39;⍴&#39;</span><span class="p">,</span> <span class="s">&#39;Shape of&#39;</span><span class="p">,</span> <span class="nx">shapeOf</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Reshape (<code>⍴</code>)</p>

<pre><code>⍴ 1 2 3 ⍴ 0    ⍝ returns 1 2 3
⍴ ⍴ 1 2 3 ⍴ 0  ⍝ returns ,3
3 3 ⍴ ⍳ 4      ⍝ returns 3 3 ⍴ 0 1 2 3 0 1 2 3 0
⍴ 3 3 ⍴ ⍳ 4    ⍝ returns 3 3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;⍴&#39;</span><span class="p">,</span> <span class="s">&#39;Reshape&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nv">a =</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
      <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span><span class="p">,</span>
        <span class="s">&#39;Domain error: Left argument to ⍴ must be a &#39;</span> <span class="o">+</span>
        <span class="s">&#39;numeric scalar or vector.&#39;</span>
      <span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">floor</span> <span class="nx">x</span>
  <span class="nx">withShape</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">withPrototypeCopiedFrom</span> <span class="nx">b</span><span class="p">,</span>
    <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">prod</span> <span class="nx">a</span><span class="p">]</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Helper for verbs <code>,</code> and <code>⍪</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">catenate = </span><span class="nf">(b, a, axis = -1) -&gt;</span>
  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span><span class="p">;</span> <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nv">sa = </span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span><span class="p">;</span> <span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nv">sb = </span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nx">assert</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="s">&#39;Length error: Cannot catenate arrays of different ranks&#39;</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">when</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">and</span> <span class="nx">i</span> <span class="o">isnt</span> <span class="nx">axis</span>
    <span class="nx">die</span> <span class="s">&#39;Length error: Catenated arrays must match &#39;</span> <span class="o">+</span>
        <span class="s">&#39;at all axes except the one to catenate on&#39;</span>
  <span class="nv">ni = </span><span class="nx">prod</span> <span class="nx">sa</span><span class="p">[...</span><span class="nx">axis</span><span class="p">]</span> <span class="c1"># number of items across all dimensions before `axis&#39;</span>
  <span class="nv">nja = </span><span class="nx">sa</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>        <span class="c1"># number of items across `axis&#39; in `a&#39;</span>
  <span class="nv">njb = </span><span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>        <span class="c1"># number of items across `axis&#39; in `b&#39;</span>
  <span class="nv">nk = </span><span class="nx">prod</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span> <span class="c1"># number of items across dimensions after `axis&#39;</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">ni</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nja</span><span class="p">]</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">a</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span> <span class="o">*</span> <span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nja</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">njb</span><span class="p">]</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span> <span class="o">*</span> <span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">njb</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)]</span>
  <span class="nv">sr = </span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">sa</span> <span class="k">then</span> <span class="nx">x</span>
  <span class="nx">sr</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Ravel (<code>,</code>)</p>

<pre><code>,2 3 4⍴'abcdefghijklmnopqrstuvwx' ⍝ returns 'abcdefghijklmnopqrstuvwx'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;Ravel&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span> <span class="nx">array</span><span class="p">(</span><span class="nx">a</span><span class="p">)[</span><span class="mi">0</span><span class="p">...]</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Catenate (<code>,</code>)</p>

<pre><code>10,66                ⍝ returns 10, 66
'10 ','MAY ','1985'  ⍝ returns '10 MAY 1985'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;Catenate&#39;</span><span class="p">,</span> <span class="nx">catenate</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>1st axis catenate (<code>⍪</code>)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;⍪&#39;</span><span class="p">,</span> <span class="s">&#39;1st axis catenate&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span> <span class="nx">catenate</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Reverse (<code>⌽</code>)</p>

<pre><code>⌽ 1 2 3 4 5 6                    ⍝ returns 6 5 4 3 2 1
⌽ (1 2) (3 4) (5 6)              ⍝ returns (5 6) (3 4) (1 2)
⌽ "BOB WON POTS"                 ⍝ returns 'STOP NOW BOB'
⌽    2 5 ⍴ 1 2 3 4 5 6 7 8 9 0   ⍝ returns 2 5 ⍴ 5 4 3 2 1 0 9 8 7 6
⌽[0] 2 5 ⍴ 1 2 3 4 5 6 7 8 9 0   ⍝ returns 2 5 ⍴ 6 7 8 9 0 1 2 3 4 5
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⌽&#39;</span><span class="p">,</span> <span class="s">&#39;Reverse&#39;</span><span class="p">,</span> <span class="nv">reverse = </span><span class="nf">(b, _1, axis = -1) -&gt;</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s">&#39;Axis out of bounds&#39;</span>
  <span class="nv">ni = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[...</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nv">nj = </span><span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nv">nk = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">ni</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">nj</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">..</span> <span class="mi">0</span><span class="p">]</span> <span class="k">by</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span><span class="o">*</span><span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">)]</span>
  <span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Rotate (<code>⌽</code>)</p>

<pre><code>1 ⌽ 1 2 3 4 5 6                   ⍝ returns 2 3 4 5 6 1
3 ⌽ 'ABCDEFGH'                    ⍝ returns 'DEFGHABC'
3 ⌽ 2 5 ⍴  1 2 3 4 5  6 7 8 9 0   ⍝ returns 2 5 ⍴ 4 5 1 2 3 9 0 6 7 8
¯2 ⌽ "ABCDEFGH"                   ⍝ returns 'GHABCDEF'
1 ⌽ 3 3 ⍴ ⍳ 9                     ⍝ returns 3 3 ⍴ 1 2 0 4 5 3 7 8 6
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;⌽&#39;</span><span class="p">,</span> <span class="s">&#39;Rotate&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">a = </span><span class="nx">num</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">b</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nv">n = </span><span class="nx">sb</span><span class="p">[</span><span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
  <span class="nx">a</span> <span class="o">%=</span> <span class="nx">n</span><span class="p">;</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">+=</span> <span class="nx">n</span>
  <span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span>
    <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">n</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">n</span><span class="p">)</span> <span class="o">+</span> <span class="nx">a</span><span class="p">)</span> <span class="o">%</span> <span class="nx">n</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>1st axis reverse (<code>⊖</code>)</p>

<pre><code>⊖ 1 2 3 4 5 6                   ⍝ returns 6 5 4 3 2 1
⊖ (1 2) (3 4) (5 6)             ⍝ returns (5 6) (3 4) (1 2)
⊖ 'BOB WON POTS'                ⍝ returns 'STOP NOW BOB'
⊖    2 5 ⍴ 1 2 3 4 5 6 7 8 9 0  ⍝ returns 2 5 ⍴ 6 7 8 9 0 1 2 3 4 5
⊖[1] 2 5 ⍴ 1 2 3 4 5 6 7 8 9 0  ⍝ returns 2 5 ⍴ 5 4 3 2 1 0 9 8 7 6
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⊖&#39;</span><span class="p">,</span> <span class="s">&#39;1st axis reverse&#39;</span><span class="p">,</span> <span class="nf">(b, _1, axis = 0) -&gt;</span>
  <span class="nx">reverse</span> <span class="nx">b</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>1st axis rotate (<code>⊖</code>)</p>

<pre><code>1 ⊖ 3 3 ⍴ ⍳ 9   ⍝ returns 3 3 ⍴ 3 4 5 6 7 8 0 1 2
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;⊖&#39;</span><span class="p">,</span> <span class="s">&#39;1st axis rotate&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">a = </span><span class="nx">num</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">b</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nv">n = </span><span class="nx">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">k = </span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">n</span>
  <span class="nx">a</span> <span class="o">%=</span> <span class="nx">n</span><span class="p">;</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">+=</span> <span class="nx">n</span>
  <span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span>
    <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[((</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">)</span> <span class="o">+</span> <span class="nx">a</span><span class="p">)</span> <span class="o">%</span> <span class="nx">n</span><span class="p">)</span> <span class="o">*</span> <span class="nx">k</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">k</span><span class="p">)])</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Transpose (<code>⍉</code>)</p>

<pre><code>⍉ 2 3 ⍴ 1 2 3 6 7 8     ⍝ returns 3 2 ⍴ 1 6 2 7 3 8
⍴ ⍉ 2 3 ⍴ 1 2 3 6 7 8   ⍝ returns 3 2
⍉ 1 2 3                 ⍝ returns 1 2 3
⍉ 2 3 4 ⍴ ⍳ 24          ⍝ returns (4 3 2 ⍴
...                          0 12   4 16    8 20
...                          1 13   5 17    9 21
...                          2 14   6 18   10 22
...                          3 15   7 19   11 23)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⍉&#39;</span><span class="p">,</span> <span class="s">&#39;Transpose&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span>
  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">a</span> <span class="c1"># has no effect on scalars or vectors</span>
  <span class="nv">sr = </span><span class="nx">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">...].</span><span class="nx">reverse</span><span class="p">()</span>
  <span class="nv">psr = </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># partial products over sr</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">then</span> <span class="nx">psr</span><span class="p">.</span><span class="nx">push</span> <span class="nx">psr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">sr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="nv">rec = </span><span class="nf">(d, i) -&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sr</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span><span class="o">*</span><span class="nx">psr</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span>

<span class="nx">monadic</span> <span class="s">&#39;↑&#39;</span><span class="p">,</span> <span class="s">&#39;First&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span>
  <span class="nv">a = </span><span class="nx">array</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nx">prototypeOf</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Take (<code>↑</code>)</p>

<pre><code>5 ↑ 'ABCDEFGH'           ⍝ returns 'ABCDE'
¯3 ↑ 'ABCDEFGH'          ⍝ returns 'FGH'
3 ↑ 22 2 19 12           ⍝ returns 22 2 19
¯1 ↑ 22 2 19 12          ⍝ returns ,12
⍴ 1 ↑ (2 2 ⍴ ⍳ 4) (⍳ 10) ⍝ returns ,1
5 ↑ 40 92 11             ⍝ returns 40 92 11 0 0
¯5 ↑ 40 92 11            ⍝ returns 0 0 40 92 11
3 3 ↑ 1 1 ⍴ 0            ⍝ returns 3 3 ⍴ 0 0 0 0 0 0 0 0 0
5 ↑ "abc"                ⍝ returns 'abc  '
¯5 ↑ "abc"               ⍝ returns '  abc'
3 3 ↑ 1 1 ⍴ "a"          ⍝ returns 3 3 ⍴ 'a        '
2 3 ↑ 1 + 4 3 ⍴ ⍳ 12     ⍝ returns 2 3 ⍴ 1 2 3 4 5 6
¯1 3 ↑ 1 + 4 3 ⍴ ⍳ 12    ⍝ returns 1 3 ⍴ 10 11 12
1 2 ↑ 1 + 4 3 ⍴ ⍳ 12     ⍝ returns 1 2 ⍴ 1 2
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;↑&#39;</span><span class="p">,</span> <span class="s">&#39;Take&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
    <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span><span class="p">,</span>
      <span class="s">&#39;Domain error: Left argument to ↑ must be a numeric scalar or vector.&#39;</span>
  <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">and</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nx">assert</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="s">&#39;Length error: Left argument to ↑ must have as many elements as is &#39;</span> <span class="o">+</span>
    <span class="s">&#39;the rank of its right argument.&#39;</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="nv">pa = </span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="mi">0</span>
  <span class="nx">pa</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="nv">i = </span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="k">while</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="nx">i</span><span class="o">--</span>
  <span class="nv">filler = </span><span class="nx">prototypeOf</span> <span class="nx">b</span>
  <span class="nv">rec = </span><span class="nf">(d, i, k) -&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="nx">k</span> <span class="o">/=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">min</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">],</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">*</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">k</span>
        <span class="k">if</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
          <span class="k">for</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">-</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span> <span class="o">*</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
          <span class="k">for</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="o">-</span><span class="p">(</span><span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span> <span class="o">*</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span> <span class="p">...</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span>
          <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">*</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">k</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">withShape</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">abs</span> <span class="nx">x</span><span class="p">),</span> <span class="nx">withPrototype</span> <span class="nx">filler</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Drop (<code>↓</code>)</p>

<pre><code>4↓'OVERBOARD'              ⍝ returns 'BOARD'
¯5↓'OVERBOARD'             ⍝ returns 'OVER'
⍴10↓'OVERBOARD'            ⍝ returns ,0
0 ¯2↓ 3 3 ⍴ 'ONEFATFLY'    ⍝ returns 3 1 ⍴ 'OFF'
¯2 ¯1↓ 3 3 ⍴ 'ONEFATFLY'   ⍝ returns 1 2 ⍴ 'ON'
1↓ 3 3 ⍴ 'ONEFATFLY'       ⍝ returns 2 3 ⍴ 'FATFLY'
1 1↓ 2 3 4⍴"ABCDEFGHIJKLMNOPQRSTUVWXYZ"    ⍝ returns 1 2 4 ⍴ 'QRSTUVWX'
¯1 ¯1↓ 2 3 4⍴"ABCDEFGHIJKLMNOPQRSTUVWXYZ"  ⍝ returns 1 2 4 ⍴ 'ABCDEFGH'
</code></pre>

<p>todo: more tests</p>

<pre><code>//#gives '1 ↓[1] 2 3 4⍴1+⍳24', [5..12].concat [17..24]
//    # todo: drop with axis specification
//#gives '1 ↓[2] 2 3 4⍴1+⍳24',
//    [3, 4, 7, 8, 11, 12, 15, 16, 19, 20, 23, 24] # todo
//#gives '1 ↓[2 1] 2 3 4⍴1+⍳24', [7, 8, 11, 12, 19, 20, 23, 24] # todo
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;↓&#39;</span><span class="p">,</span> <span class="s">&#39;Drop&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">when</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="s">&#39;number&#39;</span> <span class="o">or</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="nx">floor</span> <span class="nx">x</span>
    <span class="nx">die</span> <span class="s">&#39;Left argument to ↓ must be an integer or a vector of integers.&#39;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nv">b = </span><span class="nx">withShape</span> <span class="p">(</span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">b</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">die</span> <span class="s">&#39;The left argument to ↓ must have length less than or equal to &#39;</span> <span class="o">+</span>
        <span class="s">&#39;the rank of its right argument.&#39;</span>
  <span class="k">for</span> <span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">...</span><span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">a</span><span class="p">.</span><span class="nx">push</span> <span class="mi">0</span>
  <span class="nv">lims =</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="p">[</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span>
      <span class="k">else</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])]</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="nv">rec = </span><span class="nf">(d, i, n) -&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="nx">n</span> <span class="o">/=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">lims</span><span class="p">[</span><span class="nx">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]...</span><span class="nx">lims</span><span class="p">[</span><span class="nx">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span><span class="o">*</span><span class="nx">n</span><span class="p">,</span> <span class="nx">n</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">sr = </span><span class="k">for</span> <span class="p">[</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">]</span> <span class="k">in</span> <span class="nx">lims</span> <span class="k">then</span> <span class="nx">hi</span> <span class="o">-</span> <span class="nx">lo</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Enclose (<code>⊂</code>)</p>

<pre><code>⍴ ⊂ 2 3⍴⍳6    ⍝ returns ⍬
⍴⍴ ⊂ 2 3⍴⍳6   ⍝ returns ,0
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⊂&#39;</span><span class="p">,</span> <span class="s">&#39;Enclose&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span> <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">a</span> <span class="k">else</span> <span class="nx">withShape</span> <span class="p">[],</span> <span class="p">[</span><span class="nx">a</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Partition (with axis) (<code>⊂</code>)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;⊂&#39;</span><span class="p">,</span> <span class="s">&#39;Partition (with axis)&#39;</span> <span class="c1"># todo</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Disclose (<code>⊃</code>)</p>

<pre><code>⊃ (1 2 3) (4 5 6)   ⍝ returns 2 3 ⍴ 1 2 3 4 5 6
⍴⊃ (1 2 3) (4 5 6)  ⍝ returns 2 3
⊃ (1 2) (3 4 5)     ⍝ returns 2 3 ⍴ 1 2 0 3 4 5
⍴⊃ (1 2) (3 4 5)    ⍝ returns 2 3
⊃ (1 2 3) "AB"      ⍝ returns 2 3 ⍴ 1 2 3,'AB '
⍴⊃ (1 2 3) "AB"     ⍝ returns 2 3
⊃123                ⍝ returns 123
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⊃&#39;</span><span class="p">,</span> <span class="s">&#39;Disclose&#39;</span><span class="p">,</span> <span class="nf">(a) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">a</span>
  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">sr1 = </span><span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">...]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">...]</span>
    <span class="nv">sx = </span><span class="nx">shapeOf</span> <span class="nx">x</span>
    <span class="k">if</span> <span class="nx">sx</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">sr1</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">die</span> <span class="s">&#39;The argument of ⊃ must contain elements of the same rank.&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>todo: or scalars</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sr1</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
      <span class="nx">sr1</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">max</span> <span class="nx">sr1</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
  <span class="nv">sr = </span><span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">concat</span> <span class="nx">sr1</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
    <span class="nv">sx = </span><span class="nx">shapeOf</span> <span class="nx">x</span>
    <span class="nv">rec = </span><span class="nf">(d,   # dimension</span>
<span class="nf">           i,   # index in x</span>
<span class="nf">           n,   # block size in x</span>
<span class="nf">           N    # block size in r</span>
<span class="nf">           ) -&gt;</span>
      <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sr1</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="k">else</span>
        <span class="nx">n</span> <span class="o">/=</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
        <span class="nx">N</span> <span class="o">/=</span> <span class="nx">sr1</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span>
          <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">*</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">N</span>
        <span class="k">if</span> <span class="nx">sr1</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
          <span class="nv">filler = </span><span class="nx">prototypeOf</span> <span class="nx">x</span>
          <span class="k">for</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">N</span> <span class="o">*</span> <span class="p">(</span><span class="nx">sr1</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">-</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">])]</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
    <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">prod</span> <span class="nx">sr1</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span>

<span class="nx">dyadic</span> <span class="s">&#39;⊃&#39;</span><span class="p">,</span> <span class="s">&#39;Pick&#39;</span> <span class="c1"># todo</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Index (<code>⌷</code>)</p>

<p><code>a0 a1...⌷b</code> is equivalent to <code>b[a0;a1;...]</code></p>

<pre><code>1 ⌷ 3 5 8                ⍝ returns 5
(3 5 8)[1]               ⍝ returns 5
⌷←{⍺+¨⍵}  ◇  (3 5 8)[1]  ⍝ returns 4 6 9
(2 2 0) (1 2) ⌷ 3 3⍴⍳9   ⍝ returns 3 2 ⍴ 7 8 7 8 1 2
¯1 ⌷ 3 5 8               ⍝ fails
2 ⌷ 111 222 333 444      ⍝ returns 333
(⊂3 2) ⌷ 111 222 333 444 ⍝ returns 444 333
(⊂2 3⍴2 0 3 0 1 2) ⌷ 111 222 333 444
... ⍝ returns 2 3⍴333 111 444 111 222 333
1 0    ⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 21
1      ⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 21 22 23 24
2 (1 0)⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 32 31
(1 2) 0⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 21 31

(23 54 38)[0]                         ⍝ returns 23
(23 54 38)[1]                         ⍝ returns 54
(23 54 38)[2]                         ⍝ returns 38
(23 54 38)[3]                         ⍝ fails
(23 54 38)[¯1]                        ⍝ fails
(23 54 38)[0 2]                       ⍝ returns 23 38
(2 3 ⍴ 100 101 102 110 111 112)[1;2]  ⍝ returns 112
(2 3 ⍴ 100 101 102 110 111 112)[1;¯1] ⍝ fails
(2 3 ⍴ 100 101 102 110 111 112)[10;1] ⍝ fails
(2 3 ⍴ 100 101 102 110 111 112)[1;]   ⍝ returns 110 111 112
(2 3 ⍴ 100 101 102 110 111 112)[;1]   ⍝ returns 101 111
'hello'[1]                            ⍝ returns 'e'
'ipodlover'[1 2 5 8 3 7 6 0 4]        ⍝ returns 'poordevil'
('axlrose'[4 3 0 2 5 6 1])[0 1 2 3]   ⍝ returns 'oral'

" X"[(3 3⍴⍳9) ∈ 1 3 6 7 8]  ⍝ returns 3 3⍴,/ (' X '
...                                           'X  '
...                                           'XXX')
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="s">&#39;⌷&#39;</span><span class="p">,</span> <span class="s">&#39;Index&#39;</span><span class="p">,</span> <span class="nf">(b, a, axes = null) -&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span> <span class="k">then</span> <span class="k">return</span> <span class="nf">(y, x) -&gt;</span> <span class="nx">b</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">a</span>
  <span class="nv">a = </span><span class="nx">array</span> <span class="nx">a</span>
  <span class="nv">sr = </span><span class="p">[].</span><span class="nx">concat</span> <span class="nx">a</span><span class="p">...</span>
  <span class="nx">assert</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;Indices must be a scalar or a vector, not a higher-dimensional array.&#39;</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nx">assert</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="s">&#39;The number of indices must not exceed the rank of the indexable.&#39;</span>
  <span class="nv">axes = </span><span class="k">if</span> <span class="nx">axes</span> <span class="o">is</span> <span class="kc">null</span> <span class="k">then</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">else</span> <span class="nx">array</span> <span class="nx">axes</span>
  <span class="nx">assert</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">axes</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;Axes must be a scalar or a vector, not a higher-dimensional array.&#39;</span>
  <span class="nx">assert</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">axes</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="s">&#39;The number of indices must be equal to the number of axes specified.&#39;</span>
  <span class="nv">a1 = </span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">sb</span> <span class="k">then</span> <span class="kc">null</span>
  <span class="k">for</span> <span class="nx">axis</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">axes</span>
    <span class="nx">assert</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">axis</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span> <span class="o">and</span> <span class="nx">axis</span> <span class="o">is</span> <span class="nx">floor</span> <span class="nx">axis</span><span class="p">),</span>
      <span class="s">&#39;Axes must be integers&#39;</span>
    <span class="nx">assert</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span> <span class="s">&#39;Invalid axis&#39;</span>
    <span class="nx">assert</span> <span class="o">not</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">axes</span><span class="p">[...</span><span class="nx">i</span><span class="p">],</span> <span class="nx">axis</span><span class="p">),</span> <span class="s">&#39;Duplicate axis&#39;</span>
    <span class="nx">a1</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">=</span> <span class="nx">array</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
  <span class="nv">a = </span><span class="nx">a1</span>
  <span class="k">for</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">when</span> <span class="nx">x</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span>
  <span class="k">for</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">d</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">x</span>
    <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">y</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span> <span class="o">and</span> <span class="nx">y</span> <span class="o">is</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span>
      <span class="nx">die</span> <span class="s">&#39;Indices must be integers&#39;</span>
  <span class="k">for</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">d</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">x</span> <span class="k">when</span> <span class="o">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span>
    <span class="nx">die</span> <span class="s">&#39;Index out of bounds&#39;</span>
  <span class="nv">sr = </span><span class="p">[];</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">sr = </span><span class="nx">sr</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">shapeOf</span> <span class="nx">x</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="nv">rec = </span><span class="nf">(d, i, n) -&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">n</span> <span class="o">/</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]),</span> <span class="nx">n</span> <span class="o">/</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">if</span> <span class="nx">sr</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Helper for <code>⍋</code> and <code>⍒</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">grade = </span><span class="nf">(b, a, direction) -&gt;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="o">?</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[]</span>
  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nx">assert</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s">&#39;Left argument to ⍋ or ⍒ must be non-scalar.&#39;</span>
  <span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">b</span>
  <span class="nv">n = </span><span class="nx">sa</span><span class="p">[</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># length along last axis</span>
  <span class="nv">h = </span><span class="p">{}</span> <span class="c1"># maps a character to its index in the collation</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">h</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">%</span> <span class="nx">n</span>
  <span class="nv">m = </span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">r = </span><span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">sort</span> <span class="nf">(i, j) -&gt;</span>
    <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">m</span><span class="p">]</span>
      <span class="nv">x = </span><span class="nx">b</span><span class="p">[</span><span class="nx">m</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">k</span><span class="p">]</span>
      <span class="nv">y = </span><span class="nx">b</span><span class="p">[</span><span class="nx">m</span><span class="o">*</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">k</span><span class="p">]</span>
      <span class="nv">tx = </span><span class="k">typeof</span> <span class="nx">x</span>
      <span class="nv">ty = </span><span class="k">typeof</span> <span class="nx">y</span>
      <span class="k">if</span> <span class="nx">tx</span> <span class="o">&lt;</span> <span class="nx">ty</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-</span><span class="nx">direction</span>
      <span class="k">if</span> <span class="nx">tx</span> <span class="o">&gt;</span> <span class="nx">ty</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">direction</span>
      <span class="k">if</span> <span class="nx">h</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="nv">x = </span><span class="nx">h</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">h</span><span class="p">[</span><span class="nx">y</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="nv">y = </span><span class="nx">h</span><span class="p">[</span><span class="nx">y</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">y</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-</span><span class="nx">direction</span>
      <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">y</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">direction</span>
    <span class="mi">0</span>
  <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Grade up/down (<code>⍋</code>)</p>

<pre><code>⍋13 8 122 4                          ⍝ returns 3 1 0 2
a←13 8 122 4  ◇  a[⍋a]               ⍝ returns 4 8 13 122
⍋"ZAMBIA"                            ⍝ returns 1 5 3 4 2 0
s←"ZAMBIA"  ◇  s[⍋s]                 ⍝ returns 'AABIMZ'
t←3 3⍴"BOBALFZAK"  ◇  ⍋t             ⍝ returns 1 0 2
t←3 3⍴4 5 6 1 1 3 1 1 2  ◇  ⍋t       ⍝ returns 2 1 0

t←3 3⍴4 5 6 1 1 3 1 1 2  ◇  t[⍋t;]
...    ⍝ returns (3 3 ⍴   1 1 2
...                       1 1 3
...                       4 5 6)

a←3 2 3⍴2 3 4 0 1 0 1 1 3 4 5 6 1 1 2 10 11 12  ◇  a[⍋a;;]
... ⍝ returns (3 2 3 ⍴
...      1  1  2
...     10 11 12
...
...      1  1  3
...      4  5  6
...
...      2  3  4
...      0  1  0)

a←3 2 5⍴"joe  doe  bob  jonesbob  zwart"  ◇  a[⍋a;;]
... ⍝ returns 3 2 5 ⍴ 'bob  jonesbob  zwartjoe  doe  '

"ZYXWVUTSRQPONMLKJIHGFEDCBA"⍋"ZAMBIA"   ⍝ returns 0 2 4 3 1 5

⎕A←"ABCDEFGHIJKLMNOPQRSTUVWXYZ" ◇ (⌽⎕A)⍋3 3⍴"BOBALFZAK"
... ⍝ returns 2 0 1

data←6 4⍴"ABLEaBLEACREABELaBELACES"
... coll←2 26⍴"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
... data[coll⍋data;]
...   ⍝ returns 6 4 ⍴ 'ABELaBELABLEaBLEACESACRE'

data←6 4⍴"ABLEaBLEACREABELaBELACES"
... coll1←"AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"
... data[coll1⍋data;]
...   ⍝ returns 6 4 ⍴ 'ABELABLEACESACREaBELaBLE'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⍋&#39;</span><span class="p">,</span> <span class="s">&#39;Grade up&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span> <span class="nx">grade</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Grade down (<code>⍒</code>)</p>

<pre><code>⍒3 1 8   ⍝ returns 2 0 1
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⍒&#39;</span><span class="p">,</span> <span class="s">&#39;Grade down&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span> <span class="nx">grade</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Encode (<code>⊤</code>)</p>

<pre><code>1760 3 12⊤75          ⍝ returns 2 0 3
3 12⊤75               ⍝ returns 0 3
100000 12⊤75          ⍝ returns 6 3
16 16 16 16⊤100       ⍝ returns 0 0 6 4
1760 3 12⊤75.3        ⍝ returns 2 0 (75.3−72)
0 1⊤75.3              ⍝ returns 75 (75.3−75)

2 2 2 2 2⊤1 2 3 4 5   ⍝ returns (5 5 ⍴
...                         0 0 0 0 0
...                         0 0 0 0 0
...                         0 0 0 1 1
...                         0 1 1 0 0
...                         1 0 1 0 1)

10⊤5 15 125 ⍝ returns 5 5 5
0 10⊤5 15 125 ⍝ returns 2 3⍴ 0 1 12 5 5 5

(8 3⍴ 2 0 0
...   2 0 0
...   2 0 0
...   2 0 0
...   2 8 0
...   2 8 0
...   2 8 16
...   2 8 16) ⊤ 75
...       ⍝ returns (8 3⍴
...             0 0 0
...             1 0 0
...             0 0 0
...             0 0 0
...             1 0 0
...             0 1 0
...             1 1 4
...             1 3 11)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⊤&#39;</span><span class="p">,</span> <span class="s">&#39;Encode&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nv">r = </span><span class="nb">Array</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">n = </span><span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
  <span class="nv">m = </span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">n</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">m</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">b</span>
      <span class="k">if</span> <span class="nv">isNeg = </span><span class="p">(</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="nv">y = </span><span class="o">-</span><span class="nx">y</span>
      <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">..</span> <span class="mi">0</span><span class="p">]</span> <span class="k">by</span> <span class="o">-</span><span class="mi">1</span>
        <span class="nv">x = </span><span class="nx">a</span><span class="p">[</span><span class="nx">k</span> <span class="o">*</span> <span class="nx">m</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="nx">x</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">r</span><span class="p">[(</span><span class="nx">k</span> <span class="o">*</span> <span class="nx">m</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span>
          <span class="nv">y = </span><span class="mi">0</span>
        <span class="k">else</span>
          <span class="nx">r</span><span class="p">[(</span><span class="nx">k</span> <span class="o">*</span> <span class="nx">m</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">%</span> <span class="nx">x</span>
          <span class="nv">y = </span><span class="nx">round</span><span class="p">((</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">y</span> <span class="o">%</span> <span class="nx">x</span><span class="p">))</span> <span class="o">/</span> <span class="nx">x</span><span class="p">)</span>
  <span class="nx">withShape</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">sb</span><span class="p">),</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Decode (<code>⊥</code>)</p>

<pre><code>10 ⊥ 3 2 6 9                        ⍝ returns 3269
8 ⊥ 3 1                             ⍝ returns 25
1760 3 12 ⊥ 1 2 8                   ⍝ returns 68
2 2 2 ⊥ 1                           ⍝ returns 7
0 20 12 4 ⊥ 2 15 6 3                ⍝ returns 2667
1760 3 12 ⊥ 3 3⍴1 1 1 2 0 3 0 1 8   ⍝ returns 60 37 80
60 60 ⊥ 3 13                        ⍝ returns 193
0 60 ⊥ 3 13                         ⍝ returns 193
60 ⊥ 3 13                           ⍝ returns 193
2 ⊥ 1 0 1 0                         ⍝ returns 10
2 ⊥ 1 2 3 4                         ⍝ returns 26
3 ⊥ 1 2 3 4                         ⍝ returns 58

//gives '(1j1 ⊥ 1 2 3 4) = 5j9', 1 # todo: ⊥ for complex numbers

M ← (3 8 ⍴
...                   0 0 0 0 1 1 1 1
...                   0 0 1 1 0 0 1 1
...                   0 1 0 1 0 1 0 1)
... A ← (4 3 ⍴
...                   1 1 1
...                   2 2 2
...                   3 3 3
...                   4 4 4)
... A ⊥ M
...      ⍝ returns (4 8⍴
...          0 1 1 2  1  2  2  3
...          0 1 2 3  4  5  6  7
...          0 1 3 4  9 10 12 13
...          0 1 4 5 16 17 20 21)

M ← (3 8 ⍴
...          0 0 0 0 1 1 1 1
...          0 0 1 1 0 0 1 1
...          0 1 0 1 0 1 0 1)
... 2 ⊥ M
...      ⍝ returns 0 1 2 3 4 5 6 7

M ← (3 8 ⍴
...          0 0 0 0 1 1 1 1
...          0 0 1 1 0 0 1 1
...          0 1 0 1 0 1 0 1)
... A ← 2 1 ⍴ 2 10
... A ⊥ M
...      ⍝ returns (2 8⍴
...          0 1  2  3   4   5   6   7
...          0 1 10 11 100 101 110 111)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⊥&#39;</span><span class="p">,</span> <span class="s">&#39;Decode&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">sa = </span><span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nv">lastDimA = </span><span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
  <span class="nv">firstDimB = </span><span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
  <span class="nx">assert</span> <span class="nx">lastDimA</span> <span class="o">is</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">firstDimB</span> <span class="o">is</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">lastDimA</span> <span class="o">is</span> <span class="nx">firstDimB</span><span class="p">,</span>
    <span class="s">&#39;Incompatible shapes for ⊥ (&quot;Decode&quot;)&#39;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nv">a = </span><span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">lastDimA</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">firstDimB</span><span class="p">]</span>
      <span class="nv">x = </span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">lastDimA</span> <span class="p">...</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">lastDimA</span><span class="p">]</span>
      <span class="nv">y = </span><span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">firstDimB</span><span class="p">]</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">firstDimB</span><span class="p">)]</span>
      <span class="k">if</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="nv">x = </span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">y</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">y</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="nv">y = </span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">z = </span><span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">...</span><span class="nx">y</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
        <span class="nv">z = </span><span class="nx">z</span> <span class="o">*</span> <span class="nx">x</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">z</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="nx">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">else</span>
    <span class="nx">withShape</span> <span class="nx">sa</span><span class="p">[...</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">...]),</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Format (<code>⍕</code>)</p>

<pre><code>⍕123                ⍝ returns 1 3⍴'123'
⍕123 456            ⍝ returns 1 7⍴'123 456'
⍕123 'a'            ⍝ returns 1 5⍴'123 a'
⍕12 'ab'            ⍝ returns 1 7⍴'12  ab '
⍕2 2⍴'a'            ⍝ returns 2 2⍴'a'
⍕2 2⍴5              ⍝ returns 2 3⍴,/('5 5'
...                                  '5 5')
⍕2 2⍴0 0 0 'a'      ⍝ returns 2 3⍴,/('0 0'
...                                  '0 a')
⍕2 2⍴0 0 0 'ab'     ⍝ returns 2 6⍴,/('0  0  '
...                                  '0  ab ')
⍕2 2⍴0 0 0 123      ⍝ returns 2 5⍴,/('0   0'
...                                  '0 123')
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⍕&#39;</span><span class="p">,</span> <span class="s">&#39;Format&#39;</span><span class="p">,</span> <span class="nf">(b) -&gt;</span>
  <span class="nv">t = </span><span class="nx">formatter</span><span class="p">.</span><span class="nx">format</span> <span class="nx">b</span>
  <span class="nx">withShape</span> <span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">t</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">],</span> <span class="nx">t</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="nx">dyadic</span> <span class="s">&#39;⍕&#39;</span><span class="p">,</span> <span class="s">&#39;Format by example or specification&#39;</span> <span class="c1"># todo</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Execute (<code>⍎</code>)</p>

<pre><code>⍎ '+/ 2 2 ⍴ 1 2 3 4'  ⍝ returns 3 7
⍴ ⍎ '123 456'         ⍝ returns ,2
⍎ '{⍵⋆2} ⍳5'          ⍝ returns 0 1 4 9 16
⍎ 'undefinedVariable' ⍝ fails
⍎ '1 2 (3'            ⍝ fails
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="s">&#39;⍎&#39;</span><span class="p">,</span> <span class="s">&#39;Execute&#39;</span><span class="p">,</span> <span class="nf">(b) -&gt;</span>
  <span class="nv">s = </span><span class="s">&#39;&#39;</span>
  <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">array</span> <span class="nx">b</span>
    <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">c</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span><span class="p">,</span>
      <span class="s">&#39;The argument to ⍎ must be a character or a string.&#39;</span>
    <span class="nx">s</span> <span class="o">+=</span> <span class="nx">c</span>
  <span class="nx">require</span><span class="p">(</span><span class="s">&#39;./compiler&#39;</span><span class="p">).</span><span class="nx">exec</span> <span class="nx">s</span>

<span class="nx">monadic</span> <span class="s">&#39;⊣&#39;</span><span class="p">,</span> <span class="s">&#39;Stop&#39;</span><span class="p">,</span> <span class="nf">(b) -&gt;</span> <span class="p">[]</span>
<span class="nx">dyadic</span> <span class="s">&#39;⊣&#39;</span><span class="p">,</span> <span class="s">&#39;Left&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span> <span class="nx">a</span>
<span class="nx">monadic</span> <span class="s">&#39;⊢&#39;</span><span class="p">,</span> <span class="s">&#39;Pass&#39;</span><span class="p">,</span> <span class="nf">(b) -&gt;</span> <span class="nx">b</span>
<span class="nx">dyadic</span> <span class="s">&#39;⊢&#39;</span><span class="p">,</span> <span class="s">&#39;Right&#39;</span><span class="p">,</span> <span class="nf">(b, a) -&gt;</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Zilde (<code>⍬</code>)</p>

<pre><code>⍬     ⍝ returns 0⍴0
⍴⍬    ⍝ returns ,0
⍬←5   ⍝ fails
⍳ 0   ⍝ returns ⍬
⍴ 0   ⍝ returns ⍬
⍬     ⍝ returns ⍬
⍬⍬    ⍝ returns ⍬ ⍬
1⍬2⍬3 ⍝ returns 1 ⍬ 2 ⍬ 3
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">@</span><span class="p">[</span><span class="s">&#39;get_⍬&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">[]</span>
<span class="nx">@</span><span class="p">[</span><span class="s">&#39;set_⍬&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="nx">die</span> <span class="s">&#39;Symbol zilde (⍬) is read-only.&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Index origin (<code>⎕IO</code>)</p>

<p>The index origin is fixed at 0.  Reading it returns 0.  Attempts to set it
to anything other than that fail.</p>

<pre><code>⎕IO     ⍝ returns 0
⎕IO←0   ⍝ returns 0
⎕IO←1   ⍝ fails
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">@</span><span class="p">[</span><span class="s">&#39;get_⎕IO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="mi">0</span>
<span class="nx">@</span><span class="p">[</span><span class="s">&#39;set_⎕IO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(x) -&gt;</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s">&#39;The index origin (⎕IO) is fixed at 0&#39;</span> <span class="k">else</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <h1>Built-in adverbs and conjunctions</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Helper for <code>/</code> and <code>⌿</code> in their adverbial sense</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">reduce = </span><span class="nf">(f, _, axis = -1) -&gt;</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nv">invokedAsMonadic = </span><span class="o">not</span> <span class="nx">a</span><span class="o">?</span>
  <span class="k">if</span> <span class="nx">invokedAsMonadic</span> <span class="k">then</span> <span class="nv">a = </span><span class="mi">0</span>
  <span class="nv">a = </span><span class="nx">floor</span> <span class="nx">num</span> <span class="nx">a</span>
  <span class="nv">isBackwards = </span><span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="k">if</span> <span class="nx">isBackwards</span> <span class="k">then</span> <span class="nv">a = </span><span class="o">-</span><span class="nx">a</span>
  <span class="nv">b = </span><span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="p">[</span><span class="nx">b</span><span class="p">]</span> <span class="k">else</span> <span class="nx">b</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s">&#39;Invalid axis&#39;</span>
  <span class="nv">n = </span><span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nv">a = </span><span class="nx">n</span>
  <span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
    <span class="nv">items = </span><span class="nx">b</span>
  <span class="k">else</span>
    <span class="nv">sItem = </span><span class="nx">sb</span><span class="p">[...</span><span class="nx">axis</span><span class="p">].</span><span class="nx">concat</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span> <span class="c1"># shape of an item</span>
    <span class="nv">k = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>
    <span class="nv">items = </span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">n</span><span class="p">]</span> <span class="k">then</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">items</span><span class="p">[</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">)</span> <span class="o">%</span> <span class="nx">n</span><span class="p">].</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">n</span><span class="p">]</span> <span class="k">then</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">withShape</span> <span class="nx">sItem</span><span class="p">,</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
  <span class="nv">r =</span>
    <span class="k">if</span> <span class="nx">isBackwards</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">n</span> <span class="o">-</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="nv">x = </span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">...</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">by</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nv">x = </span><span class="nx">f</span> <span class="nx">items</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">x</span>
        <span class="nx">x</span>
    <span class="k">else</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">n</span> <span class="o">-</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="nv">x = </span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">a</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="k">then</span> <span class="nv">x = </span><span class="nx">f</span> <span class="nx">items</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">x</span>
        <span class="nx">x</span>
  <span class="k">if</span> <span class="nx">invokedAsMonadic</span> <span class="k">then</span> <span class="nx">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Helper for <code>/</code> and <code>⌿</code> in their verbal sense</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">compressOrReplicate = </span><span class="nf">(b, a, axis = -1) -&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nv">b = </span><span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s">&#39;Axis out of bounds&#39;</span>
  <span class="nv">sr = </span><span class="nx">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">...]</span>
  <span class="nx">sr</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nx">assert</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;Left argument to / must be an integer or a vector of integers&#39;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nv">a = </span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">a</span>

  <span class="nv">nNonNegative = </span><span class="mi">0</span> <span class="c1"># number of non-negative elements in a</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
    <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span> <span class="o">and</span> <span class="nx">x</span> <span class="o">is</span> <span class="nx">floor</span> <span class="nx">x</span><span class="p">,</span>
      <span class="s">&#39;Left argument to / must be an integer or a vector of integers&#39;</span>
    <span class="nx">sr</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">abs</span> <span class="nx">x</span>
    <span class="nx">nNonNegative</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

  <span class="nv">isExtensive = </span><span class="kc">true</span><span class="p">;</span> <span class="nv">isExpansive = isHyperexpansive = </span><span class="kc">false</span>
  <span class="k">if</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">isnt</span> <span class="mi">1</span>
    <span class="nv">isExtensive = </span><span class="kc">false</span>
    <span class="nv">isExpansive = </span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
    <span class="nv">isHyperexpansive = </span><span class="o">not</span> <span class="nx">isExpansive</span>
    <span class="nx">assert</span><span class="p">((</span><span class="o">not</span> <span class="nx">isHyperexpansive</span><span class="p">)</span> <span class="o">or</span> <span class="nx">nNonNegative</span> <span class="o">is</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">],</span>
      <span class="s">&#39;For A/B, the length of B along the selected axis &#39;</span> <span class="o">+</span>
      <span class="s">&#39;must be equal either to one, &#39;</span> <span class="o">+</span>                 <span class="c1"># extension</span>
      <span class="s">&#39;or the length of A, &#39;</span> <span class="o">+</span>                          <span class="c1"># expansion</span>
      <span class="s">&#39;or to the number of non-negative elements in A.&#39;</span> <span class="c1"># hyperexpansion</span>
    <span class="p">)</span>
  <span class="nv">r = </span><span class="p">[]</span>
  <span class="nv">ni = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[...</span> <span class="nx">axis</span><span class="p">]</span>
  <span class="nv">nj = </span><span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nv">nk = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">ni</span><span class="p">]</span>
    <span class="nv">j = </span><span class="mi">0</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
      <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">x</span><span class="p">]</span>
          <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span><span class="o">*</span><span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">)]</span>
        <span class="nx">j</span> <span class="o">+=</span> <span class="nx">isExpansive</span> <span class="o">or</span> <span class="nx">isHyperexpansive</span>
      <span class="k">else</span>
        <span class="nv">filler = </span><span class="nx">prototypeOf</span><span class="p">(</span>
          <span class="k">if</span> <span class="nx">isExpansive</span> <span class="k">then</span> <span class="p">[</span><span class="nx">b</span><span class="p">[</span><span class="nx">nk</span><span class="o">*</span><span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">)]]</span> <span class="k">else</span> <span class="p">[</span><span class="nx">b</span><span class="p">[</span><span class="nx">nk</span><span class="o">*</span><span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="o">-</span><span class="nx">x</span><span class="o">*</span><span class="nx">nk</span><span class="p">]</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
        <span class="nx">j</span> <span class="o">+=</span> <span class="nx">isExpansive</span>

  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Reduce, compress, or replicate (<code>/</code>)</p>

<p>Reduce</p>

<pre><code>+/ 3                       ⍝ returns 3
+/ 3 5 8                   ⍝ returns 16
+/ 2 4 6                   ⍝ returns 12
⌈/ 82 66 93 13             ⍝ returns 93
×/ 2 3 ⍴ 1 2 3 4 5 6       ⍝ returns 6 120
2 ,/ 'AB' 'CD' 'EF' 'HI'   ⍝ returns 'ABCD' 'CDEF' 'EFHI'
3 ,/ 'AB' 'CD' 'EF' 'HI'   ⍝ returns 'ABCDEF' 'CDEFHI'
</code></pre>

<p>N-Wise reduce</p>

<pre><code>2 +/ 1 + ⍳10    ⍝ returns 3 5 7 9 11 13 15 17 19
5 +/ 1 + ⍳10    ⍝ returns 15 20 25 30 35 40
10 +/ 1 + ⍳10   ⍝ returns ,55
11 +/ 1 + ⍳10   ⍝ returns ⍬
2 −/ 3 4 9 7    ⍝ returns ¯1 ¯5 2
¯2 −/ 3 4 9 7   ⍝ returns 1 5 ¯2
</code></pre>

<p>Compress</p>

<pre><code>0 1 0 1 / 'ABCD'                                ⍝ returns 'BD'
1 1 1 1 0 / 12 14 16 18 20                      ⍝ returns 12 14 16 18
MARKS←45 60 33 50 66 19 ◇ (MARKS≥50)/MARKS      ⍝ returns 60 50 66
MARKS←45 60 33 50 66 19 ◇ (MARKS=50)/⍳↑⍴MARKS   ⍝ returns ,3
1/"FREDERIC"                                    ⍝ returns 'FREDERIC'
0/"FREDERIC"                                    ⍝ returns ⍬
0 1 0  / 1+2 3⍴⍳6                               ⍝ returns 2 1 ⍴ 2 5
1 0 /[0] 1+2 3⍴⍳6                               ⍝ returns 1 3 ⍴ 1 2 3
1 0 ⌿    1+2 3⍴⍳6                               ⍝ returns 1 3 ⍴ 1 2 3
3 / 5                                           ⍝ returns 5 5 5
</code></pre>

<p>Replicate</p>

<pre><code>2 ¯2 2 / 1+2 3⍴⍳6
... ⍝ returns 2 6 ⍴  1 1 0 0 3 3  4 4 0 0 6 6
2 ¯2 2 ¯2 2 / 1+2 3⍴⍳6
... ⍝ returns 2 10 ⍴  1 1 0 0 2 2 0 0 3 3  4 4 0 0 5 5 0 0 6 6
1 1 ¯2 1 1 / 1 2 (2 2⍴⍳4) 3 4     ⍝ returns 1 2 (2 2⍴0) (2 2⍴0) 3 4
1 1 ¯2 1 1 1 / 1 2 (2 2⍴⍳4) 3 4   ⍝ returns 1 2 0 0 (2 2⍴0 1 2 3) 3 4
2 3 2 / "ABC"             ⍝ returns 'AABBBCC'
2 / "DEF"                 ⍝ returns 'DDEEFF'
5 0 5 / 1 2 3             ⍝ returns 1 1 1 1 1 3 3 3 3 3
2 / 1+2 3⍴⍳6              ⍝ returns 2 6 ⍴  1 1 2 2 3 3  4 4 5 5 6 6
2 ⌿ 1+2 3⍴⍳6              ⍝ returns 4 3 ⍴  1 2 3  1 2 3  4 5 6  4 5 6
2 3 / 3 1⍴"ABC"           ⍝ returns 3 5 ⍴ 'AAAAABBBBBCCCCC'
2 ¯1 2 /[1] 3 1⍴(7 8 9)   ⍝ returns 3 5 ⍴ 7 7 0 7 7 8 8 0 8 8 9 9 0 9 9
2 ¯1 2 /[1] 3 1⍴"ABC"     ⍝ returns 3 5 ⍴ 'AA AABB BBCC CC'
2 ¯2 2 / 7                ⍝ returns 7 7 0 0 7 7
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixAdverb</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;Reduce, compress, or replicate&#39;</span><span class="p">,</span> <span class="nf">(b, a, axis = -1) -&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
    <span class="nx">reduce</span> <span class="nx">b</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span>
  <span class="k">else</span>
    <span class="nx">compressOrReplicate</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>1st axis reduce, compress, or replicate (<code>⌿</code>)</p>

<pre><code>+⌿ 2 3 ⍴ 1 2 3 10 20 30   ⍝ returns 11 22 33
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixAdverb</span> <span class="s">&#39;⌿&#39;</span><span class="p">,</span> <span class="s">&#39;1st axis reduce, compress, or replicate&#39;</span><span class="p">,</span>
  <span class="nf">(b, a, axis = 0) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
      <span class="nx">reduce</span> <span class="nx">b</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span>
    <span class="k">else</span>
      <span class="nx">compressOrReplicate</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Helper for <code>\</code> and <code>⍀</code> in their adverbial sense</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">scan = </span><span class="nf">(f, _, axis = -1) -&gt;</span> <span class="nf">(b, a) -&gt;</span>
  <span class="nx">assert</span> <span class="o">not</span> <span class="nx">a</span><span class="o">?</span><span class="p">,</span> <span class="s">&#39;Scan can only be applied monadically.&#39;</span>
  <span class="nv">sb = </span><span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s">&#39;Invalid axis&#39;</span>
  <span class="nv">r = </span><span class="nb">Array</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">ni = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[...</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nv">nj = </span><span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nv">nk = </span><span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">ni</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nj</span><span class="p">]</span>
        <span class="nv">ijk = </span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">nj</span> <span class="o">+</span> <span class="nx">j</span><span class="p">)</span> <span class="o">*</span> <span class="nx">nk</span> <span class="o">+</span> <span class="nx">k</span>
        <span class="nv">x = </span><span class="nx">b</span><span class="p">[</span><span class="nx">ijk</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">t</span> <span class="k">in</span> <span class="p">[</span><span class="nx">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">..</span><span class="mi">0</span><span class="p">]</span> <span class="k">by</span> <span class="o">-</span><span class="mi">1</span>
          <span class="nv">x = </span><span class="nx">f</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">b</span><span class="p">[(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">nj</span> <span class="o">+</span> <span class="nx">t</span><span class="p">)</span> <span class="o">*</span> <span class="nx">nk</span> <span class="o">+</span> <span class="nx">k</span><span class="p">]</span>
        <span class="nx">r</span><span class="p">[</span><span class="nx">ijk</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span>
  <span class="nx">withShape</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Helper for <code>\</code> and <code>⍀</code> in their verbal sense</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">expand = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>todo</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Scan or expand (<code>\</code>)</p>

<pre><code>+\ 20 10 ¯5 7              ⍝ returns 20 30 25 32
,\ "AB" "CD" "EF"          ⍝ returns 'AB' 'ABCD' 'ABCDEF'
×\ 2 3⍴5 2 3 4 7 6         ⍝ returns 2 3 ⍴ 5 10 30 4 28 168
∧\ 1 1 1 0 1 1             ⍝ returns 1 1 1 0 0 0
//gives '−\1 2 3 4', [1, -1, 2, -2] # todo
∨\ 0 0 1 0 0 1 0           ⍝ returns 0 0 1 1 1 1 1
+\ 1 2 3 4 5               ⍝ returns 1 3 6 10 15
+\ (1 2 3)(4 5 6)(7 8 9)   ⍝ returns (1 2 3) (5 7 9) (12 15 18)
M←2 3⍴1 2 3 4 5 6 ◇ +\M    ⍝ returns 2 3 ⍴ 1 3 6 4 9 15
M←2 3⍴1 2 3 4 5 6 ◇ +⍀M    ⍝ returns 2 3 ⍴ 1 2 3 5 7 9
//gives 'M←2 3⍴1 2 3 4 5 6 ◇ +\[0]M', [1, 2, 3, 5, 7, 9] # todo
,\ 'ABC'                   ⍝ returns (↑'A') 'AB' 'ABC'
T←"ONE(TWO) BOOK(S)" ◇ ≠\T∈"()"
... ⍝ returns 0 0 0 1 1 1 1 0 0 0 0 0 0 1 1 0
T←"ONE(TWO) BOOK(S)" ◇ ((T∈"()")⍱≠\T∈"()")/T   ⍝ returns 'ONE BOOK'
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixAdverb</span> <span class="s">&#39;\\&#39;</span><span class="p">,</span> <span class="s">&#39;Scan or expand&#39;</span><span class="p">,</span> <span class="nf">(b, a, axis = -1) -&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
    <span class="nx">scan</span> <span class="nx">b</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span>
  <span class="k">else</span>
    <span class="nx">expand</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>1st axis scan or expand (<code>⍀</code>)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixAdverb</span> <span class="s">&#39;⍀&#39;</span><span class="p">,</span> <span class="s">&#39;1st axis scan or expand&#39;</span><span class="p">,</span> <span class="nf">(b, a, axis = 0) -&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">b</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
    <span class="nx">scan</span> <span class="nx">b</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span>
  <span class="k">else</span>
    <span class="nx">expand</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Each (<code>¨</code>)</p>

<pre><code>⍴¨ (0 0 0 0) (0 0 0)                 ⍝ returns (,4) (,3)
⍴¨ "MONDAY" "TUESDAY"                ⍝ returns (,6) (,7)
⍴    (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴"K")   ⍝ returns ,4
⍴¨   (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴"K")   ⍝ returns (2 2) (,10) ⍬ (3 4)
⍴⍴¨  (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴"K")   ⍝ returns ,4
⍴¨⍴¨ (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴"K")   ⍝ returns (,2) (,1) (,0) (,2)
(1 2 3) ,¨ 4 5 6                     ⍝ returns (1 4) (2 5) (3 6)
2 3 ↑¨ 'MONDAY' 'TUESDAY'            ⍝ returns 'MO' 'TUE'
2 ↑¨ 'MONDAY' 'TUESDAY'              ⍝ returns 'MO' 'TU'
2 3 ⍴¨ 1 2                           ⍝ returns (1 1) (2 2 2)
4 5 ⍴¨ "THE" "CAT"                   ⍝ returns 'THET' 'CATCA'
{1+⍵⋆2}¨ 2 3 ⍴ ⍳ 6                   ⍝ returns 2 3 ⍴ 1 2 5 10 17 26
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixAdverb</span> <span class="s">&#39;¨&#39;</span><span class="p">,</span> <span class="s">&#39;Each&#39;</span><span class="p">,</span> <span class="nf">(f) -&gt;</span> <span class="nf">(b, a) -&gt;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="o">?</span>
    <span class="k">return</span> <span class="nx">withShape</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">array</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span>
    <span class="k">return</span> <span class="nx">withShape</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">array</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">match</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">withShape</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">withShape</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">if</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nx">withShape</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">x</span><span class="p">)</span>
  <span class="nx">die</span> <span class="s">&#39;Length error&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Outer product</p>

<pre><code>2 3 4 ∘.× 1 2 3 4
...     ⍝ returns (3 4⍴
...         2 4  6  8
...         3 6  9 12
...         4 8 12 16)

0 1 2 3 4 ∘.! 0 1 2 3 4
...     ⍝ returns (5 5⍴
...         1 1 1 1 1
...         0 1 2 3 4
...         0 0 1 3 6
...         0 0 0 1 4
...         0 0 0 0 1)

1 2 ∘., 1+⍳3
...     ⍝ returns (2 3⍴
...         (1 1) (1 2) (1 3)
...         (2 1) (2 2) (2 3))

⍴ 1 2 ∘., 1+⍳3   ⍝ returns 2 3

2 3 ∘.↑ 1 2
...     ⍝ returns (2 2⍴
...           (1 0)   (2 0)
...         (1 0 0) (2 0 0))

⍴ 2 3 ∘.↑ 1 2     ⍝ returns 2 2
⍴ ((4 3 ⍴ 0) ∘.+ (5 2 ⍴ 0))   ⍝ returns 4 3 5 2
2 3 ∘.× 4 5       ⍝ returns 2 2⍴ 8 10 12 15
2 3 ∘.{⍺×⍵} 4 5   ⍝ returns 2 2⍴ 8 10 12 15
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">prefixAdverb</span> <span class="s">&#39;∘.&#39;</span><span class="p">,</span> <span class="s">&#39;Outer product&#39;</span><span class="p">,</span> <span class="nv">outerProduct = </span><span class="nf">(f) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nf">(b, a) -&gt;</span>
    <span class="nx">assert</span> <span class="nx">a</span><span class="o">?</span><span class="p">,</span> <span class="s">&#39;Adverb ∘. (Outer product) can be applied to dyadic verbs only&#39;</span>
    <span class="nv">a = </span><span class="nx">array</span> <span class="nx">a</span>
    <span class="nv">b = </span><span class="nx">array</span> <span class="nx">b</span>
    <span class="nv">r = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">f</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">x</span>
    <span class="nx">withShape</span> <span class="p">(</span><span class="nx">shapeOf</span> <span class="nx">a</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">shapeOf</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Inner product (<code>.</code>)</p>

<p>todo: the general formula for higher dimensions is
<code>A f.g B   &lt;=&gt;   f/¨ (⊂[⍴⍴A]A)∘.g ⊂[1]B</code></p>

<pre><code>(1 3 5 7) +.= 2 3 6 7   ⍝ returns 2
(1 3 5 7) ∧.= 2 3 6 7   ⍝ returns 0
(1 3 5 7) ∧.= 1 3 5 7   ⍝ returns 1
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">conjunction</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;Inner product&#39;</span><span class="p">,</span> <span class="nf">(g, f) -&gt;</span>
  <span class="nv">F = </span><span class="nx">reduce</span> <span class="nx">f</span>
  <span class="nf">(b, a) -&gt;</span>
    <span class="nx">assert</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s">&#39;Inner product (.) is implemented only for &#39;</span> <span class="o">+</span>
      <span class="s">&#39;arrays of rank no more than 1.&#39;</span>
    <span class="nx">F</span> <span class="nx">g</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Power operator (<code>⍣</code>)</p>

<pre><code>({⍵+1}⍣5) 3     ⍝ returns 8
({⍵+1}⍣0) 3     ⍝ returns 3
(⍴⍣3) 2 2⍴⍳4    ⍝ returns ,1
'a' (,⍣3) 'b'   ⍝ returns 'aaab'
1(+÷)⍣=1        ⍝ returns 1.618033988749895
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">conjunction</span> <span class="s">&#39;⍣&#39;</span><span class="p">,</span> <span class="s">&#39;Power operator&#39;</span><span class="p">,</span> <span class="nf">(g, f) -&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">g</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
    <span class="nv">h = </span><span class="nx">f</span><span class="p">;</span> <span class="nv">f = </span><span class="nx">g</span><span class="p">;</span> <span class="nv">g = </span><span class="nx">h</span>
  <span class="k">else</span>
    <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">g</span> <span class="o">is</span> <span class="s">&#39;number&#39;</span>
    <span class="nf">(y, x) -&gt;</span>
      <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">g</span><span class="p">]</span> <span class="k">then</span> <span class="nv">y = </span><span class="nx">f</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">x</span>
      <span class="nx">y</span>
  <span class="k">else</span>
    <span class="nf">(y, x) -&gt;</span>
      <span class="nx">loop</span>
        <span class="nv">y1 = </span><span class="nx">f</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">x</span>
        <span class="k">if</span> <span class="nx">g</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">y1</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">y</span>
        <span class="nv">y = </span><span class="nx">y1</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p><a href="http://www.jsoftware.com/papers/opfns1.htm#3">Commute</a> (<code>⍨</code>)</p>

<p>Definition: <code>x f⍨ y  &lt;-&gt;  y f x</code></p>

<pre><code>17 −⍨ 23    ⍝ returns 6
7 ⍴⍨ 2 3    ⍝ returns 2 3⍴7
−⍨ 123      ⍝ returns ¯123
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixAdverb</span> <span class="s">&#39;⍨&#39;</span><span class="p">,</span> <span class="s">&#39;Commute&#39;</span><span class="p">,</span> <span class="nf">(f) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nf">(b, a) -&gt;</span> <span class="k">if</span> <span class="nx">a</span><span class="o">?</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="k">else</span> <span class="nx">f</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p><code>⎕</code> and <code>⍞</code> will be overridden for the web.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">@</span><span class="p">[</span><span class="s">&#39;set_⎕&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(x) -&gt;</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">require</span><span class="p">(</span><span class="s">&#39;./formatter&#39;</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;\n&#39;</span><span class="p">;</span> <span class="nx">x</span>
<span class="nx">@</span><span class="p">[</span><span class="s">&#39;get_⎕&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span>
  <span class="nx">die</span> <span class="s">&#39;Reading from ⎕ is not implemented.&#39;</span>
<span class="nx">@</span><span class="p">[</span><span class="s">&#39;set_⍞&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(x) -&gt;</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">require</span><span class="p">(</span><span class="s">&#39;./formatter&#39;</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">);</span> <span class="nx">x</span>
<span class="nx">@</span><span class="p">[</span><span class="s">&#39;get_⍞&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span>
  <span class="nx">die</span> <span class="s">&#39;Reading from ⍞ is not implemented.&#39;</span>

<span class="nx">@</span><span class="p">[</span><span class="s">&#39;⎕aplify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(x) -&gt;</span>
  <span class="nx">assert</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="kc">null</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="s">&#39;undefined&#39;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span> <span class="o">and</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">1</span>
    <span class="nv">x = </span><span class="nx">withPrototype</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39;&#39;</span>
  <span class="nx">x</span>

<span class="nx">@</span><span class="p">[</span><span class="s">&#39;⎕bool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">bool</span>

<span class="nx">@</span><span class="p">[</span><span class="s">&#39;⎕complex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s">&#39;./complex&#39;</span><span class="p">).</span><span class="nx">Complex</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p><a href="http://www.jsoftware.com/papers/fork1.htm">Phrasal forms</a></p>

<p>Hook: <code>(fg)⍵ ←→ ⍵fg⍵</code> ; <code>⍺(fg)⍵ ←→ ⍺fg⍵</code></p>

<pre><code># Approximations of pi through continued fractions
(+÷)\3 7 16 ¯294
... ⍝ returns (3
...            3.142857142857143
...            3.1415929203539825
...            3.141592653921421)

# Test if a number is an integer
(=⌊) 123     ⍝ returns 1
(=⌊) 123.4   ⍝ returns 0

# Approximation of the number of primes below a certain limit
(÷⍟) 1000    ⍝ returns 144.76482730108395
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">@</span><span class="p">[</span><span class="s">&#39;⎕hook&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(g, f) -&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">g</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nf">(b, a) -&gt;</span> <span class="nx">f</span> <span class="nx">g</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="p">(</span><span class="nx">a</span> <span class="o">?</span> <span class="nx">b</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Fork: <code>(fgh)⍵ ←→ (f⍵)g(h⍵)</code> ; <code>⍺(fgh)⍵ ←→ (⍺f⍵)g(⍺h⍵)</code></p>

<pre><code># Arithmetic mean
avg ← +/ ÷ ⍴   ◇ avg 4 5 10 7   ⍝ returns 6.5

# Quadratic equation
a←1 ◇ b←¯22 ◇ c←85
... √ ← {⍵⋆.5}
... ((−b)(+,−)√(b⋆2)−4×a×c) ÷ 2×a
... ⍝ returns 17 5

# Trains (longer forks)
(+,−,×,÷) 2     ⍝ returns 2 ¯2 1 .5
1 (+,−,×,÷) 2   ⍝ returns 3 ¯1 2 .5
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">@</span><span class="p">[</span><span class="s">&#39;⎕fork&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nf">(verbs) -&gt;</span>
  <span class="nx">assert</span> <span class="nx">verbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">is</span> <span class="mi">1</span>
  <span class="nx">assert</span> <span class="nx">verbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">3</span>
  <span class="k">for</span> <span class="nx">f</span> <span class="k">in</span> <span class="nx">verbs</span> <span class="k">then</span> <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
  <span class="nf">(b, a) -&gt;</span>
    <span class="nv">r = </span><span class="nx">verbs</span><span class="p">[</span><span class="nx">verbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">verbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">...</span> <span class="mi">0</span><span class="p">]</span> <span class="k">by</span> <span class="o">-</span><span class="mi">2</span>
      <span class="nv">r = </span><span class="nx">verbs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">verbs</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span>
    <span class="nx">r</span>

<span class="nx">endOfVocabulary</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 