<!DOCTYPE html>

<html>
<head>
  <title>vocabulary.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="apl.html">
                apl.coffee
              </a>
            
              
              <a class="source" href="command.html">
                command.coffee
              </a>
            
              
              <a class="source" href="compiler.html">
                compiler.coffee
              </a>
            
              
              <a class="source" href="complex.html">
                complex.coffee
              </a>
            
              
              <a class="source" href="formatter.html">
                formatter.coffee
              </a>
            
              
              <a class="source" href="helpers.html">
                helpers.coffee
              </a>
            
              
              <a class="source" href="lexer.html">
                lexer.coffee
              </a>
            
              
              <a class="source" href="parser.html">
                parser.coffee
              </a>
            
              
              <a class="source" href="vocabulary.html">
                vocabulary.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>vocabulary.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p><code>vocabulary.coffee</code> is our big mama implementation of APL&#39;s built-in verbs,
adverbs, conjunctions, and pronouns, with a propensity to grow morbidly
obese.</p>
<h1>JavaScript representation of APL arrays</h1>
<p>APL&#39;s data structures are multidimensional arrays:</p>
<ul>
<li><p>(rank 0) Scalars—they can be:</p>
<ul>
<li><p>simple scalars, like numbers and characters</p>
</li>
<li><p>a <em>boxed</em> APL array of rank zero, containing exactly one element</p>
</li>
</ul>
</li>
<li><p>(rank 1) Vectors—sequences of APL objects with zero or more elements</p>
</li>
<li><p>(rank 2) Matrices—two-dimensional arrays of APL objects</p>
</li>
<li><p>(rank 3+) Cubes, tesseracts, and higher-delusional stuff.</p>
</li>
</ul>
<p>APL arrays are not necessarily homogenous, they may contain data of mixed
types.</p>
<p>An array in APL is aware of its own dimensions, so there is an essential
difference between a vector of vectors and a matrix.  To reflect this in
JavaScript objects, we use the following convention:</p>
<ul>
<li><p>APL scalars:</p>
<ul>
<li><p>Simple scalars: APL numbers are JavaScript numbers and APL characters
are JavaScript one-character strings.</p>
</li>
<li><p>A rank-zero APL array is a JavaScript array of size one with a
<code>shape</code> property of <code>[]</code>, e.g. created by:</p>
<pre><code>  var a = [123]; a.shape = [];</code></pre>
</li>
</ul>
</li>
<li><p>An APL vector is a JavaScript array.</p>
</li>
<li><p>An APL matrix, cube, etc is a JavaScript array with an additional <code>shape</code>
property, describing the dimensions of the APL array.  E.g. a 2-by-2-by-3
cube of zeroes may be constructed via:</p>
<pre><code>  function createSomeCube() {
      var cube = [
          0, // Element at indices [0;0;0]
          0, // Element at indices [0;0;1]
          // ... indices iterated in lexicographic order ...
          0  // Element at indices [1;1;2]
      ];
      cube.shape = [2, 2, 3];
      return cube;
  }</code></pre>
<p>A vector&#39;s representation, as opposed to that of higher-dimensional
arrays, is not required to have a <code>shape</code> property.  The shape of a
vector <code>v</code> is assumed to be <code>[v.length]</code> by convention.  Similarly, we
could say that a scalar&#39;s shape is <code>[]</code> by convention.</p>
</li>
</ul>
<h2>APL prototypes</h2>
<p>Every object in APL, including empty arrays, has an <em>prototype</em>, used
whenever &quot;padding material&quot; is needed, such as in the <em>take</em> verb:</p>
<pre><code>5 ↑ 1 2 3     ⍝ returns      1 2 3 0 0
5 ↑ &#39;abc&#39;     ⍝ returns      &#39;abc  &#39;</code></pre>
<p>Prototypes are defined recursively:</p>
<ul>
<li><p>For numbers, the prototype is <code>0</code>.</p>
</li>
<li><p>For characters, the prototype is a space, <code>&#39; &#39;</code>.</p>
</li>
<li><p>For non-empty arrays, the prototype is the prototype of the first
element, repeated and arranged to fit the first element&#39;s shape.  E.g. the
prototype of <code>((1 2) &#39;a&#39; (1 2 3))</code> is <code>(0 0)</code>.</p>
</li>
<li><p>For empty arrays, the prototype is determined by the operation used to
construct the array.  Usually it is copied from another array.</p>
</li>
</ul>
<p>To represent this in JavaScript, we simply use the first elements of arrays
and calculate it dynamically.  For empty arrays, we put an additional
<code>aplPrototype</code> property on the array, like so:</p>
<pre><code>var a = [];
a.aplPrototype = &#39; &#39;;

var b = [];
b.aplPrototype = [0, 0, 0, 0];
b.aplPrototype.shape = [2, 2];</code></pre>
<p>If an empty array has a prototype of <code>0</code>, we can skip <code>aplPrototype</code> and
leave <code>0</code> as an implicit default.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>{assert, die, inherit, isSimple, shapeOf, withShape, prod, prototypeOf,
  withPrototype, withPrototypeCopiedFrom, enc, dec} = require <span class="string">'./helpers'</span>
{min, max, floor, ceil, round, abs, random, exp, pow, log, PI, sqrt, sin,
  cos, tan, asin, acos, atan} = Math
formatter = require <span class="string">'./formatter'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>Type coersion helpers</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">array</span></span> = (x) -&gt;
  <span class="keyword">if</span> isSimple x <span class="keyword">then</span> (x = [x]).shape = []
  x

<span class="function"><span class="title">num</span></span> = (x) -&gt;
  <span class="keyword">if</span> x.length?
    assert x.length <span class="keyword">is</span> <span class="number">1</span>, <span class="string">'Numeric scalar or singleton expected'</span>
    x = x[<span class="number">0</span>]
  assert <span class="keyword">typeof</span> x <span class="keyword">is</span> <span class="string">'number'</span>, <span class="string">'Numeric scalar or singleton expected'</span>
  x

<span class="function"><span class="title">bool</span></span> = (x) -&gt;
  x = num x
  assert x <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>], <span class="string">'Boolean values must be either 0 or 1'</span>
  x</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h1>DSL for defining built-in symbols</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>tmp = monadic: {}, dyadic: {}

<span class="function"><span class="title">def</span></span> = (h, name, description, f) -&gt;
  assert <span class="keyword">typeof</span> name <span class="keyword">is</span> <span class="string">'string'</span>
  assert <span class="keyword">typeof</span> description <span class="keyword">is</span> <span class="string">'string'</span>
  f ?= -&gt; die <span class="string">"Verb <span class="subst">#{name}</span> <span class="subst">#{description}</span> is not implemented."</span>
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  assert <span class="keyword">not</span> h[name]?, <span class="string">"Redefinition of verb <span class="subst">#{name}</span> <span class="subst">#{description}</span>"</span>
  h[name] = f

<span class="function"><span class="title">monadic</span></span> = (a...) -&gt; def tmp.monadic, a...
<span class="function"><span class="title">dyadic</span></span> = (a...) -&gt; def tmp.dyadic, a...
<span class="function"><span class="title">prefixAdverb</span></span> = (a...) -&gt;
  ((def tmp.monadic, a...).aplMetaInfo ?= {}).isPrefixAdverb = <span class="literal">true</span>
<span class="function"><span class="title">postfixAdverb</span></span> = (a...) -&gt;
  ((def tmp.monadic, a...).aplMetaInfo ?= {}).isPostfixAdverb = <span class="literal">true</span>
<span class="function"><span class="title">conjunction</span></span> = (a...) -&gt;
  ((def tmp.dyadic,  a...).aplMetaInfo ?= {}).isConjunction = <span class="literal">true</span>

<span class="function"><span class="title">withMetaInfoFrom</span></span> = (f, g) -&gt;
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  assert <span class="keyword">typeof</span> g <span class="keyword">is</span> <span class="string">'function'</span>
  g.aplMetaInfo = <span class="keyword">if</span> f.aplMetaInfo <span class="keyword">then</span> inherit f.aplMetaInfo <span class="keyword">else</span> {}
  g</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Overloadable verbs</p>
<pre><code>x ← «{&#39;⍟&#39;: function (y) { return y + 1234; }}» ◇ x ⍟ 1
... ⍝ returns 1235
x ← «{&#39;right_⍟&#39;: function (y) { return y + 1234; }}» ◇ 1 ⍟ x
... ⍝ returns 1235
x ← «{&#39;⍟&#39;: function (y) { return y + 1234; }}» ◇ x ⍟ 1 1
... ⍝ returns 1235 1235
x ← «{&#39;⍟&#39;: function (y) { return y + 1234; }}» ◇ x x ⍟ 1
... ⍝ returns 1235 1235
x ← «{&#39;⍟&#39;: function () { return 1234; }}» ◇ ⍟ x
... ⍝ returns 1234
x ← «{&#39;⍟&#39;: function () { return 1234; }}» ◇ ⍟ x
... ⍝ returns 1234
x ← «{&#39;⍟&#39;: function () { return 1234; }}» ◇ ⍟ x x
... ⍝ returns 1234 1234</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">overloadable</span></span> = (symbol, f) -&gt;
  assert <span class="keyword">typeof</span> symbol <span class="keyword">is</span> <span class="string">'string'</span>
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  withMetaInfoFrom f,
    (b, a, args...) -&gt;
      <span class="keyword">if</span> <span class="keyword">not</span> a? <span class="comment"># monadic application</span>
        <span class="keyword">if</span> <span class="keyword">typeof</span> b?[symbol] <span class="keyword">is</span> <span class="string">'function'</span> <span class="keyword">then</span> b[symbol] args...
        <span class="keyword">else</span> f b, a, args...
      <span class="keyword">else</span> <span class="comment"># dyadic application</span>
        <span class="keyword">if</span> <span class="keyword">typeof</span> a?[symbol] <span class="keyword">is</span> <span class="string">'function'</span>
          a[symbol] b, args...
        <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">typeof</span> b?[<span class="string">'right_'</span> + symbol] <span class="keyword">is</span> <span class="string">'function'</span>
          b[<span class="string">'right_'</span> + symbol] a, args...
        <span class="keyword">else</span>
          f b, a, args...

<span class="function"><span class="title">ambivalent</span></span> = (symbol, f1, f2) -&gt;
  assert <span class="keyword">typeof</span> symbol <span class="keyword">is</span> <span class="string">'string'</span>
  <span class="keyword">if</span> <span class="keyword">not</span> (f1 <span class="keyword">and</span> f2) <span class="keyword">then</span> <span class="keyword">return</span> f1 <span class="keyword">or</span> f2
  assert <span class="keyword">typeof</span> f1 <span class="keyword">is</span> <span class="string">'function'</span>
  assert <span class="keyword">typeof</span> f2 <span class="keyword">is</span> <span class="string">'function'</span>
  <span class="function"><span class="title">F</span></span> = (b, a, args...) -&gt; <span class="keyword">if</span> a? <span class="keyword">then</span> f2 b, a, args... <span class="keyword">else</span> f1 b, a, args...

vocabulary = @
<span class="function"><span class="title">endOfVocabulary</span></span> = -&gt;
  ks = (<span class="keyword">for</span> k <span class="keyword">of</span> tmp.monadic <span class="keyword">then</span> k).concat(
    <span class="keyword">for</span> k <span class="keyword">of</span> tmp.dyadic <span class="keyword">when</span> <span class="keyword">not</span> tmp.monadic[k]? <span class="keyword">then</span> k
  )
  <span class="keyword">for</span> k <span class="keyword">in</span> ks
    f1 = tmp.monadic[k]
    <span class="keyword">if</span> f1?
      f1 = overloadable k, f1
      f1 = maybeMakePervasive f1
    f2 = tmp.dyadic[k]
    <span class="keyword">if</span> f2?
      f2 = overloadable k, f2
      f2 = maybeMakePervasive f2
    vocabulary[k] = ambivalent(k, f1, f2)
  tmp = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><code>pervasive(f)</code> only marks <code>f</code> as pervasive.  It will actually be made
pervasive later in <code>endOfVocabulary()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">pervasive</span></span> = (f) -&gt;
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  (f.aplMetaInfo ?= {}).isPervasive = <span class="literal">true</span>
  f</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><code>maybeMakePervasive(f)</code> is a decorator which takes a scalar function <code>f</code>
and makes it propagate through arrays, if it has
<code>f.aplMetaInfo.isPervasive</code>.</p>
<pre><code>⍴1⍴1   ⍝ returns ,1
⍴1 1⍴1 ⍝ returns 1 1</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">maybeMakePervasive</span></span> = (f) -&gt;
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  <span class="keyword">if</span> <span class="keyword">not</span> f.aplMetaInfo?.isPervasive
    f
  <span class="keyword">else</span>
    withMetaInfoFrom f, (<span class="function"><span class="title">F</span></span> = (b, a) -&gt;
      <span class="keyword">if</span> a? <span class="comment"># dyadic pervasiveness</span>
        <span class="keyword">if</span> isSimple(b) <span class="keyword">and</span> isSimple(a) <span class="keyword">then</span> f b, a
        <span class="keyword">else</span> <span class="keyword">if</span> isSimple a <span class="keyword">then</span> withShape b.shape, (<span class="keyword">for</span> x <span class="keyword">in</span> b <span class="keyword">then</span> F x, a)
        <span class="keyword">else</span> <span class="keyword">if</span> isSimple b <span class="keyword">then</span> withShape a.shape, (<span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> F b, x)
        <span class="keyword">else</span>
          sa = shapeOf a; sb = shapeOf b
          <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0</span> ... min sa.length, sb.length]
            assert sa[i] <span class="keyword">is</span> sb[i], <span class="string">'Length error'</span>
          <span class="keyword">if</span> sa.length &gt; sb.length
            k = prod sa[sb.length...]
            withShape sa,
              (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a.length] <span class="keyword">then</span> F b[floor i / k], a[i])
          <span class="keyword">else</span> <span class="keyword">if</span> sa.length &lt; sb.length
            k = prod sb[sa.length...]
            withShape sb,
              (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..b.length] <span class="keyword">then</span> F b[i], a[floor i / k])
          <span class="keyword">else</span>
            withShape sa, (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a.length] <span class="keyword">then</span> F b[i], a[i])
      <span class="keyword">else</span> <span class="comment"># monadic pervasiveness</span>
        <span class="keyword">if</span> isSimple b <span class="keyword">then</span> f b
        <span class="keyword">else</span> withShape b.shape, (<span class="keyword">for</span> x <span class="keyword">in</span> b <span class="keyword">then</span> F x)
    )</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h1>Built-in verbs</h1>
<p>Conjugate (<code>+</code>)</p>
<pre><code>+4              ⍝ returns 4
++4             ⍝ returns 4
+ 4 5           ⍝ returns 4 5
+((5 6) (7 1))  ⍝ returns (5 6) (7 1)
+ (5 6) (7 1)   ⍝ returns (5 6) (7 1)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'+'</span>, <span class="string">'Conjugate'</span>,      pervasive (x) -&gt; x</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Add (<code>+</code>)</p>
<pre><code>1 + 2                           ⍝ returns 3
2 3 + 5 8                       ⍝ returns 7 11
(2 3 ⍴ 1 2 3 4 5 6) +       ¯2  ⍝ returns 2 3 ⍴ ¯1 0 1 2 3 4
(2 3 ⍴ 1 2 3 4 5 6) +   2 ⍴ ¯2  ⍝ returns 2 3 ⍴ ¯1 0 1 2 3 4
(2 3 ⍴ 1 2 3 4 5 6) + 2 3 ⍴ ¯2  ⍝ returns 2 3 ⍴ ¯1 0 1 2 3 4
1 2 3 + 4 5                     ⍝ fails &#39;Length error&#39;
(2 3⍴⍳6) + 3 2⍴⍳6               ⍝ fails &#39;Length error&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'+'</span>, <span class="string">'Add'</span>,            pervasive (y, x) -&gt; x + y</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Negate (<code>−</code>)</p>
<pre><code>−4         ⍝ returns ¯4
− 1 2 3    ⍝ returns ¯1 ¯2 ¯3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'−'</span>, <span class="string">'Negate'</span>,         pervasive (x) -&gt; -x</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Subtract (<code>−</code>)</p>
<pre><code>1 − 3      ⍝ returns ¯2
5 − ¯3     ⍝ returns 8</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'−'</span>, <span class="string">'Subtract'</span>,       pervasive (y, x) -&gt; x - y</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Sign of (<code>×</code>)</p>
<pre><code>× ¯2 ¯1 0 1 2 ⍝ returns ¯1 ¯1 0 1 1
× 0÷0         ⍝ returns 0</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'×'</span>, <span class="string">'Sign of'</span>,        pervasive (x) -&gt; (x &gt; <span class="number">0</span>) - (x &lt; <span class="number">0</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Multiply (<code>×</code>)</p>
<pre><code>7 × 8       ⍝ returns 56</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'×'</span>, <span class="string">'Multiply'</span>,       pervasive (y, x) -&gt; x * y</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Reciprocal (<code>÷</code>)</p>
<pre><code>÷2          ⍝ returns .5</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'÷'</span>, <span class="string">'Reciprocal'</span>,     pervasive (x) -&gt; <span class="number">1</span> / x</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Divide (<code>÷</code>)</p>
<pre><code>27 ÷ 9      ⍝ returns 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'÷'</span>, <span class="string">'Divide'</span>,         pervasive (y, x) -&gt; x / y</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Ceiling (<code>⌈</code>)</p>
<pre><code>⌈ 0 5 ¯5 (○1) ¯1.5   ⍝ returns 0 5 ¯5 4 ¯1</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⌈'</span>, <span class="string">'Ceiling'</span>,        pervasive (x) -&gt; ceil x</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Greater of (<code>⌈</code>)</p>
<pre><code>3 ⌈ 5       ⍝ returns 5</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'⌈'</span>, <span class="string">'Greater of'</span>,     pervasive (y, x) -&gt; max x, y</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Floor (<code>⌊</code>)</p>
<pre><code>⌊ 0 5 ¯5 (○1) ¯1.5   ⍝ returns 0 5 ¯5 3 ¯2</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⌊'</span>, <span class="string">'Floor'</span>,          pervasive (x) -&gt; floor x</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Lesser of (<code>⌊</code>)</p>
<pre><code>3 ⌊ 5       ⍝ returns 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'⌊'</span>, <span class="string">'Lesser of'</span>,      pervasive (y, x) -&gt; min x, y</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Absolute value (<code>∣</code>)</p>
<pre><code>∣ ¯8 0 8 ¯3.5   ⍝ returns 8 0 8 3.5</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'∣'</span>, <span class="string">'Absolute value'</span>, pervasive (x) -&gt; abs x</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Residue (<code>∣</code>)</p>
<pre><code>3 ∣ 5       ⍝ returns 2</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'∣'</span>, <span class="string">'Residue'</span>,        pervasive (y, x) -&gt; y % x</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Index generate (<code>⍳</code>)</p>
<pre><code>⍳ 5         ⍝ returns 0 1 2 3 4
⍴ ⍳ 5       ⍝ returns 1 ⍴ 5
⍳ 0         ⍝ returns ⍬
⍴ ⍳ 0       ⍝ returns ,0
⍳ 2 3 4     ⍝ returns (2 3 4 3 ⍴
...             0 0 0  0 0 1  0 0 2  0 0 3
...             0 1 0  0 1 1  0 1 2  0 1 3
...             0 2 0  0 2 1  0 2 2  0 2 3
...             1 0 0  1 0 1  1 0 2  1 0 3
...             1 1 0  1 1 1  1 1 2  1 1 3
...             1 2 0  1 2 1  1 2 2  1 2 3)
⍴⍳ 2 3 4    ⍝ returns 2 3 4 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⍳'</span>, <span class="string">'Index generate'</span>, (a) -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> a <span class="keyword">is</span> <span class="string">'number'</span> <span class="keyword">then</span> <span class="keyword">return</span> (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a] <span class="keyword">by</span> <span class="number">1</span> <span class="keyword">then</span> i)
  <span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> assert <span class="keyword">typeof</span> x <span class="keyword">is</span> <span class="string">'number'</span>
  r = []
  indices = <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a.length] <span class="keyword">by</span> <span class="number">1</span> <span class="keyword">then</span> <span class="number">0</span>
  i = <span class="number">0</span>
  <span class="keyword">while</span> i &gt;= <span class="number">0</span>
    <span class="keyword">for</span> v <span class="keyword">in</span> indices <span class="keyword">then</span> r.push v
    i = a.length - <span class="number">1</span>
    <span class="keyword">while</span> i &gt;= <span class="number">0</span> <span class="keyword">and</span> ++indices[i] <span class="keyword">is</span> a[i]
      indices[i--] = <span class="number">0</span>
  withShape a.concat(shapeOf a), r</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Index of (<code>⍳</code>)</p>
<pre><code>2 5 9 14 20 ⍳ 9                           ⍝ returns 1 ⍴ 2
2 5 9 14 20 ⍳ 6                           ⍝ returns 1 ⍴ 5
&quot;GORSUCH&quot; ⍳ &quot;S&quot;                           ⍝ returns 1 ⍴ 3
&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot; ⍳ &quot;CARP&quot;     ⍝ returns 2 0 17 15
&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot; ⍳ &quot;PORK PIE&quot;
... ⍝ returns 15 14 17 10 26 15 8 4
&quot;MON&quot; &quot;TUES&quot; &quot;WED&quot; ⍳ &quot;MON&quot; &quot;THURS&quot;        ⍝ returns 0 3
1 3 2 0 3 ⍳ ⍳ 5                           ⍝ returns 3 0 2 1 5
&quot;CAT&quot; &quot;DOG&quot; &quot;MOUSE&quot; ⍳ &quot;DOG&quot; &quot;BIRD&quot;        ⍝ returns 1 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic  <span class="string">'⍳'</span>, <span class="string">'Index of'</span>, (b, a) -&gt;
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  <span class="keyword">else</span> assert shapeOf(a).length &lt;= <span class="number">1</span>,
    <span class="string">'Left argument to ⍳ must be of rank no more than 1.'</span>
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> b = [b]
  <span class="keyword">for</span> y <span class="keyword">in</span> b
    pos = a.length
    <span class="keyword">for</span> x, i <span class="keyword">in</span> a <span class="keyword">when</span> match x, y <span class="keyword">then</span> pos = i; <span class="keyword">break</span>
    pos</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Roll (<code>?</code>)</p>
<pre><code>n←6 ◇ r←?n ◇ (0≤r)∧(r&lt;n)   ⍝ returns 1
?0                         ⍝ returns 0
?1                         ⍝ returns 0</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'?'</span>, <span class="string">'Roll'</span>, pervasive (x) -&gt; floor random() * max <span class="number">0</span>, floor num x</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Deal (<code>?</code>)</p>
<pre><code>n←100 ◇ (+/n?n)=(+/⍳n)
... ⍝ returns 1 # a permutation (an &quot;n?n&quot; dealing) contains all 0...n
n←100 ◇ A←(n÷2)?n ◇ ∧/(0≤A),A&lt;n
... ⍝ returns 1 # any number x in a dealing is 0 &lt;= x &lt; n
0 ? 100  ⍝ returns ⍬
0 ? 0    ⍝ returns ⍬
1 ? 1    ⍝ returns ,0
5 ? 3    ⍝ fails</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'?'</span>, <span class="string">'Deal'</span>, (y, x) -&gt;
  x = max <span class="number">0</span>, floor num x
  y = max <span class="number">0</span>, floor num y
  assert x &lt;= y, <span class="string">'Domain error: left argument of ? must not be greater '</span> +
                 <span class="string">'than its right argument.'</span>
  available = [<span class="number">0.</span>..y]
  <span class="keyword">for</span> [<span class="number">0.</span>..x] <span class="keyword">then</span> available.splice(floor(available.length * random()), <span class="number">1</span>)[<span class="number">0</span>]

monadic <span class="string">'⋆'</span>, <span class="string">'Exponentiate'</span>, pervasive (x) -&gt; exp num x
dyadic <span class="string">'⋆'</span>, <span class="string">'To the power of'</span>, pervasive (y, x) -&gt; pow num(x), num(y)
monadic <span class="string">'⍟'</span>, <span class="string">'Natural logarithm'</span>, pervasive (x) -&gt; log x
dyadic <span class="string">'⍟'</span>, <span class="string">'Logarithm to the base'</span>, pervasive (y, x) -&gt; log(y) / log(x)

monadic <span class="string">'○'</span>, <span class="string">'Pi times'</span>, pervasive (x) -&gt; PI * x
dyadic <span class="string">'○'</span>, <span class="string">'Circular and hyperbolic functions'</span>, pervasive (x, i) -&gt;
  <span class="keyword">switch</span> i
    <span class="keyword">when</span> <span class="number">0</span> <span class="keyword">then</span> sqrt(<span class="number">1</span> - x * x)
    <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> sin x
    <span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> cos x
    <span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> tan x
    <span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> sqrt(<span class="number">1</span> + x * x)
    <span class="keyword">when</span> <span class="number">5</span> <span class="keyword">then</span> (exp(<span class="number">2</span> * x) - <span class="number">1</span>) / <span class="number">2</span> <span class="comment"># sinh</span>
    <span class="keyword">when</span> <span class="number">6</span> <span class="keyword">then</span> (exp(<span class="number">2</span> * x) + <span class="number">1</span>) / <span class="number">2</span> <span class="comment"># cosh</span>
    <span class="keyword">when</span> <span class="number">7</span> <span class="keyword">then</span> ex = exp(<span class="number">2</span> * x); (ex - <span class="number">1</span>) / (ex + <span class="number">1</span>) <span class="comment"># tanh</span>
    <span class="keyword">when</span> -<span class="number">1</span> <span class="keyword">then</span> asin x
    <span class="keyword">when</span> -<span class="number">2</span> <span class="keyword">then</span> acos x
    <span class="keyword">when</span> -<span class="number">3</span> <span class="keyword">then</span> atan x
    <span class="keyword">when</span> -<span class="number">4</span> <span class="keyword">then</span> sqrt(x * x - <span class="number">1</span>)
    <span class="keyword">when</span> -<span class="number">5</span> <span class="keyword">then</span> log(x + sqrt(x * x + <span class="number">1</span>)) <span class="comment"># arcsinh</span>
    <span class="keyword">when</span> -<span class="number">6</span> <span class="keyword">then</span> log(x + sqrt(x * x - <span class="number">1</span>)) <span class="comment"># arccosh</span>
    <span class="keyword">when</span> -<span class="number">7</span> <span class="keyword">then</span> log((<span class="number">1</span> + x) / (<span class="number">1</span> - x)) / <span class="number">2</span> <span class="comment"># arctanh</span>
    <span class="keyword">else</span> die <span class="string">'Unknown circular or hyperbolic function '</span> + i

<span class="function"><span class="title">Gamma</span></span> = (x) -&gt;
  p = [<span class="number">0.99999999999980993</span>, <span class="number">676.5203681218851</span>, -<span class="number">1259.1392167224028</span>,
       <span class="number">771.32342877765313</span>, -<span class="number">176.61502916214059</span>, <span class="number">12.507343278686905</span>,
       -<span class="number">0.13857109526572012</span>, <span class="number">9.9843695780195716e-6</span>, <span class="number">1.5056327351493116e-7</span>]
  <span class="keyword">if</span> x &lt; <span class="number">0.5</span> <span class="keyword">then</span> <span class="keyword">return</span> PI / (sin(PI * x) * Gamma(<span class="number">1</span> - x))
  x--
  a = p[<span class="number">0</span>]
  t = x + <span class="number">7.5</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1.</span>..p.length]
    a += p[i] / (x + i)
  <span class="keyword">return</span> sqrt(<span class="number">2</span> * PI) * pow(t, x + <span class="number">0.5</span>) * exp(-t) * a</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Factorial (<code>!</code>)</p>
<pre><code>!5    ⍝ returns 120
!21   ⍝ returns 51090942171709440000
!0    ⍝ returns 1</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'!'</span>, <span class="string">'Factorial'</span>, pervasive <span class="function"><span class="title">factorial</span></span> = (x) -&gt;
  <span class="keyword">if</span> <span class="number">0</span> &lt;= x &lt; <span class="number">25</span> <span class="keyword">and</span> x <span class="keyword">is</span> floor x
    r = <span class="number">1</span>; i = <span class="number">2</span>; (<span class="keyword">while</span> i &lt;= x <span class="keyword">then</span> r *= i++); r
  <span class="keyword">else</span> <span class="keyword">if</span> x &lt; -<span class="number">150</span>
    <span class="number">0</span>
  <span class="keyword">else</span> <span class="keyword">if</span> x &gt; <span class="number">150</span>
    <span class="number">1</span> / <span class="number">0</span>
  <span class="keyword">else</span>
    Gamma(x + <span class="number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Binomial (<code>!</code>)</p>
<pre><code>2 ! 4         ⍝ returns 6
3 ! 20        ⍝ returns 1140
2 ! 6 12 20   ⍝ returns 15 66 190
(2 3 ⍴ 1 + ⍳ 6) ! 2 3 ⍴ 3 6 9 12 15 18
... ⍝ returns 2 3⍴ 3 15 84 495 3003 18564</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'!'</span>, <span class="string">'Binomial'</span>, pervasive (n, k) -&gt;
  <span class="keyword">if</span> <span class="number">0</span> &lt;= k &lt; <span class="number">100</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= n &lt; <span class="number">100</span> <span class="keyword">and</span> n <span class="keyword">is</span> floor(n) <span class="keyword">and</span> k <span class="keyword">is</span> floor(k)
    <span class="keyword">if</span> n &lt; k <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span>
    <span class="keyword">if</span> <span class="number">2</span> * k &gt; n <span class="keyword">then</span> k = n - k <span class="comment"># do less work</span>
    u = v = <span class="number">1</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..k] <span class="keyword">by</span> <span class="number">1</span> <span class="keyword">then</span> (u *= n - i; v *= i + <span class="number">1</span>)
    u / v
  <span class="keyword">else</span>
    factorial(n) / (factorial(k) * factorial(n - k))

monadic <span class="string">'⌹'</span>, <span class="string">'Matrix inverse'</span> <span class="comment"># todo</span>
dyadic <span class="string">'⌹'</span>, <span class="string">'Matrix divide'</span> <span class="comment"># todo</span>

dyadic <span class="string">'&lt;'</span>, <span class="string">'Less than'</span>, pervasive (y, x) -&gt; +(x &lt; y)
dyadic <span class="string">'≤'</span>, <span class="string">'Less than or equal'</span>, pervasive (y, x) -&gt; +(x &lt;= y)</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Equals (<code>=</code>)</p>
<pre><code>12 = 12               ⍝ returns 1
2 = 12                ⍝ returns 0
&quot;Q&quot; = &quot;Q&quot;             ⍝ returns 1
1 = &quot;1&quot;               ⍝ returns 0
&quot;1&quot; = 1               ⍝ returns 0
11 7 2 9 = 11 3 2 6   ⍝ returns 1 0 1 0
&quot;STOAT&quot; = &quot;TOAST&quot;     ⍝ returns 0 0 0 0 1
8 = 2 + 2 + 2 + 2     ⍝ returns 1
(2 3⍴1 2 3 4 5 6) = 2 3⍴3 3 3 5 5 5   ⍝ returns 2 3 ⍴ 0 0 1 0 1 0
3 = 2 3⍴1 2 3 4 5 6   ⍝ returns 2 3 ⍴ 0 0 1 0 0 0
3 = (2 3⍴1 2 3 4 5 6) (2 3⍴3 3 3 5 5 5)
... ⍝ returns (2 3 ⍴ 0 0 1 0 0 0) (2 3 ⍴ 1 1 1 0 0 0)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'='</span>, <span class="string">'Equal'</span>, pervasive (y, x) -&gt; +(x <span class="keyword">is</span> y)

dyadic <span class="string">'&gt;'</span>, <span class="string">'Greater than'</span>, pervasive (y, x) -&gt; +(x &gt; y)
dyadic <span class="string">'≥'</span>, <span class="string">'Greater than or equal'</span>, pervasive (y, x) -&gt; +(x &gt;= y)
dyadic <span class="string">'≠'</span>, <span class="string">'Not equal'</span>, pervasive (y, x) -&gt; +(x <span class="keyword">isnt</span> y)</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Depth (<code>≡</code>)</p>
<pre><code>≡4                             ⍝ returns 0
≡⍳4                            ⍝ returns 1
≡2 2⍴⍳4                        ⍝ returns 1
≡&quot;abc&quot; 1 2 3 (23 55)           ⍝ returns 2
≡&quot;abc&quot; (2 4⍴(&quot;abc&quot; 2 3 &quot;k&quot;))   ⍝ returns 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'≡'</span>, <span class="string">'Depth'</span>, <span class="function"><span class="title">depthOf</span></span> = (a) -&gt;
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span>
  r = <span class="number">0</span>; (<span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> r = max r, depthOf x); r + <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Match (<code>≡</code>)</p>
<pre><code>3≡3                       ⍝ returns 1
3≡,3                      ⍝ returns 0
4 7.1 8 ≡ 4 7.2 8         ⍝ returns 0
(3 4⍴⍳12) ≡ 3 4⍴⍳12       ⍝ returns 1
(3 4⍴⍳12) ≡ ⊂3 4⍴⍳12      ⍝ returns 0
(&quot;ABC&quot; &quot;DEF&quot;) ≡ &quot;ABCDEF&quot;  ⍝ returns 0
(⍳0)≡&quot;&quot;                   ⍝ returns 0
(2 0⍴0)≡(0 2⍴0)           ⍝ returns 0
(0⍴1 2 3)≡0⍴⊂2 2⍴⍳4       ⍝ returns 0</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'≡'</span>, <span class="string">'Match'</span>, <span class="function"><span class="title">match</span></span> = (b, a) -&gt;
  <span class="keyword">if</span> isSimple(a) <span class="keyword">and</span> isSimple(b) <span class="keyword">then</span> <span class="keyword">return</span> +(a <span class="keyword">is</span> b)
  <span class="keyword">if</span> isSimple(a) <span class="keyword">isnt</span> isSimple(b) <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Compare by shape</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sa = shapeOf a
  sb = shapeOf b
  <span class="keyword">if</span> sa.length <span class="keyword">isnt</span> sb.length <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..sa.length] <span class="keyword">when</span> sa[i] <span class="keyword">isnt</span> sb[i] <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Compare by elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> a.length <span class="keyword">isnt</span> b.length <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a.length] <span class="keyword">then</span> <span class="keyword">if</span> <span class="keyword">not</span> match a[i], b[i] <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Compare by prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">if</span> a.length <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">1</span>
  <span class="keyword">if</span> <span class="keyword">not</span> (a.aplPrototype? <span class="keyword">or</span> b.aplPrototype?) <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">1</span>
  match prototypeOf(a), prototypeOf(b)</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Not match (<code>≢</code>)</p>
<pre><code>3≢3   ⍝ returns 0</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'≢'</span>, <span class="string">'Not match'</span>, (b, a) -&gt; +<span class="keyword">not</span> match b, a</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Enlist (<code>∈</code>)</p>
<pre><code>∈ 17                        ⍝ returns ,17
⍴ ∈ (1 2 3) &quot;ABC&quot; (4 5 6)   ⍝ returns ,9
∈ 2 2⍴(1 + 2 2⍴⍳4) &quot;DEF&quot; (1 + 2 3⍴⍳6) (7 8 9)
... ⍝ returns 1 2 3 4,&#39;DEF&#39;,1 2 3 4 5 6 7 8 9</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'∈'</span>, <span class="string">'Enlist'</span>, (a) -&gt;
  r = []
  <span class="function"><span class="title">rec</span></span> = (x) -&gt; (<span class="keyword">if</span> isSimple x <span class="keyword">then</span> r.push x <span class="keyword">else</span> <span class="keyword">for</span> y <span class="keyword">in</span> x <span class="keyword">then</span> rec y); r
  rec a</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Membership (<code>∈</code>)</p>
<pre><code>2 3 4 5 6 ∈ 1 2 3 5 8 13 21   ⍝ returns 1 1 0 1 0
5 ∈ 1 2 3 5 8 13 21           ⍝ returns 1</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'∈'</span>, <span class="string">'Membership'</span>, (b, a) -&gt;
  b = array b
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> +(a <span class="keyword">in</span> b)
  <span class="keyword">else</span> withShape a.shape, (<span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> +(x <span class="keyword">in</span> b))</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Find (<code>⍷</code>)</p>
<pre><code>&quot;AN&quot;⍷&quot;BANANA&quot;                          ⍝ returns 0 1 0 1 0 0
&quot;BIRDS&quot; &quot;NEST&quot;⍷&quot;BIRDS&quot; &quot;NEST&quot; &quot;SOUP&quot;   ⍝ returns 1 0 0
&quot;ME&quot;⍷&quot;HOME AGAIN&quot;                      ⍝ returns 0 0 1 0 0 0 0 0 0 0

&quot;DAY&quot;⍷7 9⍴,/(&quot;SUNDAY   &quot;
...          &quot;MONDAY   &quot;
...          &quot;TUESDAY  &quot;
...          &quot;WEDNESDAY&quot;
...          &quot;THURSDAY &quot;
...          &quot;FRIDAY   &quot;
...          &quot;SATURDAY &quot;)
...   ⍝ returns (7 9 ⍴
...          0 0 0 1 0 0 0 0 0
...          0 0 0 1 0 0 0 0 0
...          0 0 0 0 1 0 0 0 0
...          0 0 0 0 0 0 1 0 0
...          0 0 0 0 0 1 0 0 0
...          0 0 0 1 0 0 0 0 0
...          0 0 0 0 0 1 0 0 0)

(2 2⍴&quot;ABCD&quot;)⍷&quot;ABCD&quot;   ⍝ returns 4 ⍴ 0
(1 2) (3 4) ⍷ &quot;START&quot; (1 2 3) (1 2) (3 4)   ⍝ returns 0 0 1 0

(2 2⍴7 8 12 13)⍷ 1+ 4 5⍴⍳20
... ⍝ returns 4 5 ⍴ (0 0 0 0 0
...                  0 1 0 0 0
...                  0 0 0 0 0
...                  0 0 0 0 0)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'⍷'</span>, <span class="string">'Find'</span>, (b, a) -&gt;
  sa = shapeOf a
  sb = shapeOf b
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> <span class="keyword">return</span> isSimple(a) <span class="keyword">and</span> match b, a
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  r = withShape sb, (<span class="keyword">for</span> [<span class="number">0.</span>..b.length] <span class="keyword">then</span> <span class="number">0</span>)
  <span class="keyword">if</span> sa.length &gt; sb.length <span class="keyword">then</span> <span class="keyword">return</span> r
  <span class="keyword">while</span> sa.length &lt; sb.length <span class="keyword">then</span> sa.unshift <span class="number">1</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..sb.length] <span class="keyword">then</span> <span class="keyword">if</span> sa[i] &gt; sb[i] <span class="keyword">then</span> <span class="keyword">return</span> r

  indices = Array sb.length

  <span class="function"><span class="title">rec</span></span> = (d, ir) -&gt;
    <span class="keyword">if</span> d &lt; sb.length
      <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0</span> ... sb[d] - sa[d] + <span class="number">1</span>]
        indices[d] = i
        rec d + <span class="number">1</span>, ir * sb[d] + i
    <span class="keyword">else</span>
      r[ir] = rec2 <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>

  <span class="function"><span class="title">rec2</span></span> = (d, ia, ib) -&gt;
    <span class="keyword">if</span> d &lt; sb.length
      <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..sa[d]]
        <span class="keyword">if</span> <span class="keyword">not</span> rec2 d + <span class="number">1</span>, ia * sa[d] + i, ib * sb[d] + indices[d] + i
          <span class="keyword">return</span> <span class="number">0</span>
      <span class="number">1</span>
    <span class="keyword">else</span>
      match a[ia], b[ib]

  rec <span class="number">0</span>, <span class="number">0</span>
  r</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Unique (<code>∪</code>)</p>
<pre><code>∪ 3 17 17 17 ¯3 17 0   ⍝ returns 3 17 ¯3 0
∪ 3 17                 ⍝ returns 3 17
∪ 17                   ⍝ returns ,17
∪ ⍬                    ⍝ returns ⍬</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'∪'</span>, <span class="string">'Unique'</span>, (a) -&gt;
  r = []
  <span class="keyword">for</span> x <span class="keyword">in</span> array a <span class="keyword">when</span> <span class="keyword">not</span> contains r, x <span class="keyword">then</span> r.push x
  r

<span class="function"><span class="title">contains</span></span> = (a, x) -&gt; <span class="comment"># a helper</span>
  <span class="keyword">for</span> y <span class="keyword">in</span> a <span class="keyword">when</span> match x, y <span class="keyword">then</span> <span class="keyword">return</span> <span class="literal">true</span>
  <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Union (<code>∪</code>)</p>
<pre><code>1 2 ∪ 2 3   ⍝ returns 1 2 3
&#39;SHOCK&#39; ∪ &#39;CHOCOLATE&#39;   ⍝ returns &#39;SHOCKLATE&#39;

&#39;lentils&#39; &#39;bulghur&#39; (3 4 5) ∪ &#39;lentils&#39; &#39;rice&#39;
...     ⍝ returns &#39;lentils&#39; &#39;bulghur&#39; (3 4 5) &#39;rice&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'∪'</span>, <span class="string">'Union'</span>, (b, a) -&gt;
  a = array a
  b = array b
  a.concat(<span class="keyword">for</span> x <span class="keyword">in</span> b <span class="keyword">when</span> <span class="keyword">not</span> contains a, x <span class="keyword">then</span> x)</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Intersection (<code>∩</code>)</p>
<pre><code>&#39;ABRA&#39;∩&#39;CAR&#39;      ⍝ returns &#39;ARA&#39;
1 &#39;PLUS&#39; 2 ∩ ⍳5   ⍝ returns 1 2</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'∩'</span>, <span class="string">'Intersection'</span>, (b, a) -&gt;
  a = array a
  b = array b
  <span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">when</span> contains b, x <span class="keyword">then</span> x

monadic <span class="string">'∼'</span>, <span class="string">'Not'</span>, pervasive (x) -&gt;
  +!bool(x)</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Without (<code>∼</code>)</p>
<pre><code>&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;∼&quot;AEIOU&quot; ⍝ returns &#39;BCDFGHJKLMNPQRSTVWXYZ&#39;
1 2 3 4 5 6 ∼ 2 4 6                  ⍝ returns 1 3 5
&quot;THIS IS TEXT&quot; ∼ &quot; &quot;                 ⍝ returns &#39;THISISTEXT&#39;
&quot;THIS&quot; &quot;AND&quot; &quot;THAT&quot; ∼ &quot;T&quot;            ⍝ returns &#39;THIS&#39; &#39;AND&#39; &#39;THAT&#39;
&quot;THIS&quot; &quot;AND&quot; &quot;THAT&quot; ∼ &quot;AND&quot;          ⍝ returns &#39;THIS&#39; &#39;AND&#39; &#39;THAT&#39;
&quot;THIS&quot; &quot;AND&quot; &quot;THAT&quot; ∼ ⊂&quot;AND&quot;         ⍝ returns &#39;THIS&#39; &#39;THAT&#39;
&quot;THIS&quot; &quot;AND&quot; &quot;THAT&quot; ∼ &quot;TH&quot; &quot;AND&quot;     ⍝ returns &#39;THIS&#39; &#39;THAT&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'∼'</span>, <span class="string">'Without'</span>, (b, a) -&gt;
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  <span class="keyword">else</span> assert shapeOf(a).length &lt;= <span class="number">1</span>,
    <span class="string">'Left argument to ∼ must be of rank no more than 1.'</span>
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> b = [b]
  r = []
  <span class="keyword">for</span> x <span class="keyword">in</span> a
    excluded = <span class="literal">false</span>
    <span class="keyword">for</span> y <span class="keyword">in</span> b
      <span class="keyword">if</span> match x, y
        excluded = <span class="literal">true</span>
        <span class="keyword">break</span>
    <span class="keyword">if</span> <span class="keyword">not</span> excluded
      r.push x
  r</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Or (LCM) (<code>∨</code>)</p>
<pre><code>1∨1                ⍝ returns 1
1∨0                ⍝ returns 1
0∨1                ⍝ returns 1
0∨0                ⍝ returns 0
0 0 1 1 ∨ 0 1 0 1  ⍝ returns 0 1 1 1
12∨18              ⍝ returns 6   # 12=2×2×3, 18=2×3×3
299∨323            ⍝ returns 1   # 299=13×23, 323=17×19
12345∨12345        ⍝ returns 12345
0∨123              ⍝ returns 123</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'∨'</span>, <span class="string">'Or'</span>, pervasive (y, x) -&gt;
  x = abs num x
  y = abs num y
  assert x <span class="keyword">is</span> floor(x) <span class="keyword">and</span> y <span class="keyword">is</span> floor(y), <span class="string">'∨ is defined only for integers'</span>
  <span class="keyword">if</span> x <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">and</span> y <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span>
  <span class="keyword">if</span> x &lt; y <span class="keyword">then</span> [x, y] = [y, x]
  <span class="keyword">while</span> y <span class="keyword">then</span> [x, y] = [y, x % y] <span class="comment"># Euclid's algorithm</span>
  x</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>And (GCD) (<code>∧</code>)</p>
<pre><code>1∧1                                   ⍝ returns 1
1∧0                                   ⍝ returns 0
0∧1                                   ⍝ returns 0
0∧0                                   ⍝ returns 0
0 0 1 1 ∧ 0 1 0 1                     ⍝ returns 0 0 0 1
0 0 0 1 1 ∧ 1 1 1 1 0                 ⍝ returns 0 0 0 1 0
t ← 3 3 ⍴ 1 1 1 0 0 0 1 0 1  ◇  1∧t   ⍝ returns 3 3 ⍴ 1 1 1 0 0 0 1 0 1
t ← 3 3 ⍴ 1 1 1 0 0 0 1 0 1  ◇  ∧/ t  ⍝ returns 1 0 0
12∧18       # 12=2×2×3, 18=2×3×3      ⍝ returns 36
299∧323     # 299=13×23, 323=17×19    ⍝ returns 96577
12345∧12345                           ⍝ returns 12345
0∧123                                 ⍝ returns 0</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'∧'</span>, <span class="string">'And'</span>, pervasive (y, x) -&gt;
  x = abs num x
  y = abs num y
  assert x <span class="keyword">is</span> floor(x) <span class="keyword">and</span> y <span class="keyword">is</span> floor(y), <span class="string">'∧ is defined only for integers'</span>
  <span class="keyword">if</span> x <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">or</span> y <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span>
  p = x * y
  <span class="keyword">if</span> x &lt; y <span class="keyword">then</span> [x, y] = [y, x]
  <span class="keyword">while</span> y <span class="keyword">then</span> [x, y] = [y, x % y] <span class="comment"># Euclid's algorithm</span>
  p / x <span class="comment"># LCM(x, y) = x * y / GCD(x, y)</span>

dyadic <span class="string">'⍱'</span>, <span class="string">'Nor'</span>, pervasive (y, x) -&gt; +!(bool(x) <span class="keyword">or</span> bool(y))
dyadic <span class="string">'⍲'</span>, <span class="string">'Nand'</span>, pervasive (y, x) -&gt; +!(bool(x) <span class="keyword">and</span> bool(y))

monadic <span class="string">'⍴'</span>, <span class="string">'Shape of'</span>, shapeOf</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Reshape (<code>⍴</code>)</p>
<pre><code>⍴ 1 2 3 ⍴ 0    ⍝ returns 1 2 3
⍴ ⍴ 1 2 3 ⍴ 0  ⍝ returns ,3
3 3 ⍴ ⍳ 4      ⍝ returns 3 3 ⍴ 0 1 2 3 0 1 2 3 0
⍴ 3 3 ⍴ ⍳ 4    ⍝ returns 3 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'⍴'</span>, <span class="string">'Reshape'</span>, (b, a) -&gt;
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> b = [b]
  a =
    <span class="keyword">for</span> x <span class="keyword">in</span> a
      assert <span class="keyword">typeof</span> x <span class="keyword">is</span> <span class="string">'number'</span>,
        <span class="string">'Domain error: Left argument to ⍴ must be a '</span> +
        <span class="string">'numeric scalar or vector.'</span>
      max <span class="number">0</span>, floor x
  withShape a, withPrototypeCopiedFrom b,
    (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..prod a] <span class="keyword">then</span> b[i % b.length])</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Helper for verbs <code>,</code> and <code>⍪</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">catenate</span></span> = (b, a, axis = -<span class="number">1</span>) -&gt;
  sa = shapeOf a
  <span class="keyword">if</span> sa.length <span class="keyword">is</span> <span class="number">0</span>
    sa = [<span class="number">1</span>]
    a = <span class="keyword">if</span> isSimple a <span class="keyword">then</span> [a] <span class="keyword">else</span> [a[<span class="number">0</span>]]
  sb = shapeOf b
  <span class="keyword">if</span> sb.length <span class="keyword">is</span> <span class="number">0</span>
    sb = [<span class="number">1</span>]
    b = <span class="keyword">if</span> isSimple b <span class="keyword">then</span> [b] <span class="keyword">else</span> [b[<span class="number">0</span>]]
  assert sa.length <span class="keyword">is</span> sb.length,
    <span class="string">'Length error: Cannot catenate arrays of different ranks'</span>
  <span class="keyword">if</span> axis &lt; <span class="number">0</span> <span class="keyword">then</span> axis += sa.length
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..sa.length] <span class="keyword">when</span> sa[i] <span class="keyword">isnt</span> sb[i] <span class="keyword">and</span> i <span class="keyword">isnt</span> axis
    die <span class="string">'Length error: Catenated arrays must match '</span> +
        <span class="string">'at all axes except the one to catenate on'</span>
  ni = prod sa[...axis] <span class="comment"># number of items across all dimensions before `axis'</span>
  nja = sa[axis]        <span class="comment"># number of items across `axis' in `a'</span>
  njb = sb[axis]        <span class="comment"># number of items across `axis' in `b'</span>
  nk = prod sa[axis + <span class="number">1</span> ...] <span class="comment"># number of items across dimensions after `axis'</span>
  r = []
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..ni]
    <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0.</span>..nja] <span class="keyword">then</span> <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..nk]
      r.push a[k + nk * (j + nja * i)]
    <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0.</span>..njb] <span class="keyword">then</span> <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..nk]
      r.push b[k + nk * (j + njb * i)]
  sr = <span class="keyword">for</span> x <span class="keyword">in</span> sa <span class="keyword">then</span> x
  sr[axis] += sb[axis]
  withShape sr, r</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Ravel (<code>,</code>)</p>
<pre><code>,2 3 4⍴&#39;abcdefghijklmnopqrstuvwx&#39; ⍝ returns &#39;abcdefghijklmnopqrstuvwx&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">','</span>, <span class="string">'Ravel'</span>, (a) -&gt; array(a)[<span class="number">0.</span>..]</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Catenate (<code>,</code>)</p>
<pre><code>10,66                ⍝ returns 10, 66
&#39;10 &#39;,&#39;MAY &#39;,&#39;1985&#39;  ⍝ returns &#39;10 MAY 1985&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">','</span>, <span class="string">'Catenate'</span>, catenate</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>1st axis catenate (<code>⍪</code>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'⍪'</span>, <span class="string">'1st axis catenate'</span>, (b, a) -&gt; catenate b, a, <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Reverse (<code>⌽</code>)</p>
<pre><code>⌽ 1 2 3 4 5 6                    ⍝ returns 6 5 4 3 2 1
⌽ (1 2) (3 4) (5 6)              ⍝ returns (5 6) (3 4) (1 2)
⌽ &quot;BOB WON POTS&quot;                 ⍝ returns &#39;STOP NOW BOB&#39;
⌽    2 5 ⍴ 1 2 3 4 5 6 7 8 9 0   ⍝ returns 2 5 ⍴ 5 4 3 2 1 0 9 8 7 6
⌽[0] 2 5 ⍴ 1 2 3 4 5 6 7 8 9 0   ⍝ returns 2 5 ⍴ 6 7 8 9 0 1 2 3 4 5</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⌽'</span>, <span class="string">'Reverse'</span>, <span class="function"><span class="title">reverse</span></span> = (b, _1, axis = -<span class="number">1</span>) -&gt;
  sb = shapeOf b
  <span class="keyword">if</span> sb.length <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> b
  <span class="keyword">if</span> axis &lt; <span class="number">0</span> <span class="keyword">then</span> axis += sb.length
  assert <span class="number">0</span> &lt;= axis &lt; sb.length, <span class="string">'Axis out of bounds'</span>
  ni = prod sb[...axis]
  nj = sb[axis]
  nk = prod sb[axis + <span class="number">1</span> ...]
  r = []
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..ni]
    <span class="keyword">for</span> j <span class="keyword">in</span> [nj - <span class="number">1</span> .. <span class="number">0</span>] <span class="keyword">by</span> -<span class="number">1</span>
      <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..nk]
        r.push b[k + nk*(j + nj*i)]
  withShape sb, r</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Rotate (<code>⌽</code>)</p>
<pre><code>1 ⌽ 1 2 3 4 5 6                   ⍝ returns 2 3 4 5 6 1
3 ⌽ &#39;ABCDEFGH&#39;                    ⍝ returns &#39;DEFGHABC&#39;
3 ⌽ 2 5 ⍴  1 2 3 4 5  6 7 8 9 0   ⍝ returns 2 5 ⍴ 4 5 1 2 3 9 0 6 7 8
¯2 ⌽ &quot;ABCDEFGH&quot;                   ⍝ returns &#39;GHABCDEF&#39;
1 ⌽ 3 3 ⍴ ⍳ 9                     ⍝ returns 3 3 ⍴ 1 2 0 4 5 3 7 8 6</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'⌽'</span>, <span class="string">'Rotate'</span>, (b, a) -&gt;
  a = num a
  <span class="keyword">if</span> a <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">or</span> isSimple(b) <span class="keyword">or</span> (b.length &lt;= <span class="number">1</span>) <span class="keyword">then</span> <span class="keyword">return</span> b
  sb = shapeOf b
  n = sb[sb.length - <span class="number">1</span>]
  a %= n; <span class="keyword">if</span> a &lt; <span class="number">0</span> <span class="keyword">then</span> a += n
  withShape sb,
    (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..b.length] <span class="keyword">then</span> b[i - (i % n) + ((i % n) + a) % n])</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>1st axis reverse (<code>⊖</code>)</p>
<pre><code>⊖ 1 2 3 4 5 6                   ⍝ returns 6 5 4 3 2 1
⊖ (1 2) (3 4) (5 6)             ⍝ returns (5 6) (3 4) (1 2)
⊖ &#39;BOB WON POTS&#39;                ⍝ returns &#39;STOP NOW BOB&#39;
⊖    2 5 ⍴ 1 2 3 4 5 6 7 8 9 0  ⍝ returns 2 5 ⍴ 6 7 8 9 0 1 2 3 4 5
⊖[1] 2 5 ⍴ 1 2 3 4 5 6 7 8 9 0  ⍝ returns 2 5 ⍴ 5 4 3 2 1 0 9 8 7 6</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⊖'</span>, <span class="string">'1st axis reverse'</span>, (b, _1, axis = <span class="number">0</span>) -&gt;
  reverse b, <span class="literal">undefined</span>, axis</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>1st axis rotate (<code>⊖</code>)</p>
<pre><code>1 ⊖ 3 3 ⍴ ⍳ 9   ⍝ returns 3 3 ⍴ 3 4 5 6 7 8 0 1 2</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'⊖'</span>, <span class="string">'1st axis rotate'</span>, (b, a) -&gt;
  a = num a
  <span class="keyword">if</span> a <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">or</span> isSimple(b) <span class="keyword">or</span> (b.length &lt;= <span class="number">1</span>) <span class="keyword">then</span> <span class="keyword">return</span> b
  sb = shapeOf b
  n = sb[<span class="number">0</span>]
  k = b.length / n
  a %= n; <span class="keyword">if</span> a &lt; <span class="number">0</span> <span class="keyword">then</span> a += n
  withShape sb,
    (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..b.length] <span class="keyword">then</span> b[((floor(i / k) + a) % n) * k + (i % k)])</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Transpose (<code>⍉</code>)</p>
<pre><code>⍉ 2 3 ⍴ 1 2 3 6 7 8     ⍝ returns 3 2 ⍴ 1 6 2 7 3 8
⍴ ⍉ 2 3 ⍴ 1 2 3 6 7 8   ⍝ returns 3 2
⍉ 1 2 3                 ⍝ returns 1 2 3
⍉ 2 3 4 ⍴ ⍳ 24          ⍝ returns (4 3 2 ⍴
...                          0 12   4 16    8 20
...                          1 13   5 17    9 21
...                          2 14   6 18   10 22
...                          3 15   7 19   11 23)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⍉'</span>, <span class="string">'Transpose'</span>, (a) -&gt;
  sa = shapeOf a
  <span class="keyword">if</span> sa.length &lt;= <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">return</span> a <span class="comment"># has no effect on scalars or vectors</span>
  sr = sa[<span class="number">0.</span>..].reverse()
  psr = [<span class="number">1</span>] <span class="comment"># partial products over sr</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0</span> ... sa.length - <span class="number">1</span>] <span class="keyword">then</span> psr.push psr[i] * sr[i]
  r = []
  <span class="function"><span class="title">rec</span></span> = (d, i) -&gt;
    <span class="keyword">if</span> d &gt;= sa.length <span class="keyword">then</span> r.push a[i]
    <span class="keyword">else</span> <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0.</span>..sr[d]] <span class="keyword">then</span> rec d + <span class="number">1</span>, i + j*psr[d]
    <span class="number">0</span>
  rec <span class="number">0</span>, <span class="number">0</span>
  withShape sr, r

monadic <span class="string">'↑'</span>, <span class="string">'First'</span>, (a) -&gt;
  a = array(a)
  <span class="keyword">if</span> a.length <span class="keyword">then</span> a[<span class="number">0</span>] <span class="keyword">else</span> prototypeOf a</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Take (<code>↑</code>)</p>
<pre><code>5 ↑ &#39;ABCDEFGH&#39;           ⍝ returns &#39;ABCDE&#39;
¯3 ↑ &#39;ABCDEFGH&#39;          ⍝ returns &#39;FGH&#39;
3 ↑ 22 2 19 12           ⍝ returns 22 2 19
¯1 ↑ 22 2 19 12          ⍝ returns ,12
⍴ 1 ↑ (2 2 ⍴ ⍳ 4) (⍳ 10) ⍝ returns ,1
5 ↑ 40 92 11             ⍝ returns 40 92 11 0 0
¯5 ↑ 40 92 11            ⍝ returns 0 0 40 92 11
3 3 ↑ 1 1 ⍴ 0            ⍝ returns 3 3 ⍴ 0 0 0 0 0 0 0 0 0
5 ↑ &quot;abc&quot;                ⍝ returns &#39;abc  &#39;
¯5 ↑ &quot;abc&quot;               ⍝ returns &#39;  abc&#39;
3 3 ↑ 1 1 ⍴ &quot;a&quot;          ⍝ returns 3 3 ⍴ &#39;a        &#39;
2 3 ↑ 1 + 4 3 ⍴ ⍳ 12     ⍝ returns 2 3 ⍴ 1 2 3 4 5 6
¯1 3 ↑ 1 + 4 3 ⍴ ⍳ 12    ⍝ returns 1 3 ⍴ 10 11 12
1 2 ↑ 1 + 4 3 ⍴ ⍳ 12     ⍝ returns 1 2 ⍴ 1 2</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'↑'</span>, <span class="string">'Take'</span>, (b, a) -&gt;
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  <span class="keyword">for</span> x <span class="keyword">in</span> a
    assert <span class="keyword">typeof</span> x <span class="keyword">is</span> <span class="string">'number'</span>,
      <span class="string">'Domain error: Left argument to ↑ must be a numeric scalar or vector.'</span>
  <span class="keyword">if</span> isSimple(b) <span class="keyword">and</span> a.length <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">then</span> b = [b]
  sb = shapeOf b
  assert a.length <span class="keyword">is</span> sb.length,
    <span class="string">'Length error: Left argument to ↑ must have as many elements as is '</span> +
    <span class="string">'the rank of its right argument.'</span>
  r = []
  pa = <span class="keyword">for</span> [<span class="number">0.</span>..a.length] <span class="keyword">then</span> <span class="number">0</span>
  pa[a.length - <span class="number">1</span>] = <span class="number">1</span>
  i = a.length - <span class="number">2</span>; <span class="keyword">while</span> i &gt;= <span class="number">0</span> <span class="keyword">then</span> pa[i] = pa[i + <span class="number">1</span>] * a[i + <span class="number">1</span>]; i--
  filler = prototypeOf b
  <span class="function"><span class="title">rec</span></span> = (d, i, k) -&gt;
    <span class="keyword">if</span> d &gt;= sb.length
      r.push b[i]
    <span class="keyword">else</span>
      k /= sb[d]
      <span class="keyword">if</span> a[d] &gt;= <span class="number">0</span>
        <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0</span> ... min a[d], sb[d]] <span class="keyword">then</span> rec d + <span class="number">1</span>, i + j * k, k
        <span class="keyword">if</span> sb[d] &lt; a[d]
          <span class="keyword">for</span> [<span class="number">0</span> ... (a[d] - sb[d]) * pa[d]] <span class="keyword">then</span> r.push filler
      <span class="keyword">else</span>
        <span class="keyword">if</span> sb[d] + a[d] &lt; <span class="number">0</span>
          <span class="keyword">for</span> [<span class="number">0</span> ... -(sb[d] + a[d]) * pa[d]] <span class="keyword">then</span> r.push filler
        <span class="keyword">for</span> j <span class="keyword">in</span> [max(<span class="number">0</span>, sb[d] + a[d]) ... sb[d]]
          rec d + <span class="number">1</span>, i + j * k, k
    <span class="number">0</span>
  rec <span class="number">0</span>, <span class="number">0</span>, b.length
  withShape (<span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> abs x), withPrototype filler, r</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Drop (<code>↓</code>)</p>
<pre><code>4↓&#39;OVERBOARD&#39;              ⍝ returns &#39;BOARD&#39;
¯5↓&#39;OVERBOARD&#39;             ⍝ returns &#39;OVER&#39;
⍴10↓&#39;OVERBOARD&#39;            ⍝ returns ,0
0 ¯2↓ 3 3 ⍴ &#39;ONEFATFLY&#39;    ⍝ returns 3 1 ⍴ &#39;OFF&#39;
¯2 ¯1↓ 3 3 ⍴ &#39;ONEFATFLY&#39;   ⍝ returns 1 2 ⍴ &#39;ON&#39;
1↓ 3 3 ⍴ &#39;ONEFATFLY&#39;       ⍝ returns 2 3 ⍴ &#39;FATFLY&#39;
1 1↓ 2 3 4⍴&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;    ⍝ returns 1 2 4 ⍴ &#39;QRSTUVWX&#39;
¯1 ¯1↓ 2 3 4⍴&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;  ⍝ returns 1 2 4 ⍴ &#39;ABCDEFGH&#39;</code></pre>
<p>todo: more tests</p>
<pre><code>//#gives &#39;1 ↓[1] 2 3 4⍴1+⍳24&#39;, [5..12].concat [17..24]
//    # todo: drop with axis specification
//#gives &#39;1 ↓[2] 2 3 4⍴1+⍳24&#39;,
//    [3, 4, 7, 8, 11, 12, 15, 16, 19, 20, 23, 24] # todo
//#gives &#39;1 ↓[2 1] 2 3 4⍴1+⍳24&#39;, [7, 8, 11, 12, 19, 20, 23, 24] # todo</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'↓'</span>, <span class="string">'Drop'</span>, (b, a) -&gt;
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  <span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">when</span> <span class="keyword">typeof</span> x <span class="keyword">isnt</span> <span class="string">'number'</span> <span class="keyword">or</span> x <span class="keyword">isnt</span> floor x
    die <span class="string">'Left argument to ↓ must be an integer or a vector of integers.'</span>
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> b = withShape (<span class="keyword">for</span> [<span class="number">0.</span>..a.length] <span class="keyword">then</span> <span class="number">1</span>), b
  sb = shapeOf b
  <span class="keyword">if</span> a.length &gt; sb.length
    die <span class="string">'The left argument to ↓ must have length less than or equal to '</span> +
        <span class="string">'the rank of its right argument.'</span>
  <span class="keyword">for</span> [a.length...sb.length] <span class="keyword">then</span> a.push <span class="number">0</span>
  lims =
    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a.length]
      <span class="keyword">if</span> a[i] &gt;= <span class="number">0</span>
        [min(a[i], sb[i]), sb[i]]
      <span class="keyword">else</span>
        [<span class="number">0</span>, max(<span class="number">0</span>, sb[i] + a[i])]
  r = []
  <span class="function"><span class="title">rec</span></span> = (d, i, n) -&gt;
    <span class="keyword">if</span> d &gt;= sb.length
      r.push b[i]
    <span class="keyword">else</span>
      n /= sb[d]
      <span class="keyword">for</span> j <span class="keyword">in</span> [lims[d][<span class="number">0</span>]...lims[d][<span class="number">1</span>]]
        rec d + <span class="number">1</span>, i + j*n, n
    <span class="number">0</span>
  rec <span class="number">0</span>, <span class="number">0</span>, b.length
  sr = <span class="keyword">for</span> [lo, hi] <span class="keyword">in</span> lims <span class="keyword">then</span> hi - lo
  withShape sr, r</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Enclose (<code>⊂</code>)</p>
<pre><code>⍴ ⊂ 2 3⍴⍳6    ⍝ returns ⍬
⍴⍴ ⊂ 2 3⍴⍳6   ⍝ returns ,0
⊂[0]2 3⍴⍳6    ⍝ returns (0 3)(1 4)(2 5)
⍴⊂[0]2 3⍴⍳6   ⍝ returns ,3
⊂[1]2 3⍴⍳6    ⍝ returns (0 1 2)(3 4 5)
⍴⊂[1]2 3⍴⍳6   ⍝ returns ,2
⊃⊂[1 0]2 3⍴⍳6 ⍝ returns 3 2⍴0 3 1 4 2 5
⍴⊂[1 0]2 3⍴⍳6 ⍝ returns ⍬</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⊂'</span>, <span class="string">'Enclose'</span>, (a, _, axes) -&gt;
  sa = shapeOf a
  <span class="keyword">if</span> <span class="keyword">typeof</span> axes <span class="keyword">is</span> <span class="string">'undefined'</span>
    axes = [<span class="number">0.</span>..sa.length]
  <span class="keyword">else</span>
    assert axes.length <span class="keyword">is</span> <span class="number">1</span>,
      <span class="string">'Axes cannot be specified using strand notation.'</span>
    axes = axes[<span class="number">0</span>]
    <span class="keyword">if</span> <span class="keyword">typeof</span> axes <span class="keyword">is</span> <span class="string">'number'</span> <span class="keyword">then</span> axes = [axes]
    <span class="keyword">for</span> axis, i <span class="keyword">in</span> axes
      assert <span class="keyword">typeof</span> axis <span class="keyword">is</span> <span class="string">'number'</span>, <span class="string">'Axes must be numbers.'</span>
      assert axis <span class="keyword">is</span> Math.floor axis, <span class="string">'Axes must be integers.'</span>
      assert <span class="number">0</span> &lt;= axis &lt; sa.length,
        <span class="string">'Axes must be between 0 and the argument\'s rank.'</span>
      assert axis <span class="keyword">not</span> <span class="keyword">in</span> axes[...i],
        <span class="string">'Axes must be unique.'</span>
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> <span class="keyword">return</span> a
  su = <span class="keyword">for</span> axis <span class="keyword">in</span> axes <span class="keyword">then</span> sa[axis]
  nu = prod su
  rAxes = <span class="keyword">for</span> axis <span class="keyword">in</span> [<span class="number">0.</span>..sa.length] <span class="keyword">when</span> axis <span class="keyword">not</span> <span class="keyword">in</span> axes <span class="keyword">then</span> axis
  sr = <span class="keyword">for</span> axis <span class="keyword">in</span> rAxes <span class="keyword">then</span> sa[axis]
  nr = prod sr
  withShape sr,
    <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0.</span>..nr]
      jj = enc j, sr
      withShape su,
        <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..nu]
          kk = enc k, su
          ii =
            <span class="keyword">for</span> axis <span class="keyword">in</span> [<span class="number">0.</span>..sa.length]
              <span class="keyword">if</span> axis <span class="keyword">in</span> axes <span class="keyword">then</span> kk[axes.indexOf axis]
              <span class="keyword">else</span> jj[rAxes.indexOf axis]
          i = dec ii, sa
          a[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Partition (with axis) (<code>⊂</code>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'⊂'</span>, <span class="string">'Partition (with axis)'</span> <span class="comment"># todo</span></pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Disclose (<code>⊃</code>)</p>
<pre><code>⊃ (1 2 3) (4 5 6)   ⍝ returns 2 3 ⍴ 1 2 3 4 5 6
⍴⊃ (1 2 3) (4 5 6)  ⍝ returns 2 3
⊃ (1 2) (3 4 5)     ⍝ returns 2 3 ⍴ 1 2 0 3 4 5
⍴⊃ (1 2) (3 4 5)    ⍝ returns 2 3
⊃ (1 2 3) &quot;AB&quot;      ⍝ returns 2 3 ⍴ 1 2 3,&#39;AB &#39;
⍴⊃ (1 2 3) &quot;AB&quot;     ⍝ returns 2 3
⊃123                ⍝ returns 123</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⊃'</span>, <span class="string">'Disclose'</span>, (a) -&gt;
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> <span class="keyword">return</span> a
  sa = shapeOf a
  <span class="keyword">if</span> sa.length <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> a[<span class="number">0</span>]
  sr1 = shapeOf(a[<span class="number">0</span>])[<span class="number">0.</span>..]
  <span class="keyword">for</span> x <span class="keyword">in</span> a[<span class="number">1.</span>..]
    sx = shapeOf x
    <span class="keyword">if</span> sx.length <span class="keyword">isnt</span> sr1.length
      die <span class="string">'The argument of ⊃ must contain elements of the same rank.'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>todo: or scalars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..sr1.length]
      sr1[i] = max sr1[i], sx[i]
  sr = shapeOf(a).concat sr1
  r = []
  <span class="keyword">for</span> x <span class="keyword">in</span> a
    sx = shapeOf x
    rec = (d,   <span class="comment"># dimension</span>
           i,   <span class="comment"># index in x</span>
           n,   <span class="comment"># block size in x</span>
           N    <span class="comment"># block size in r</span>
           ) -&gt;
      <span class="keyword">if</span> d &gt;= sr1.length
        r.push x[i]
      <span class="keyword">else</span>
        n /= sx[d]
        N /= sr1[d]
        <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0.</span>..sx[d]]
          rec d + <span class="number">1</span>, i + j * n, n, N
        <span class="keyword">if</span> sr1[d] &gt; sx[d]
          filler = prototypeOf x
          <span class="keyword">for</span> [<span class="number">0</span> ... N * (sr1[d] - sx[d])]
            r.push filler
    rec <span class="number">0</span>, <span class="number">0</span>, x.length, prod sr1
  withShape sr, r

dyadic <span class="string">'⊃'</span>, <span class="string">'Pick'</span> <span class="comment"># todo</span></pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Index (<code>⌷</code>)</p>
<p><code>a0 a1...⌷b</code> is equivalent to <code>b[a0;a1;...]</code></p>
<pre><code>1 ⌷ 3 5 8                ⍝ returns 5
(3 5 8)[1]               ⍝ returns 5
⌷←{⍺+¨⍵}  ◇  (3 5 8)[1]  ⍝ returns 4 6 9
(2 2 0) (1 2) ⌷ 3 3⍴⍳9   ⍝ returns 3 2 ⍴ 7 8 7 8 1 2
¯1 ⌷ 3 5 8               ⍝ fails
2 ⌷ 111 222 333 444      ⍝ returns 333
(⊂3 2) ⌷ 111 222 333 444 ⍝ returns 444 333
(⊂2 3⍴2 0 3 0 1 2) ⌷ 111 222 333 444
... ⍝ returns 2 3⍴333 111 444 111 222 333
1 0    ⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 21
1      ⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 21 22 23 24
2 (1 0)⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 32 31
(1 2) 0⌷3 4⍴11 12 13 14 21 22 23 24 31 32 33 34   ⍝ returns 21 31

(23 54 38)[0]                         ⍝ returns 23
(23 54 38)[1]                         ⍝ returns 54
(23 54 38)[2]                         ⍝ returns 38
(23 54 38)[3]                         ⍝ fails
(23 54 38)[¯1]                        ⍝ fails
(23 54 38)[0 2]                       ⍝ returns 23 38
(2 3 ⍴ 100 101 102 110 111 112)[1;2]  ⍝ returns 112
(2 3 ⍴ 100 101 102 110 111 112)[1;¯1] ⍝ fails
(2 3 ⍴ 100 101 102 110 111 112)[10;1] ⍝ fails
(2 3 ⍴ 100 101 102 110 111 112)[1;]   ⍝ returns 110 111 112
(2 3 ⍴ 100 101 102 110 111 112)[;1]   ⍝ returns 101 111
&#39;hello&#39;[1]                            ⍝ returns &#39;e&#39;
&#39;ipodlover&#39;[1 2 5 8 3 7 6 0 4]        ⍝ returns &#39;poordevil&#39;
(&#39;axlrose&#39;[4 3 0 2 5 6 1])[0 1 2 3]   ⍝ returns &#39;oral&#39;

&quot; X&quot;[(3 3⍴⍳9) ∈ 1 3 6 7 8]  ⍝ returns 3 3⍴,/ (&#39; X &#39;
...                                           &#39;X  &#39;
...                                           &#39;XXX&#39;)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>dyadic <span class="string">'⌷'</span>, <span class="string">'Index'</span>, (b, a, axes = <span class="literal">null</span>) -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> b <span class="keyword">is</span> <span class="string">'function'</span> <span class="keyword">then</span> <span class="keyword">return</span> (y, x) -&gt; b y, x, a
  a = array a
  sr = [].concat a...
  assert shapeOf(a).length &lt;= <span class="number">1</span>,
    <span class="string">'Indices must be a scalar or a vector, not a higher-dimensional array.'</span>
  sb = shapeOf b
  assert a.length &lt;= sb.length,
    <span class="string">'The number of indices must not exceed the rank of the indexable.'</span>
  axes = <span class="keyword">if</span> axes <span class="keyword">is</span> <span class="literal">null</span> <span class="keyword">then</span> [<span class="number">0.</span>..a.length] <span class="keyword">else</span> array axes
  assert shapeOf(axes).length &lt;= <span class="number">1</span>,
    <span class="string">'Axes must be a scalar or a vector, not a higher-dimensional array.'</span>
  assert a.length <span class="keyword">is</span> axes.length,
    <span class="string">'The number of indices must be equal to the number of axes specified.'</span>
  a1 = <span class="keyword">for</span> x <span class="keyword">in</span> sb <span class="keyword">then</span> <span class="literal">null</span>
  <span class="keyword">for</span> axis, i <span class="keyword">in</span> axes
    assert (<span class="keyword">typeof</span> axis <span class="keyword">is</span> <span class="string">'number'</span> <span class="keyword">and</span> axis <span class="keyword">is</span> floor axis),
      <span class="string">'Axes must be integers'</span>
    assert (<span class="number">0</span> &lt;= axis &lt; sb.length), <span class="string">'Invalid axis'</span>
    assert <span class="keyword">not</span> contains(axes[...i], axis), <span class="string">'Duplicate axis'</span>
    a1[axis] = array a[i]
  a = a1
  <span class="keyword">for</span> x, i <span class="keyword">in</span> a <span class="keyword">when</span> x <span class="keyword">is</span> <span class="literal">null</span>
    a[i] = [<span class="number">0.</span>..sb[i]]
  <span class="keyword">for</span> x, d <span class="keyword">in</span> a <span class="keyword">then</span> <span class="keyword">for</span> y <span class="keyword">in</span> x
    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="keyword">typeof</span> y <span class="keyword">is</span> <span class="string">'number'</span> <span class="keyword">and</span> y <span class="keyword">is</span> floor(y))
      die <span class="string">'Indices must be integers'</span>
  <span class="keyword">for</span> x, d <span class="keyword">in</span> a <span class="keyword">then</span> <span class="keyword">for</span> y <span class="keyword">in</span> x <span class="keyword">when</span> <span class="keyword">not</span> (<span class="number">0</span> &lt;= y &lt; sb[d])
    die <span class="string">'Index out of bounds'</span>
  sr = []; <span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> sr = sr.concat shapeOf x
  r = []
  <span class="function"><span class="title">rec</span></span> = (d, i, n) -&gt;
    <span class="keyword">if</span> d &gt;= a.length <span class="keyword">then</span> r.push b[i]
    <span class="keyword">else</span> <span class="keyword">for</span> x <span class="keyword">in</span> a[d] <span class="keyword">then</span> rec d + <span class="number">1</span>, i + (x * n / sb[d]), n / sb[d]
    <span class="number">0</span>
  rec <span class="number">0</span>, <span class="number">0</span>, b.length
  <span class="keyword">if</span> sr.length <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> r[<span class="number">0</span>] <span class="keyword">else</span> withShape sr, r</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Helper for <code>⍋</code> and <code>⍒</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">grade</span></span> = (b, a, direction) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> a? <span class="keyword">then</span> a = []
  sa = shapeOf a
  sb = shapeOf b
  assert sa.length, <span class="string">'Left argument to ⍋ or ⍒ must be non-scalar.'</span>
  <span class="keyword">if</span> sb.length <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> b
  n = sa[sa.length - <span class="number">1</span>] <span class="comment"># length along last axis</span>
  h = {} <span class="comment"># maps a character to its index in the collation</span>
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a.length] <span class="keyword">then</span> h[a[i]] = i % n
  m = b.length / sb[<span class="number">0</span>]
  r = [<span class="number">0.</span>..sb[<span class="number">0</span>]]
  r.sort (i, j) -&gt;
    <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..m]
      x = b[m*i + k]
      y = b[m*j + k]
      tx = <span class="keyword">typeof</span> x
      ty = <span class="keyword">typeof</span> y
      <span class="keyword">if</span> tx &lt; ty <span class="keyword">then</span> <span class="keyword">return</span> -direction
      <span class="keyword">if</span> tx &gt; ty <span class="keyword">then</span> <span class="keyword">return</span> direction
      <span class="keyword">if</span> h[x]? <span class="keyword">then</span> x = h[x]
      <span class="keyword">if</span> h[y]? <span class="keyword">then</span> y = h[y]
      <span class="keyword">if</span> x &lt; y <span class="keyword">then</span> <span class="keyword">return</span> -direction
      <span class="keyword">if</span> x &gt; y <span class="keyword">then</span> <span class="keyword">return</span> direction
    <span class="number">0</span>
  r</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Grade up/down (<code>⍋</code>)</p>
<pre><code>⍋13 8 122 4                          ⍝ returns 3 1 0 2
a←13 8 122 4  ◇  a[⍋a]               ⍝ returns 4 8 13 122
⍋&quot;ZAMBIA&quot;                            ⍝ returns 1 5 3 4 2 0
s←&quot;ZAMBIA&quot;  ◇  s[⍋s]                 ⍝ returns &#39;AABIMZ&#39;
t←3 3⍴&quot;BOBALFZAK&quot;  ◇  ⍋t             ⍝ returns 1 0 2
t←3 3⍴4 5 6 1 1 3 1 1 2  ◇  ⍋t       ⍝ returns 2 1 0

t←3 3⍴4 5 6 1 1 3 1 1 2  ◇  t[⍋t;]
...    ⍝ returns (3 3 ⍴   1 1 2
...                       1 1 3
...                       4 5 6)

a←3 2 3⍴2 3 4 0 1 0 1 1 3 4 5 6 1 1 2 10 11 12  ◇  a[⍋a;;]
... ⍝ returns (3 2 3 ⍴
...      1  1  2
...     10 11 12
...
...      1  1  3
...      4  5  6
...
...      2  3  4
...      0  1  0)

a←3 2 5⍴&quot;joe  doe  bob  jonesbob  zwart&quot;  ◇  a[⍋a;;]
... ⍝ returns 3 2 5 ⍴ &#39;bob  jonesbob  zwartjoe  doe  &#39;

&quot;ZYXWVUTSRQPONMLKJIHGFEDCBA&quot;⍋&quot;ZAMBIA&quot;   ⍝ returns 0 2 4 3 1 5

⎕A←&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot; ◇ (⌽⎕A)⍋3 3⍴&quot;BOBALFZAK&quot;
... ⍝ returns 2 0 1

data←6 4⍴&quot;ABLEaBLEACREABELaBELACES&quot;
... coll←2 26⍴&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;
... data[coll⍋data;]
...   ⍝ returns 6 4 ⍴ &#39;ABELaBELABLEaBLEACESACRE&#39;

data←6 4⍴&quot;ABLEaBLEACREABELaBELACES&quot;
... coll1←&quot;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz&quot;
... data[coll1⍋data;]
...   ⍝ returns 6 4 ⍴ &#39;ABELABLEACESACREaBELaBLE&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⍋'</span>, <span class="string">'Grade up'</span>, (b, a) -&gt; grade b, a, <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Grade down (<code>⍒</code>)</p>
<pre><code>⍒3 1 8   ⍝ returns 2 0 1</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⍒'</span>, <span class="string">'Grade down'</span>, (b, a) -&gt; grade b, a, -<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Encode (<code>⊤</code>)</p>
<pre><code>1760 3 12⊤75          ⍝ returns 2 0 3
3 12⊤75               ⍝ returns 0 3
100000 12⊤75          ⍝ returns 6 3
16 16 16 16⊤100       ⍝ returns 0 0 6 4
1760 3 12⊤75.3        ⍝ returns 2 0 (75.3−72)
0 1⊤75.3              ⍝ returns 75 (75.3−75)

2 2 2 2 2⊤1 2 3 4 5   ⍝ returns (5 5 ⍴
...                         0 0 0 0 0
...                         0 0 0 0 0
...                         0 0 0 1 1
...                         0 1 1 0 0
...                         1 0 1 0 1)

10⊤5 15 125 ⍝ returns 5 5 5
0 10⊤5 15 125 ⍝ returns 2 3⍴ 0 1 12 5 5 5

(8 3⍴ 2 0 0
...   2 0 0
...   2 0 0
...   2 0 0
...   2 8 0
...   2 8 0
...   2 8 16
...   2 8 16) ⊤ 75
...       ⍝ returns (8 3⍴
...             0 0 0
...             1 0 0
...             0 0 0
...             0 0 0
...             1 0 0
...             0 1 0
...             1 1 4
...             1 3 11)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⊤'</span>, <span class="string">'Encode'</span>, (b, a) -&gt;
  sa = shapeOf a
  sb = shapeOf b
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> b = [b]
  r = Array a.length * b.length
  n = <span class="keyword">if</span> sa.length <span class="keyword">then</span> sa[<span class="number">0</span>] <span class="keyword">else</span> <span class="number">1</span>
  m = a.length / n
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..m]
    <span class="keyword">for</span> y, j <span class="keyword">in</span> b
      <span class="keyword">if</span> isNeg = (y &lt; <span class="number">0</span>) <span class="keyword">then</span> y = -y
      <span class="keyword">for</span> k <span class="keyword">in</span> [n - <span class="number">1</span> .. <span class="number">0</span>] <span class="keyword">by</span> -<span class="number">1</span>
        x = a[k * m + i]
        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="number">0</span>
          r[(k * m + i) * b.length + j] = y
          y = <span class="number">0</span>
        <span class="keyword">else</span>
          r[(k * m + i) * b.length + j] = y % x
          y = round((y - (y % x)) / x)
  sr = sa.concat sb
  <span class="keyword">if</span> sr.length <span class="keyword">then</span> withShape sr, r <span class="keyword">else</span> r[<span class="number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Decode (<code>⊥</code>)</p>
<pre><code>10 ⊥ 3 2 6 9                        ⍝ returns 3269
8 ⊥ 3 1                             ⍝ returns 25
1760 3 12 ⊥ 1 2 8                   ⍝ returns 68
2 2 2 ⊥ 1                           ⍝ returns 7
0 20 12 4 ⊥ 2 15 6 3                ⍝ returns 2667
1760 3 12 ⊥ 3 3⍴1 1 1 2 0 3 0 1 8   ⍝ returns 60 37 80
60 60 ⊥ 3 13                        ⍝ returns 193
0 60 ⊥ 3 13                         ⍝ returns 193
60 ⊥ 3 13                           ⍝ returns 193
2 ⊥ 1 0 1 0                         ⍝ returns 10
2 ⊥ 1 2 3 4                         ⍝ returns 26
3 ⊥ 1 2 3 4                         ⍝ returns 58

//gives &#39;(1j1 ⊥ 1 2 3 4) = 5j9&#39;, 1 # todo: ⊥ for complex numbers

M ← (3 8 ⍴
...                   0 0 0 0 1 1 1 1
...                   0 0 1 1 0 0 1 1
...                   0 1 0 1 0 1 0 1)
... A ← (4 3 ⍴
...                   1 1 1
...                   2 2 2
...                   3 3 3
...                   4 4 4)
... A ⊥ M
...      ⍝ returns (4 8⍴
...          0 1 1 2  1  2  2  3
...          0 1 2 3  4  5  6  7
...          0 1 3 4  9 10 12 13
...          0 1 4 5 16 17 20 21)

M ← (3 8 ⍴
...          0 0 0 0 1 1 1 1
...          0 0 1 1 0 0 1 1
...          0 1 0 1 0 1 0 1)
... 2 ⊥ M
...      ⍝ returns 0 1 2 3 4 5 6 7

M ← (3 8 ⍴
...          0 0 0 0 1 1 1 1
...          0 0 1 1 0 0 1 1
...          0 1 0 1 0 1 0 1)
... A ← 2 1 ⍴ 2 10
... A ⊥ M
...      ⍝ returns (2 8⍴
...          0 1  2  3   4   5   6   7
...          0 1 10 11 100 101 110 111)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⊥'</span>, <span class="string">'Decode'</span>, (b, a) -&gt;
  sa = shapeOf a
  sb = shapeOf b
  lastDimA = <span class="keyword">if</span> sa.length <span class="keyword">then</span> sa[sa.length - <span class="number">1</span>] <span class="keyword">else</span> <span class="number">1</span>
  firstDimB = <span class="keyword">if</span> sb.length <span class="keyword">then</span> sb[<span class="number">0</span>] <span class="keyword">else</span> <span class="number">1</span>
  assert lastDimA <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">or</span> firstDimB <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">or</span> lastDimA <span class="keyword">is</span> firstDimB,
    <span class="string">'Incompatible shapes for ⊥ ("Decode")'</span>
  <span class="keyword">if</span> isSimple a <span class="keyword">then</span> a = [a]
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> b = [b]
  r = []
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0</span> ... a.length / lastDimA]
    <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0</span> ... b.length / firstDimB]
      x = a[i * lastDimA ... (i + <span class="number">1</span>) * lastDimA]
      y = <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..firstDimB] <span class="keyword">then</span> b[j + k * (b.length / firstDimB)]
      <span class="keyword">if</span> x.length <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">then</span> x = <span class="keyword">for</span> [<span class="number">0.</span>..y.length] <span class="keyword">then</span> x[<span class="number">0</span>]
      <span class="keyword">if</span> y.length <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">then</span> y = <span class="keyword">for</span> [<span class="number">0.</span>..x.length] <span class="keyword">then</span> y[<span class="number">0</span>]
      z = y[<span class="number">0</span>]
      <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">1.</span>..y.length]
        z = z * x[k] + y[k]
      r.push z
  <span class="keyword">if</span> sa.length &lt;= <span class="number">1</span> <span class="keyword">and</span> sb.length &lt;= <span class="number">1</span>
    r[<span class="number">0</span>]
  <span class="keyword">else</span>
    withShape sa[...-<span class="number">1</span>].concat(sb[<span class="number">1.</span>..]), r</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Format (<code>⍕</code>)</p>
<pre><code>⍕123                ⍝ returns 1 3⍴&#39;123&#39;
⍕123 456            ⍝ returns 1 7⍴&#39;123 456&#39;
⍕123 &#39;a&#39;            ⍝ returns 1 5⍴&#39;123 a&#39;
⍕12 &#39;ab&#39;            ⍝ returns 1 7⍴&#39;12  ab &#39;
⍕2 2⍴&#39;a&#39;            ⍝ returns 2 2⍴&#39;a&#39;
⍕2 2⍴5              ⍝ returns 2 3⍴,/(&#39;5 5&#39;
...                                  &#39;5 5&#39;)
⍕2 2⍴0 0 0 &#39;a&#39;      ⍝ returns 2 3⍴,/(&#39;0 0&#39;
...                                  &#39;0 a&#39;)
⍕2 2⍴0 0 0 &#39;ab&#39;     ⍝ returns 2 6⍴,/(&#39;0  0  &#39;
...                                  &#39;0  ab &#39;)
⍕2 2⍴0 0 0 123      ⍝ returns 2 5⍴,/(&#39;0   0&#39;
...                                  &#39;0 123&#39;)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⍕'</span>, <span class="string">'Format'</span>, (b) -&gt;
  t = formatter.format b
  withShape [t.length, t[<span class="number">0</span>].length], t.join(<span class="string">''</span>).split(<span class="string">''</span>)

dyadic <span class="string">'⍕'</span>, <span class="string">'Format by example or specification'</span> <span class="comment"># todo</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Execute (<code>⍎</code>)</p>
<pre><code>⍎ &#39;+/ 2 2 ⍴ 1 2 3 4&#39;  ⍝ returns 3 7
⍴ ⍎ &#39;123 456&#39;         ⍝ returns ,2
⍎ &#39;{⍵⋆2} ⍳5&#39;          ⍝ returns 0 1 4 9 16
⍎ &#39;undefinedVariable&#39; ⍝ fails
⍎ &#39;1 2 (3&#39;            ⍝ fails</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>monadic <span class="string">'⍎'</span>, <span class="string">'Execute'</span>, (b) -&gt;
  s = <span class="string">''</span>
  <span class="keyword">for</span> c <span class="keyword">in</span> array b
    assert <span class="keyword">typeof</span> c <span class="keyword">is</span> <span class="string">'string'</span>,
      <span class="string">'The argument to ⍎ must be a character or a string.'</span>
    s += c
  require(<span class="string">'./compiler'</span>).exec s

monadic <span class="string">'⊣'</span>, <span class="string">'Stop'</span>, (b) -&gt; []
dyadic <span class="string">'⊣'</span>, <span class="string">'Left'</span>, (b, a) -&gt; a
monadic <span class="string">'⊢'</span>, <span class="string">'Pass'</span>, (b) -&gt; b
dyadic <span class="string">'⊢'</span>, <span class="string">'Right'</span>, (b, a) -&gt; b</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Zilde (<code>⍬</code>)</p>
<pre><code>⍬     ⍝ returns 0⍴0
⍴⍬    ⍝ returns ,0
⍬←5   ⍝ fails
⍳ 0   ⍝ returns ⍬
⍴ 0   ⍝ returns ⍬
⍬     ⍝ returns ⍬
⍬⍬    ⍝ returns ⍬ ⍬
1⍬2⍬3 ⍝ returns 1 ⍬ 2 ⍬ 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>@[<span class="string">'get_⍬'</span>] = -&gt; []
@[<span class="string">'set_⍬'</span>] = -&gt; die <span class="string">'Symbol zilde (⍬) is read-only.'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Index origin (<code>⎕IO</code>)</p>
<p>The index origin is fixed at 0.  Reading it returns 0.  Attempts to set it
to anything other than that fail.</p>
<pre><code>⎕IO     ⍝ returns 0
⎕IO←0   ⍝ returns 0
⎕IO←1   ⍝ fails</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>@[<span class="string">'get_⎕IO'</span>] = -&gt; <span class="number">0</span>
@[<span class="string">'set_⎕IO'</span>] = (x) -&gt;
  <span class="keyword">if</span> x <span class="keyword">isnt</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">throw</span> Error <span class="string">'The index origin (⎕IO) is fixed at 0'</span> <span class="keyword">else</span> x</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h1>Built-in adverbs and conjunctions</h1>
<p>Helper for <code>/</code> and <code>⌿</code> in their adverbial sense</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">reduce</span></span> = (f, _, axis = -<span class="number">1</span>) -&gt; (b, a) -&gt;
  invokedAsMonadic = <span class="keyword">not</span> a?
  <span class="keyword">if</span> invokedAsMonadic <span class="keyword">then</span> a = <span class="number">0</span>
  a = floor num a
  isBackwards = a &lt; <span class="number">0</span>; <span class="keyword">if</span> isBackwards <span class="keyword">then</span> a = -a
  b = <span class="keyword">if</span> isSimple b <span class="keyword">then</span> [b] <span class="keyword">else</span> b
  sb = shapeOf b
  <span class="keyword">if</span> axis &lt; <span class="number">0</span> <span class="keyword">then</span> axis += sb.length
  assert <span class="number">0</span> &lt;= axis &lt; sb.length, <span class="string">'Invalid axis'</span>
  n = sb[axis]
  <span class="keyword">if</span> a <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> a = n
  <span class="keyword">if</span> sb.length <span class="keyword">is</span> <span class="number">1</span>
    items = b
  <span class="keyword">else</span>
    sItem = sb[...axis].concat sb[axis + <span class="number">1</span> ...] <span class="comment"># shape of an item</span>
    k = prod sb[axis + <span class="number">1</span> ...]
    items = <span class="keyword">for</span> [<span class="number">0.</span>..n] <span class="keyword">then</span> []
    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..b.length] <span class="keyword">then</span> items[floor(i / k) % n].push b[i]
    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..n] <span class="keyword">then</span> items[i] = withShape sItem, items[i]
  r =
    <span class="keyword">if</span> isBackwards
      <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0</span> ... n - a + <span class="number">1</span>]
        x = items[i + a - <span class="number">1</span>]
        <span class="keyword">for</span> j <span class="keyword">in</span> [i + a - <span class="number">2</span> ... i - <span class="number">1</span>] <span class="keyword">by</span> -<span class="number">1</span> <span class="keyword">then</span> x = f items[j], x
        x
    <span class="keyword">else</span>
      <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0</span> ... n - a + <span class="number">1</span>]
        x = items[i]
        <span class="keyword">for</span> j <span class="keyword">in</span> [i + <span class="number">1</span> ... i + a] <span class="keyword">by</span> <span class="number">1</span> <span class="keyword">then</span> x = f items[j], x
        x
  <span class="keyword">if</span> invokedAsMonadic <span class="keyword">then</span> r[<span class="number">0</span>] <span class="keyword">else</span> r</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Helper for <code>/</code> and <code>⌿</code> in their verbal sense</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">compressOrReplicate</span></span> = (b, a, axis = -<span class="number">1</span>) -&gt;
  <span class="keyword">if</span> isSimple b <span class="keyword">then</span> b = [b]
  sb = shapeOf b
  <span class="keyword">if</span> axis &lt; <span class="number">0</span> <span class="keyword">then</span> axis += sb.length
  assert <span class="number">0</span> &lt;= axis &lt; sb.length, <span class="string">'Axis out of bounds'</span>
  sr = sb[<span class="number">0.</span>..]
  sr[axis] = <span class="number">0</span>
  assert shapeOf(a).length &lt;= <span class="number">1</span>,
    <span class="string">'Left argument to / must be an integer or a vector of integers'</span>
  <span class="keyword">if</span> <span class="keyword">not</span> a.length <span class="keyword">then</span> a = <span class="keyword">for</span> [<span class="number">0.</span>..sb[axis]] <span class="keyword">then</span> a

  nNonNegative = <span class="number">0</span> <span class="comment"># number of non-negative elements in a</span>
  <span class="keyword">for</span> x <span class="keyword">in</span> a
    assert <span class="keyword">typeof</span> x <span class="keyword">is</span> <span class="string">'number'</span> <span class="keyword">and</span> x <span class="keyword">is</span> floor x,
      <span class="string">'Left argument to / must be an integer or a vector of integers'</span>
    sr[axis] += abs x
    nNonNegative += (x &gt;= <span class="number">0</span>)

  isExtensive = <span class="literal">true</span>; isExpansive = isHyperexpansive = <span class="literal">false</span>
  <span class="keyword">if</span> sb[axis] <span class="keyword">isnt</span> <span class="number">1</span>
    isExtensive = <span class="literal">false</span>
    isExpansive = a.length <span class="keyword">is</span> sb[axis]
    isHyperexpansive = <span class="keyword">not</span> isExpansive
    assert((<span class="keyword">not</span> isHyperexpansive) <span class="keyword">or</span> nNonNegative <span class="keyword">is</span> sb[axis],
      <span class="string">'For A/B, the length of B along the selected axis '</span> +
      <span class="string">'must be equal either to one, '</span> +                 <span class="comment"># extension</span>
      <span class="string">'or the length of A, '</span> +                          <span class="comment"># expansion</span>
      <span class="string">'or to the number of non-negative elements in A.'</span> <span class="comment"># hyperexpansion</span>
    )
  r = []
  ni = prod sb[... axis]
  nj = sb[axis]
  nk = prod sb[axis + <span class="number">1</span> ...]
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..ni]
    j = <span class="number">0</span>
    <span class="keyword">for</span> x <span class="keyword">in</span> a
      <span class="keyword">if</span> x &gt; <span class="number">0</span>
        <span class="keyword">for</span> [<span class="number">0.</span>..x]
          <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..nk]
            r.push b[k + nk*(j + nj*i)]
        j += isExpansive <span class="keyword">or</span> isHyperexpansive
      <span class="keyword">else</span>
        filler = prototypeOf(
          <span class="keyword">if</span> isExpansive <span class="keyword">then</span> [b[nk*(j + nj*i)]] <span class="keyword">else</span> [b[nk*nj*i]]
        )
        <span class="keyword">for</span> [<span class="number">0.</span>..-x*nk]
          r.push filler
        j += isExpansive

  withShape sr, r</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Reduce, compress, or replicate (<code>/</code>)</p>
<p>Reduce</p>
<pre><code>+/ 3                       ⍝ returns 3
+/ 3 5 8                   ⍝ returns 16
+/ 2 4 6                   ⍝ returns 12
⌈/ 82 66 93 13             ⍝ returns 93
×/ 2 3 ⍴ 1 2 3 4 5 6       ⍝ returns 6 120
2 ,/ &#39;AB&#39; &#39;CD&#39; &#39;EF&#39; &#39;HI&#39;   ⍝ returns &#39;ABCD&#39; &#39;CDEF&#39; &#39;EFHI&#39;
3 ,/ &#39;AB&#39; &#39;CD&#39; &#39;EF&#39; &#39;HI&#39;   ⍝ returns &#39;ABCDEF&#39; &#39;CDEFHI&#39;</code></pre>
<p>N-Wise reduce</p>
<pre><code>2 +/ 1 + ⍳10    ⍝ returns 3 5 7 9 11 13 15 17 19
5 +/ 1 + ⍳10    ⍝ returns 15 20 25 30 35 40
10 +/ 1 + ⍳10   ⍝ returns ,55
11 +/ 1 + ⍳10   ⍝ returns ⍬
2 −/ 3 4 9 7    ⍝ returns ¯1 ¯5 2
¯2 −/ 3 4 9 7   ⍝ returns 1 5 ¯2</code></pre>
<p>Compress</p>
<pre><code>0 1 0 1 / &#39;ABCD&#39;                                ⍝ returns &#39;BD&#39;
1 1 1 1 0 / 12 14 16 18 20                      ⍝ returns 12 14 16 18
MARKS←45 60 33 50 66 19 ◇ (MARKS≥50)/MARKS      ⍝ returns 60 50 66
MARKS←45 60 33 50 66 19 ◇ (MARKS=50)/⍳↑⍴MARKS   ⍝ returns ,3
1/&quot;FREDERIC&quot;                                    ⍝ returns &#39;FREDERIC&#39;
0/&quot;FREDERIC&quot;                                    ⍝ returns ⍬
0 1 0  / 1+2 3⍴⍳6                               ⍝ returns 2 1 ⍴ 2 5
1 0 /[0] 1+2 3⍴⍳6                               ⍝ returns 1 3 ⍴ 1 2 3
1 0 ⌿    1+2 3⍴⍳6                               ⍝ returns 1 3 ⍴ 1 2 3
3 / 5                                           ⍝ returns 5 5 5</code></pre>
<p>Replicate</p>
<pre><code>2 ¯2 2 / 1+2 3⍴⍳6
... ⍝ returns 2 6 ⍴  1 1 0 0 3 3  4 4 0 0 6 6
2 ¯2 2 ¯2 2 / 1+2 3⍴⍳6
... ⍝ returns 2 10 ⍴  1 1 0 0 2 2 0 0 3 3  4 4 0 0 5 5 0 0 6 6
1 1 ¯2 1 1 / 1 2 (2 2⍴⍳4) 3 4     ⍝ returns 1 2 (2 2⍴0) (2 2⍴0) 3 4
1 1 ¯2 1 1 1 / 1 2 (2 2⍴⍳4) 3 4   ⍝ returns 1 2 0 0 (2 2⍴0 1 2 3) 3 4
2 3 2 / &quot;ABC&quot;             ⍝ returns &#39;AABBBCC&#39;
2 / &quot;DEF&quot;                 ⍝ returns &#39;DDEEFF&#39;
5 0 5 / 1 2 3             ⍝ returns 1 1 1 1 1 3 3 3 3 3
2 / 1+2 3⍴⍳6              ⍝ returns 2 6 ⍴  1 1 2 2 3 3  4 4 5 5 6 6
2 ⌿ 1+2 3⍴⍳6              ⍝ returns 4 3 ⍴  1 2 3  1 2 3  4 5 6  4 5 6
2 3 / 3 1⍴&quot;ABC&quot;           ⍝ returns 3 5 ⍴ &#39;AAAAABBBBBCCCCC&#39;
2 ¯1 2 /[1] 3 1⍴(7 8 9)   ⍝ returns 3 5 ⍴ 7 7 0 7 7 8 8 0 8 8 9 9 0 9 9
2 ¯1 2 /[1] 3 1⍴&quot;ABC&quot;     ⍝ returns 3 5 ⍴ &#39;AA AABB BBCC CC&#39;
2 ¯2 2 / 7                ⍝ returns 7 7 0 0 7 7</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>postfixAdverb <span class="string">'/'</span>, <span class="string">'Reduce, compress, or replicate'</span>, (b, a, axis = -<span class="number">1</span>) -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> b <span class="keyword">is</span> <span class="string">'function'</span>
    reduce b, <span class="literal">undefined</span>, axis
  <span class="keyword">else</span>
    compressOrReplicate b, a, axis</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>1st axis reduce, compress, or replicate (<code>⌿</code>)</p>
<pre><code>+⌿ 2 3 ⍴ 1 2 3 10 20 30   ⍝ returns 11 22 33</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>postfixAdverb <span class="string">'⌿'</span>, <span class="string">'1st axis reduce, compress, or replicate'</span>,
  (b, a, axis = <span class="number">0</span>) -&gt;
    <span class="keyword">if</span> <span class="keyword">typeof</span> b <span class="keyword">is</span> <span class="string">'function'</span>
      reduce b, <span class="literal">undefined</span>, axis
    <span class="keyword">else</span>
      compressOrReplicate b, a, axis</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Helper for <code>\</code> and <code>⍀</code> in their adverbial sense</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">scan</span></span> = (f, _, axis = -<span class="number">1</span>) -&gt; (b, a) -&gt;
  assert <span class="keyword">not</span> a?, <span class="string">'Scan can only be applied monadically.'</span>
  sb = shapeOf b
  <span class="keyword">if</span> sb.length <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> b
  <span class="keyword">if</span> axis &lt; <span class="number">0</span> <span class="keyword">then</span> axis += sb.length
  assert <span class="number">0</span> &lt;= axis &lt; sb.length, <span class="string">'Invalid axis'</span>
  r = Array b.length
  ni = prod sb[...axis]
  nj = sb[axis]
  nk = prod sb[axis + <span class="number">1</span> ...]
  <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..ni]
    <span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">0.</span>..nk]
      <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="number">0.</span>..nj]
        ijk = (i * nj + j) * nk + k
        x = b[ijk]
        <span class="keyword">for</span> t <span class="keyword">in</span> [j - <span class="number">1.</span><span class="number">.0</span>] <span class="keyword">by</span> -<span class="number">1</span>
          x = f x, b[(i * nj + t) * nk + k]
        r[ijk] = x
  withShape shapeOf(b), r</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Helper for <code>\</code> and <code>⍀</code> in their verbal sense</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">expand</span></span> = -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>todo</p>
<p>Scan or expand (<code>\</code>)</p>
<pre><code>+\ 20 10 ¯5 7              ⍝ returns 20 30 25 32
,\ &quot;AB&quot; &quot;CD&quot; &quot;EF&quot;          ⍝ returns &#39;AB&#39; &#39;ABCD&#39; &#39;ABCDEF&#39;
×\ 2 3⍴5 2 3 4 7 6         ⍝ returns 2 3 ⍴ 5 10 30 4 28 168
∧\ 1 1 1 0 1 1             ⍝ returns 1 1 1 0 0 0
//gives &#39;−\1 2 3 4&#39;, [1, -1, 2, -2] # todo
∨\ 0 0 1 0 0 1 0           ⍝ returns 0 0 1 1 1 1 1
+\ 1 2 3 4 5               ⍝ returns 1 3 6 10 15
+\ (1 2 3)(4 5 6)(7 8 9)   ⍝ returns (1 2 3) (5 7 9) (12 15 18)
M←2 3⍴1 2 3 4 5 6 ◇ +\M    ⍝ returns 2 3 ⍴ 1 3 6 4 9 15
M←2 3⍴1 2 3 4 5 6 ◇ +⍀M    ⍝ returns 2 3 ⍴ 1 2 3 5 7 9
//gives &#39;M←2 3⍴1 2 3 4 5 6 ◇ +\[0]M&#39;, [1, 2, 3, 5, 7, 9] # todo
,\ &#39;ABC&#39;                   ⍝ returns (↑&#39;A&#39;) &#39;AB&#39; &#39;ABC&#39;
T←&quot;ONE(TWO) BOOK(S)&quot; ◇ ≠\T∈&quot;()&quot;
... ⍝ returns 0 0 0 1 1 1 1 0 0 0 0 0 0 1 1 0
T←&quot;ONE(TWO) BOOK(S)&quot; ◇ ((T∈&quot;()&quot;)⍱≠\T∈&quot;()&quot;)/T   ⍝ returns &#39;ONE BOOK&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>postfixAdverb <span class="string">'\\'</span>, <span class="string">'Scan or expand'</span>, (b, a, axis = -<span class="number">1</span>) -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> b <span class="keyword">is</span> <span class="string">'function'</span>
    scan b, <span class="literal">undefined</span>, axis
  <span class="keyword">else</span>
    expand b, a, axis</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>1st axis scan or expand (<code>⍀</code>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>postfixAdverb <span class="string">'⍀'</span>, <span class="string">'1st axis scan or expand'</span>, (b, a, axis = <span class="number">0</span>) -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> b <span class="keyword">is</span> <span class="string">'function'</span>
    scan b, <span class="literal">undefined</span>, axis
  <span class="keyword">else</span>
    expand b, a, axis</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Each (<code>¨</code>)</p>
<pre><code>⍴¨ (0 0 0 0) (0 0 0)                 ⍝ returns (,4) (,3)
⍴¨ &quot;MONDAY&quot; &quot;TUESDAY&quot;                ⍝ returns (,6) (,7)
⍴    (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴&quot;K&quot;)   ⍝ returns ,4
⍴¨   (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴&quot;K&quot;)   ⍝ returns (2 2) (,10) ⍬ (3 4)
⍴⍴¨  (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴&quot;K&quot;)   ⍝ returns ,4
⍴¨⍴¨ (2 2⍴⍳4) (⍳10) 97.3 (3 4⍴&quot;K&quot;)   ⍝ returns (,2) (,1) (,0) (,2)
(1 2 3) ,¨ 4 5 6                     ⍝ returns (1 4) (2 5) (3 6)
2 3 ↑¨ &#39;MONDAY&#39; &#39;TUESDAY&#39;            ⍝ returns &#39;MO&#39; &#39;TUE&#39;
2 ↑¨ &#39;MONDAY&#39; &#39;TUESDAY&#39;              ⍝ returns &#39;MO&#39; &#39;TU&#39;
2 3 ⍴¨ 1 2                           ⍝ returns (1 1) (2 2 2)
4 5 ⍴¨ &quot;THE&quot; &quot;CAT&quot;                   ⍝ returns &#39;THET&#39; &#39;CATCA&#39;
{1+⍵⋆2}¨ 2 3 ⍴ ⍳ 6                   ⍝ returns 2 3 ⍴ 1 2 5 10 17 26</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>postfixAdverb <span class="string">'¨'</span>, <span class="string">'Each'</span>, (f) -&gt; (b, a) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> a?
    <span class="keyword">return</span> withShape shapeOf(b), (<span class="keyword">for</span> x <span class="keyword">in</span> array b <span class="keyword">then</span> f x)
  <span class="keyword">if</span> isSimple a
    <span class="keyword">return</span> withShape shapeOf(b), (<span class="keyword">for</span> x <span class="keyword">in</span> array b <span class="keyword">then</span> f x, a)
  <span class="keyword">if</span> match shapeOf(a), shapeOf(b)
    <span class="keyword">return</span> withShape shapeOf(b), (<span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..a.length] <span class="keyword">then</span> f b[i], a[i])
  <span class="keyword">if</span> a.length <span class="keyword">is</span> <span class="number">1</span>
    <span class="keyword">return</span> withShape shapeOf(b), (<span class="keyword">for</span> x <span class="keyword">in</span> b <span class="keyword">then</span> f x, a[<span class="number">0</span>])
  <span class="keyword">if</span> b.length <span class="keyword">is</span> <span class="number">1</span>
    <span class="keyword">return</span> withShape shapeOf(a), (<span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> f b[<span class="number">0</span>], x)
  die <span class="string">'Length error'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Outer product</p>
<pre><code>2 3 4 ∘.× 1 2 3 4
...     ⍝ returns (3 4⍴
...         2 4  6  8
...         3 6  9 12
...         4 8 12 16)

0 1 2 3 4 ∘.! 0 1 2 3 4
...     ⍝ returns (5 5⍴
...         1 1 1 1 1
...         0 1 2 3 4
...         0 0 1 3 6
...         0 0 0 1 4
...         0 0 0 0 1)

1 2 ∘., 1+⍳3
...     ⍝ returns (2 3⍴
...         (1 1) (1 2) (1 3)
...         (2 1) (2 2) (2 3))

⍴ 1 2 ∘., 1+⍳3   ⍝ returns 2 3

2 3 ∘.↑ 1 2
...     ⍝ returns (2 2⍴
...           (1 0)   (2 0)
...         (1 0 0) (2 0 0))

⍴ 2 3 ∘.↑ 1 2     ⍝ returns 2 2
⍴ ((4 3 ⍴ 0) ∘.+ (5 2 ⍴ 0))   ⍝ returns 4 3 5 2
2 3 ∘.× 4 5       ⍝ returns 2 2⍴ 8 10 12 15
2 3 ∘.{⍺×⍵} 4 5   ⍝ returns 2 2⍴ 8 10 12 15</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>prefixAdverb <span class="string">'∘.'</span>, <span class="string">'Outer product'</span>, <span class="function"><span class="title">outerProduct</span></span> = (f) -&gt;
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  (b, a) -&gt;
    assert a?, <span class="string">'Adverb ∘. (Outer product) can be applied to dyadic verbs only'</span>
    a = array a
    b = array b
    r = []
    <span class="keyword">for</span> x <span class="keyword">in</span> a <span class="keyword">then</span> <span class="keyword">for</span> y <span class="keyword">in</span> b <span class="keyword">then</span> r.push f y, x
    withShape (shapeOf a).concat(shapeOf b), r</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Inner product (<code>.</code>)</p>
<p>todo: the general formula for higher dimensions is
<code>A f.g B   &lt;=&gt;   f/¨ (⊂[⍴⍴A]A)∘.g ⊂[1]B</code></p>
<pre><code>(1 3 5 7) +.= 2 3 6 7   ⍝ returns 2
(1 3 5 7) ∧.= 2 3 6 7   ⍝ returns 0
(1 3 5 7) ∧.= 1 3 5 7   ⍝ returns 1</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>conjunction <span class="string">'.'</span>, <span class="string">'Inner product'</span>, (g, f) -&gt;
  F = reduce f
  (b, a) -&gt;
    assert shapeOf(a).length &lt;= <span class="number">1</span> <span class="keyword">and</span> shapeOf(b).length &lt;= <span class="number">1</span>,
      <span class="string">'Inner product (.) is implemented only for '</span> +
      <span class="string">'arrays of rank no more than 1.'</span>
    F g b, a</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Power operator (<code>⍣</code>)</p>
<pre><code>({⍵+1}⍣5) 3     ⍝ returns 8
({⍵+1}⍣0) 3     ⍝ returns 3
(⍴⍣3) 2 2⍴⍳4    ⍝ returns ,1
&#39;a&#39; (,⍣3) &#39;b&#39;   ⍝ returns &#39;aaab&#39;
1(+÷)⍣=1        ⍝ returns 1.618033988749895</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>conjunction <span class="string">'⍣'</span>, <span class="string">'Power operator'</span>, (g, f) -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'number'</span> <span class="keyword">and</span> <span class="keyword">typeof</span> g <span class="keyword">is</span> <span class="string">'function'</span>
    h = f; f = g; g = h
  <span class="keyword">else</span>
    assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  <span class="keyword">if</span> <span class="keyword">typeof</span> g <span class="keyword">is</span> <span class="string">'number'</span>
    (y, x) -&gt;
      <span class="keyword">for</span> [<span class="number">0.</span>..g] <span class="keyword">then</span> y = f y, x
      y
  <span class="keyword">else</span>
    (y, x) -&gt;
      <span class="keyword">loop</span>
        y1 = f y, x
        <span class="keyword">if</span> g y, y1 <span class="keyword">then</span> <span class="keyword">return</span> y
        y = y1</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p><a href="http://www.jsoftware.com/papers/opfns1.htm#3">Commute</a> (<code>⍨</code>)</p>
<p>Definition: <code>x f⍨ y  &lt;-&gt;  y f x</code></p>
<pre><code>17 −⍨ 23    ⍝ returns 6
7 ⍴⍨ 2 3    ⍝ returns 2 3⍴7
−⍨ 123      ⍝ returns ¯123</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>postfixAdverb <span class="string">'⍨'</span>, <span class="string">'Commute'</span>, (f) -&gt;
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  (b, a, axis) -&gt; <span class="keyword">if</span> a? <span class="keyword">then</span> f a, b, axis <span class="keyword">else</span> f b, <span class="literal">undefined</span>, axis

@[<span class="string">'get_⎕'</span>] = -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> window?.prompt <span class="keyword">is</span> <span class="string">'function'</span>
    prompt(<span class="string">'⎕:'</span>) <span class="keyword">or</span> <span class="string">''</span>
  <span class="keyword">else</span>
    die <span class="string">'Reading from ⎕ is not implemented.'</span>

@[<span class="string">'set_⎕'</span>] = (x) -&gt;
  s = formatter.format(x).join(<span class="string">'\n'</span>) + <span class="string">'\n'</span>; x
  <span class="keyword">if</span> <span class="keyword">typeof</span> window?.alert <span class="keyword">is</span> <span class="string">'function'</span>
    window.alert s
  <span class="keyword">else</span>
    process.stdout.write s
  x

@[<span class="string">'get_⍞'</span>] = -&gt;
  <span class="keyword">if</span> <span class="keyword">typeof</span> window?.prompt <span class="keyword">is</span> <span class="string">'function'</span>
    prompt(<span class="string">''</span>) <span class="keyword">or</span> <span class="string">''</span>
  <span class="keyword">else</span>
    die <span class="string">'Reading from ⍞ is not implemented.'</span>

@[<span class="string">'set_⍞'</span>] = (x) -&gt;
  s = formatter.format(x).join(<span class="string">'\n'</span>); x
  <span class="keyword">if</span> <span class="keyword">typeof</span> window?.alert <span class="keyword">is</span> <span class="string">'function'</span>
    window.alert s
  <span class="keyword">else</span>
    process.stdout.write s
  x

@[<span class="string">'⎕aplify'</span>] = (x) -&gt;
  assert x <span class="keyword">isnt</span> <span class="literal">null</span>
  assert <span class="keyword">typeof</span> x <span class="keyword">isnt</span> <span class="string">'undefined'</span>
  <span class="keyword">if</span> <span class="keyword">typeof</span> x <span class="keyword">is</span> <span class="string">'string'</span> <span class="keyword">and</span> x.length <span class="keyword">isnt</span> <span class="number">1</span>
    x = withPrototype <span class="string">' '</span>, x.split <span class="string">''</span>
  x

@[<span class="string">'⎕bool'</span>] = bool

@[<span class="string">'⎕complex'</span>] = require(<span class="string">'./complex'</span>).Complex</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p><a href="http://www.jsoftware.com/papers/fork1.htm">Phrasal forms</a></p>
<p>Hook: <code>(fg)⍵ ←→ ⍵fg⍵</code> ; <code>⍺(fg)⍵ ←→ ⍺fg⍵</code></p>
<pre><code># Approximations of pi through continued fractions
(+÷)\3 7 16 ¯294
... ⍝ returns (3
...            3.142857142857143
...            3.1415929203539825
...            3.141592653921421)

# Test if a number is an integer
(=⌊) 123     ⍝ returns 1
(=⌊) 123.4   ⍝ returns 0

# Approximation of the number of primes below a certain limit
(÷⍟) 1000    ⍝ returns 144.76482730108395</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>@[<span class="string">'⎕hook'</span>] = (g, f) -&gt;
  assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  assert <span class="keyword">typeof</span> g <span class="keyword">is</span> <span class="string">'function'</span>
  (b, a) -&gt; f g(b), (a ? b)</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Fork: <code>(fgh)⍵ ←→ (f⍵)g(h⍵)</code> ; <code>⍺(fgh)⍵ ←→ (⍺f⍵)g(⍺h⍵)</code></p>
<pre><code># Arithmetic mean
avg ← +/ ÷ ⍴   ◇ avg 4 5 10 7   ⍝ returns ,6.5

# Quadratic equation
a←1 ◇ b←¯22 ◇ c←85
... √ ← {⍵⋆.5}
... ((−b)(+,−)√(b⋆2)−4×a×c) ÷ 2×a
... ⍝ returns 17 5

# Trains (longer forks)
(+,−,×,÷) 2     ⍝ returns 2 ¯2 1 .5
1 (+,−,×,÷) 2   ⍝ returns 3 ¯1 2 .5</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>@[<span class="string">'⎕fork'</span>] = (verbs) -&gt;
  assert verbs.length % <span class="number">2</span> <span class="keyword">is</span> <span class="number">1</span>
  assert verbs.length &gt;= <span class="number">3</span>
  <span class="keyword">for</span> f <span class="keyword">in</span> verbs <span class="keyword">then</span> assert <span class="keyword">typeof</span> f <span class="keyword">is</span> <span class="string">'function'</span>
  (b, a) -&gt;
    r = verbs[verbs.length - <span class="number">1</span>] b, a
    <span class="keyword">for</span> i <span class="keyword">in</span> [verbs.length - <span class="number">2</span> ... <span class="number">0</span>] <span class="keyword">by</span> -<span class="number">2</span>
      r = verbs[i] r, verbs[i - <span class="number">1</span>] b, a
    r

endOfVocabulary()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
