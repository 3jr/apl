<!DOCTYPE html>  <html> <head>   <title>builtins.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="browser.html">                 browser.coffee               </a>                                           <a class="source" href="builtins.html">                 builtins.coffee               </a>                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="complex.html">                 complex.coffee               </a>                                           <a class="source" href="grammar.html">                 grammar.coffee               </a>                                           <a class="source" href="helpers.html">                 helpers.coffee               </a>                                           <a class="source" href="interpreter.html">                 interpreter.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               builtins.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="c1">#!/usr/bin/env coffee</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This file contains an implementation of APL's built-in functions and
operators.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h1>APL objects</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>APL's data structures are multidimensional arrays:</p>

<ul>
<li><p>(rank 0) Scalars---can be:</p>

<ul><li><p>simple scalars, like numbers and characters</p></li>
<li><p>an APL array of rank zero, containing exactly one element</p></li></ul></li>
<li><p>(rank 1) Vectors---sequences of APL objects with zero or more elements</p></li>
<li><p>(rank 2) Matrices---two-dimensional arrays of APL objects</p></li>
<li><p>(rank 3+) Cubes, etc</p></li>
</ul>

<p>APL arrays are not necessarily heterogenous, they may contain data of mixed
types.</p>

<p>An array in APL is aware of its own dimensions, so there is an essential
difference between a vector of vectors and a matrix.  To reflect this in
JavaScript objects, we use the following convention:</p>

<ul>
<li><p>APL scalars:</p>

<ul><li><p>Simple scalars: APL numbers are JavaScript numbers and APL characters
are JavaScript one-character strings.</p></li>
<li><p>A zero-rank APL array is a JavaScript array of size one with a
<code>shape</code> property of <code>[]</code>, e.g. created by:</p>

<pre><code>  var a = []; a.shape = [];
</code></pre></li></ul></li>
<li><p>An APL vector is a JavaScript array.</p></li>
<li><p>An APL matrix, cube, etc is a JavaScript array with an additional <code>shape</code>
property, describing the dimensions of the APL array.  E.g. a 2-by-2-by-3
cube of zeroes may be constructed via:</p>

<pre><code>  function createSomeCube() {
      var cube = [
          0, // Element at indices [0;0;0]
          0, // Element at indices [0;0;1]
          0, // Element at indices [0;0;2]
          0, // Element at indices [0;1;0]
          0, // Element at indices [0;1;1]
          // ...
          0  // Element at indices [1;1;2]
      ];
      cube.shape = [2, 2, 3];
      return cube;
  }
</code></pre>

<p>A vector's representation, as opposed to that of higher-dimension
  arrays, is not required to have a <code>shape</code> property.  The shape of a
  vector <code>v</code> is assumed to be <code>[v.length]</code>, by convention.  Similarly, we
  could say that a scalar's shape is <code>[]</code> by convention.</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h1>APL prototypes</h1>

<p>Every object in APL, including empty arrays, has a <em>prototype</em> used whenever
"padding material" is needed, such as in the <em>take</em> function:</p>

<pre><code>5 ↑ 1 2 3     ⍝ gives      1 2 3 0 0
5 ↑ 'abc'     ⍝ gives      'abc  '
</code></pre>

<p>Prototypes are defined recursively:</p>

<ul>
<li><p>For numbers, the prototype is <code>0</code>.</p></li>
<li><p>For characters, the prototype is a space, <code>' '</code>.</p></li>
<li><p>For non-empty arrays, the prototype is the prototype of the first
element, repeated and arranged to fit the first element's shape.  E.g. the
prototype of <code>((1 2) 'a' (1 2 3))</code> is <code>(0 0)</code>.</p></li>
<li><p>For empty arrays, the prototype is determined by the operation used to
construct the array.  Usually it is copied from another array.</p></li>
</ul>

<p>To represent this in JavaScript, we simply use the first elements of arrays
and calculate it dynamically.  For empty arrays, we put an additional
<code>aplPrototype</code> property on the array, like so:</p>

<pre><code>var a = [];
a.aplPrototype = ' ';

var b = [];
b.aplPrototype = [0, 0, 0, 0];
b.aplPrototype.shape = [2, 2];
</code></pre>

<p>If an empty array has a prototype of <code>0</code>, we skip <code>aplPrototype</code> and leave
<code>0</code> as an implicit default.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>Utility functions</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">{</span><span class="nx">cps</span><span class="p">,</span> <span class="nx">cpsify</span><span class="p">,</span> <span class="nx">isSimple</span><span class="p">,</span> <span class="nx">shapeOf</span><span class="p">,</span> <span class="nx">withShape</span><span class="p">,</span> <span class="nx">sum</span><span class="p">,</span> <span class="nx">prod</span><span class="p">,</span> <span class="nx">repeat</span><span class="p">,</span> <span class="nx">prototypeOf</span><span class="p">,</span> <span class="nx">withPrototype</span><span class="p">,</span> <span class="nx">withPrototypeCopiedFrom</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;./helpers&#39;</span>

<span class="nx">assert</span> <span class="o">=</span> <span class="p">(</span><span class="nx">flag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">flag</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Assertion failed.&#39;</span>

<span class="nx">arrayValueOf</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">x</span> <span class="k">then</span> <span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="k">else</span> <span class="nx">x</span>

<span class="nx">numericValueOf</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span>
    <span class="k">if</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Numeric scalar or singleton expected&#39;</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="s1">&#39;number&#39;</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Numeric scalar or singleton expected&#39;</span>
  <span class="nx">x</span>

<span class="nx">booleanValueOf</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="nx">numericValueOf</span> <span class="nx">x</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Boolean values must be either 0 or 1&#39;</span>
  <span class="nx">x</span>

<span class="nx">named</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">f</span> <span class="o">?=</span> <span class="o">-&gt;</span> <span class="s2">&quot;Function #{name} is not implemented.&quot;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">name</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
  <span class="nx">assert</span> <span class="o">not</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="o">?</span>
  <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span> <span class="o">=</span> <span class="nx">name</span>
  <span class="nx">f</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><code>pervasive(f)</code> is a decorator which takes a scalar function <code>f</code> and makes it
propagate through arrays.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">pervasive</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">named</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">F</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span>
  <span class="k">if</span> <span class="nx">b</span><span class="o">?</span> <span class="c1"># dyadic pervasiveness</span>
    <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">and</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">withShape</span> <span class="nx">b</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">withShape</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">sa</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">a</span><span class="p">;</span> <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
        <span class="k">if</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Length error&#39;</span>
      <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">k</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">...]</span>
        <span class="nx">withShape</span> <span class="nx">sa</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">])</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">k</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">...]</span>
        <span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">a</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
      <span class="k">else</span>
        <span class="nx">withShape</span> <span class="nx">sa</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
  <span class="k">else</span> <span class="c1"># monadic pervasiveness</span>
    <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">a</span>
    <span class="k">else</span> <span class="nx">withShape</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">F</span> <span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>overloadable(f)</code> decorates a named function <code>f</code> so that its arguments can
overload its behaviour by providing a method of the same name as the
function.  For instance, if <code>f</code> is the usual <em>addition</em> (named <code>'+'</code>),
then:</p>

<pre><code>var x = {
    '+': function (y) {
        console.info("hello");
        return y + 1234;
    }
};
return overloadable(f)(x, 1);
</code></pre>

<p>will print "hello" and return 1235.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">overloadable</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">named</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span>
    <span class="nx">assert</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">x</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">]</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span> <span class="k">then</span> <span class="nx">x</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">](</span><span class="nx">y</span><span class="p">,</span> <span class="nx">args</span><span class="p">...)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">y</span><span class="o">?</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">y</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">]</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span> <span class="k">then</span> <span class="nx">y</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">](</span><span class="nx">x</span><span class="p">,</span> <span class="nx">args</span><span class="p">...)</span>
    <span class="k">else</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">args</span><span class="p">...</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h1>DSL for defining functions and operators</h1>

<p><code>builtins</code> will be the prototype of all execution contexts, used by
<a href="interpreter.html">interpreter.coffee</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">builtins</span> <span class="o">=</span> <span class="nx">builtins</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nx">ambivalent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f1</span><span class="p">,</span> <span class="nx">f2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="c1"># combine a monadic and a dyadic function into one</span>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">f1</span><span class="p">.</span><span class="nx">aplName</span> <span class="o">and</span> <span class="p">(</span><span class="nx">f1</span><span class="p">.</span><span class="nx">aplName</span> <span class="o">is</span> <span class="nx">f2</span><span class="p">.</span><span class="nx">aplName</span><span class="p">))</span>
  <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="k">if</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="nx">f2</span> <span class="k">else</span> <span class="nx">f1</span><span class="p">)(</span><span class="nx">args</span><span class="p">...)</span>
  <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span> <span class="o">=</span> <span class="nx">f1</span><span class="p">.</span><span class="nx">aplName</span>
  <span class="nx">f</span>

<span class="nx">monadic</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">=</span> <span class="nx">builtins</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">])</span> <span class="k">then</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">ambivalent</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">g</span> <span class="k">else</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span>
  <span class="nx">builtins</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span>

<span class="nx">dyadic</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
  <span class="nx">assert</span> <span class="k">typeof</span> <span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">=</span> <span class="nx">builtins</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">])</span> <span class="k">then</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">ambivalent</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">f</span> <span class="k">else</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span>
  <span class="nx">builtins</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span>

<span class="nx">prefixOperator</span>  <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">isPrefixOperator</span>  <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">builtins</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span>
<span class="nx">postfixOperator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">isPostfixOperator</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">builtins</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span>
<span class="nx">infixOperator</span>   <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">isInfixOperator</span>   <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">builtins</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">aplName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h1>Built-in functions</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>+</code> Conjugate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><code>+</code> Add</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><code>−</code> Negate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;−&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><code>−</code> Subtract</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;−&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">x</span> <span class="o">-</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>×</code> Sign of</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;×&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><code>×</code> Multiply</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;×&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><code>÷</code> Reciprocal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;÷&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><code>÷</code> Divide</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;÷&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">x</span> <span class="o">/</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><code>⌈</code> Ceiling</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌈&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><code>⌈</code> Greater of</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌈&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><code>⌊</code> Floor</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌊&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><code>⌊</code> Lesser of</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌊&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><code>∣</code> Absolute value</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∣&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p><code>∣</code> Residue</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∣&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">y</span> <span class="o">%</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><code>⍳</code> Index generate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍳&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">a</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p><code>⍳</code> Index of</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍳&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><code>?</code> Roll</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><code>?</code> Deal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">x</span>
  <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">y</span>
  <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">y</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Domain error: left argument of ? must not be greater than its right argument.&#39;</span>
  <span class="nx">available</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">y</span><span class="p">]</span>
  <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">x</span><span class="p">]</span> <span class="k">then</span> <span class="nx">available</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">available</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p><code>⋆</code> Exponentiate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⋆&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">exp</span> <span class="nx">numericValueOf</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p><code>⋆</code> To the power of</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⋆&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span> <span class="nx">numericValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">numericValueOf</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p><code>⍟</code> Natural logarithm</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍟&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p><code>⍟</code> Logarithm to the base</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍟&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p><code>○</code> Pi times</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;○&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="nx">x</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><code>○</code> Circular and hyperbolic functions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;○&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">switch</span> <span class="nx">i</span>
    <span class="k">when</span> <span class="mi">0</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span>
    <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="mi">2</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="mi">3</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">tan</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="mi">4</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span>
    <span class="k">when</span> <span class="mi">5</span> <span class="k">then</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># sinh</span>
    <span class="k">when</span> <span class="mi">6</span> <span class="k">then</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># cosh</span>
    <span class="k">when</span> <span class="mi">7</span> <span class="k">then</span> <span class="nx">ex</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">x</span><span class="p">);</span> <span class="p">(</span><span class="nx">ex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># tanh</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">asin</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">2</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">acos</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">3</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span> <span class="nx">x</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">4</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">5</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># arcsinh</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">6</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="c1"># arccosh</span>
    <span class="k">when</span> <span class="o">-</span><span class="mi">7</span> <span class="k">then</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">x</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># arctanh</span>
    <span class="k">else</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Unknown circular or hyperbolic function &#39;</span> <span class="o">+</span> <span class="nx">i</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p><code>!</code> Factorial</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">n</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">a</span> <span class="c1"># todo: &quot;Gamma&quot; function for non-integer argument</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">(</span><span class="k">if</span> <span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">2</span> <span class="p">..</span> <span class="nx">n</span><span class="p">]</span> <span class="k">then</span> <span class="nx">r</span> <span class="o">*=</span> <span class="nx">i</span><span class="p">);</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><code>!</code> Binomial</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">k</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">a</span>
  <span class="nx">n</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">k</span> <span class="o">&lt;=</span> <span class="nx">n</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span> <span class="c1"># todo: Special cases for negatives and non-integers</span>
  <span class="k">if</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">k</span> <span class="o">&gt;</span> <span class="nx">n</span> <span class="k">then</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">n</span> <span class="o">-</span> <span class="nx">k</span> <span class="c1"># do less work</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">(</span><span class="k">if</span> <span class="nx">k</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span> <span class="p">..</span> <span class="nx">k</span><span class="p">]</span> <span class="k">then</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">r</span> <span class="o">*</span> <span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="nx">k</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span> <span class="o">/</span> <span class="nx">i</span><span class="p">);</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p><code>⌹</code> Matrix inverse</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌹&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p><code>⌹</code> Matrix divide</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌹&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><code>&lt;</code> Less than</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span>    <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p><code>≤</code> Less than or equal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;≤&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span>   <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p><code>=</code> Equal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">is</span>   <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><code>&gt;</code> Greater than</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;≥&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&gt;=</span>   <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><code>≥</code> Greater than or equal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span>    <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><code>≠</code> Not equal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;≠&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="o">isnt</span> <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p><code>≡</code> Depth</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;≡&#39;</span><span class="p">,</span> <span class="nx">depthOf</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">r</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">depthOf</span> <span class="nx">x</span><span class="p">);</span> <span class="nx">r</span> <span class="o">+</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><code>≡</code> Match</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;≡&#39;</span><span class="p">,</span> <span class="nx">match</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">and</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="o">+</span><span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="nx">b</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">isnt</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Compare by shape</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">sa</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">when</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Compare by elements</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">match</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Compare by prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">1</span>
  <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">aplPrototype</span><span class="o">?</span> <span class="o">or</span> <span class="nx">b</span><span class="p">.</span><span class="nx">aplPrototype</span><span class="o">?</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">1</span>
  <span class="nx">match</span> <span class="nx">prototypeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">prototypeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p><code>≢</code> Not match</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;≢&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+not</span> <span class="nx">match</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p><code>∈</code> Enlist</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∈&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">x</span> <span class="k">else</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">y</span><span class="p">);</span> <span class="nx">r</span>
  <span class="nx">rec</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p><code>∈</code> Membership</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∈&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">arrayValueOf</span> <span class="nx">a</span>
  <span class="nx">b</span> <span class="o">=</span> <span class="nx">arrayValueOf</span> <span class="nx">b</span>
  <span class="nx">withShape</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shape</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="o">+</span><span class="p">(</span><span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p><code>⍷</code> Find</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍷&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p><code>∪</code> Unique</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∪&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p><code>∪</code> Union</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∪&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p><code>∩</code> Intersection</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∩&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p><code>∼</code> Not</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∼&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+!</span><span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p><code>∼</code> Without</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∼&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p><code>∨</code> Or</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∨&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">||</span> <span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p><code>∧</code> And</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;∧&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p><code>⍱</code> Nor</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍱&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+!</span><span class="p">(</span><span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">||</span> <span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p><code>⍲</code> Nand</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">pervasive</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍲&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">+!</span><span class="p">(</span><span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">booleanValueOf</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p><code>⍴</code> Shape of</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍴&#39;</span><span class="p">,</span> <span class="nx">shapeOf</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p><code>⍴</code> Reshape</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍴&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">b</span> <span class="o">=</span> <span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nx">a</span> <span class="o">=</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
      <span class="k">if</span> <span class="o">not</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s1">&#39;number&#39;</span>
        <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Domain error: Left argument to ⍴ must be a numeric scalar or vector.&#39;</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">x</span>
  <span class="nx">withShape</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">withPrototypeCopiedFrom</span> <span class="nx">b</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">prod</span> <span class="nx">a</span><span class="p">]</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p><code>,</code> Ravel</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">arrayValueOf</span><span class="p">(</span><span class="nx">a</span><span class="p">)[</span><span class="mi">0</span><span class="p">...]</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Helper for functions , and ⍪</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">catenate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">sa</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">a</span><span class="p">;</span> <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">sa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span><span class="p">;</span> <span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">sb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="nx">b</span> <span class="o">=</span> <span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Length error: Cannot catenate arrays of different ranks&#39;</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">when</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">and</span> <span class="nx">i</span> <span class="o">isnt</span> <span class="nx">axis</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Length error: Catenated arrays must match at all axes exept the one to catenate on&#39;</span>
  <span class="nx">ni</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sa</span><span class="p">[...</span><span class="nx">axis</span><span class="p">]</span>       <span class="c1"># number of items across all dimensions before `axis&#39;</span>
  <span class="nx">nja</span> <span class="o">=</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>              <span class="c1"># number of items across `axis&#39; in `a&#39;</span>
  <span class="nx">njb</span> <span class="o">=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>              <span class="c1"># number of items across `axis&#39; in `b&#39;</span>
  <span class="nx">nk</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>  <span class="c1"># number of items across all dimensions after `axis&#39;</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">ni</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nja</span><span class="p">]</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">a</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span> <span class="o">*</span> <span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nja</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">njb</span><span class="p">]</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span> <span class="o">*</span> <span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">njb</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)]</span>
  <span class="nx">sr</span> <span class="o">=</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">sa</span> <span class="k">then</span> <span class="nx">x</span>
  <span class="nx">sr</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p><code>,</code> Catenate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nx">catenate</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p><code>⍪</code> 1st axis catenate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍪&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">catenate</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p><code>⌽</code> Reverse</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌽&#39;</span><span class="p">,</span> <span class="nx">reverse</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">sa</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Axis out of bounds&#39;</span>
  <span class="nx">ni</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sa</span><span class="p">[...</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nx">nj</span> <span class="o">=</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nx">nk</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sa</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">ni</span><span class="p">]</span>
    <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">nj</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">..</span> <span class="mi">0</span><span class="p">]</span> <span class="nx">by</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">a</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span><span class="o">*</span><span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">)]</span>
  <span class="nx">withShape</span> <span class="nx">sa</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p><code>⌽</code> Rotate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌽&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">numericValueOf</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">b</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nx">n</span> <span class="o">=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
  <span class="nx">a</span> <span class="o">%=</span> <span class="nx">n</span><span class="p">;</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">+=</span> <span class="nx">n</span>
  <span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">n</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">n</span><span class="p">)</span> <span class="o">+</span> <span class="nx">a</span><span class="p">)</span> <span class="o">%</span> <span class="nx">n</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p><code>⊖</code> 1st axis reverse</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊖&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">reverse</span> <span class="nx">a</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p><code>⊖</code> 1st axis rotate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊖&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">numericValueOf</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">b</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="nx">n</span> <span class="o">=</span> <span class="nx">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nx">k</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">n</span>
  <span class="nx">a</span> <span class="o">%=</span> <span class="nx">n</span><span class="p">;</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">+=</span> <span class="nx">n</span>
  <span class="nx">withShape</span> <span class="nx">sb</span><span class="p">,</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">b</span><span class="p">[((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">)</span> <span class="o">+</span> <span class="nx">a</span><span class="p">)</span> <span class="o">%</span> <span class="nx">n</span><span class="p">)</span> <span class="o">*</span> <span class="nx">k</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">k</span><span class="p">)])</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p><code>⍉</code> Transpose</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍉&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">sa</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">a</span> <span class="c1"># has no effect on scalars or vectors</span>
  <span class="nx">sr</span> <span class="o">=</span> <span class="nx">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">...].</span><span class="nx">reverse</span><span class="p">()</span>
  <span class="nx">psr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># partial products over sr</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">then</span> <span class="nx">psr</span><span class="p">.</span><span class="nx">push</span> <span class="nx">psr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">sr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sr</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span><span class="o">*</span><span class="nx">psr</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p><code>↑</code> First</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;↑&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">arrayValueOf</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nx">prototypeOf</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p><code>↑</code> Take</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;↑&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
    <span class="k">if</span> <span class="o">not</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">is</span> <span class="s1">&#39;number&#39;</span>
      <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Domain error: Left argument to ↑ must be a numeric scalar or vector.&#39;</span>
  <span class="k">if</span> <span class="nx">isSimple</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">and</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">b</span> <span class="o">=</span> <span class="p">[</span><span class="nx">b</span><span class="p">]</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Length error: Left argument to ↑ must have as many elements as is the rank of its right argument.&#39;</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">pa</span> <span class="o">=</span> <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="mi">0</span>
  <span class="nx">pa</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="nx">i</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="k">while</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="nx">i</span><span class="o">--</span>
  <span class="nx">filler</span> <span class="o">=</span> <span class="nx">prototypeOf</span> <span class="nx">b</span>
  <span class="nx">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="nx">k</span> <span class="o">/=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">],</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">*</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">k</span>
        <span class="k">if</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
          <span class="k">for</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">-</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span> <span class="o">*</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
          <span class="k">for</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="o">-</span><span class="p">(</span><span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span> <span class="o">*</span> <span class="nx">pa</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span> <span class="p">...</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">*</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">k</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">withShape</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">withPrototype</span> <span class="nx">filler</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p><code>↓</code> Drop</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;↓&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">when</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="s1">&#39;number&#39;</span> <span class="o">or</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">x</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Left argument to ↓ must be an integer or a vector of integers.&#39;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">withShape</span> <span class="p">(</span><span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">b</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;The left argument to ↓ must have length less than or equal to the rank of its right argument.&#39;</span>
  <span class="k">for</span> <span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">...</span><span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">a</span><span class="p">.</span><span class="nx">push</span> <span class="mi">0</span>
  <span class="nx">lims</span> <span class="o">=</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span>
      <span class="k">else</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])]</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="nx">n</span> <span class="o">/=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">lims</span><span class="p">[</span><span class="nx">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]...</span><span class="nx">lims</span><span class="p">[</span><span class="nx">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span><span class="o">*</span><span class="nx">n</span><span class="p">,</span> <span class="nx">n</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">sr</span> <span class="o">=</span> <span class="k">for</span> <span class="p">[</span><span class="nx">lo</span><span class="p">,</span> <span class="nx">hi</span><span class="p">]</span> <span class="k">in</span> <span class="nx">lims</span> <span class="k">then</span> <span class="nx">hi</span> <span class="o">-</span> <span class="nx">lo</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p><code>⊂</code> Enclose</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊂&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">a</span> <span class="k">else</span> <span class="nx">withShape</span> <span class="p">[],</span> <span class="p">[</span><span class="nx">a</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p><code>⊂</code> Partition (with axis)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊂&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p><code>⊃</code> Disclose</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊃&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">a</span>
  <span class="nx">sa</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">a</span>
  <span class="k">if</span> <span class="nx">sa</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nx">sr1</span> <span class="o">=</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">...]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">...]</span>
    <span class="nx">sx</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">x</span>
    <span class="k">if</span> <span class="nx">sx</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">sr1</span><span class="p">.</span><span class="nx">length</span>
      <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;The argument of ⊃ must contain elements of the same rank.&#39;</span> <span class="c1"># todo: or scalars</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sr1</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
      <span class="nx">sr1</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">sr1</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
  <span class="nx">sr</span> <span class="o">=</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">concat</span> <span class="nx">sr1</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
    <span class="nx">sx</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">x</span>
    <span class="nx">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">N</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="c1"># d: dimension, i: index in x, n: block size in x, N: block size in r</span>
      <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">sr1</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="k">else</span>
        <span class="nx">n</span> <span class="o">/=</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
        <span class="nx">N</span> <span class="o">/=</span> <span class="nx">sr1</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">]]</span>
          <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">*</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">N</span>
        <span class="k">if</span> <span class="nx">sr1</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
          <span class="nx">filler</span> <span class="o">=</span> <span class="nx">prototypeOf</span> <span class="nx">x</span>
          <span class="k">for</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">N</span> <span class="o">*</span> <span class="p">(</span><span class="nx">sr1</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">-</span> <span class="nx">sx</span><span class="p">[</span><span class="nx">d</span><span class="p">])]</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
    <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">prod</span> <span class="nx">sr1</span>
  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p><code>⊃</code> Pick</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊃&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p><code>⌷</code> Index</p>

<p><code>(a0 a1 ...)⌷b</code> is equivalent to <code>b[a0;a1;...]</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⌷&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shape</span> <span class="o">and</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shape</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Indices must be a scalar or a vector, not a higher-dimensional array.&#39;</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;The number of indices must be equal to the rank of the indexable.&#39;</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="p">(</span><span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">x</span> <span class="k">then</span> <span class="nx">withShape</span> <span class="p">[],</span> <span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="k">else</span> <span class="nx">x</span><span class="p">)</span>
  <span class="k">for</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">d</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">x</span> <span class="k">when</span> <span class="o">not</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">y</span> <span class="o">is</span> <span class="s1">&#39;number&#39;</span> <span class="o">and</span> <span class="nx">y</span> <span class="o">is</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Indices must be integers&#39;</span>
  <span class="k">for</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">d</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">x</span> <span class="k">when</span> <span class="o">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span>
    <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Index out of bounds&#39;</span>
  <span class="nx">sr</span> <span class="o">=</span> <span class="p">[];</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">sr</span> <span class="o">=</span> <span class="nx">sr</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">shapeOf</span> <span class="nx">x</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">rec</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">d</span> <span class="o">&gt;=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="k">then</span> <span class="nx">rec</span> <span class="nx">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">n</span> <span class="o">/</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]),</span> <span class="nx">n</span> <span class="o">/</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span>
    <span class="mi">0</span>
  <span class="nx">rec</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">if</span> <span class="nx">sr</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p><code>⍋</code> Grade up</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍋&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p><code>⍒</code> Grade down</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍒&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p><code>⊤</code> Encode</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊤&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p><code>⊥</code> Decode</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊥&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p><code>⍕</code> Format</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍕&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p><code>⍕</code> Format by example or specification</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍕&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p><code>⍎</code> Execute</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⍎&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p><code>⊣</code> Stop</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊣&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p><code>⊣</code> Left</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊣&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p><code>⊢</code> Pass</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">monadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊢&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p><code>⊢</code> Right</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">dyadic</span> <span class="nx">overloadable</span> <span class="nx">named</span> <span class="s1">&#39;⊢&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p><code>⍬</code> Zilde (niladic function)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">builtins</span><span class="p">[</span><span class="s1">&#39;get_⍬&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Note: Symbols <em>quad</em> (⎕) and <em>quote-quad</em> (⍞) are defined in a
platform-specific manner in <a href="browser.html">browser.coffee</a> (for browsers)
and <a href="command.html">command.coffee</a> (for node.js).</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <h1>Built-in operators</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Helper for / and ⌿ in their operator sense</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">reduce</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">invokedAsMonadic</span> <span class="o">=</span> <span class="o">not</span> <span class="nx">b</span><span class="o">?</span>
  <span class="k">if</span> <span class="nx">invokedAsMonadic</span> <span class="k">then</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">numericValueOf</span> <span class="nx">a</span>
  <span class="nx">isBackwards</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="k">if</span> <span class="nx">isBackwards</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">=</span> <span class="o">-</span><span class="nx">a</span>
  <span class="nx">b</span> <span class="o">=</span> <span class="nx">arrayValueOf</span> <span class="nx">b</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">n</span> <span class="o">=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">a</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">n</span>
  <span class="k">if</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
    <span class="nx">items</span> <span class="o">=</span> <span class="nx">b</span>
  <span class="k">else</span>
    <span class="nx">sItem</span> <span class="o">=</span> <span class="nx">sb</span><span class="p">[...</span><span class="nx">axis</span><span class="p">].</span><span class="nx">concat</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span> <span class="c1"># shape of an item</span>
    <span class="nx">k</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>
    <span class="nx">items</span> <span class="o">=</span> <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">n</span><span class="p">]</span> <span class="k">then</span> <span class="nx">withShape</span> <span class="nx">sItem</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">items</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span> <span class="o">/</span> <span class="nx">k</span><span class="p">)</span> <span class="o">%</span> <span class="nx">n</span><span class="p">].</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
  <span class="nx">r</span> <span class="o">=</span>
    <span class="k">if</span> <span class="nx">isBackwards</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">n</span> <span class="o">-</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span> <span class="p">(</span><span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">...</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="nx">by</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">items</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span> <span class="nx">x</span>
    <span class="k">else</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span> <span class="p">...</span> <span class="nx">n</span> <span class="o">-</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="p">(</span><span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">a</span><span class="p">]</span> <span class="nx">by</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">items</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span> <span class="nx">x</span>
  <span class="k">if</span> <span class="nx">invokedAsMonadic</span> <span class="k">then</span> <span class="nx">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Helper for / and ⌿ in their function sense</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">compressOrReplicate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">sb</span> <span class="o">=</span> <span class="nx">shapeOf</span> <span class="nx">b</span>
  <span class="k">if</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">axis</span> <span class="o">+=</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">axis</span> <span class="o">&lt;</span> <span class="nx">sb</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Axis out of bounds&#39;</span>
  <span class="nx">sr</span> <span class="o">=</span> <span class="nx">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">...]</span>
  <span class="nx">sr</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Left argument to / must be an integer or a vector of integers&#39;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]]</span> <span class="k">then</span> <span class="nx">a</span>

  <span class="nx">nNonNegative</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of non-negative elements in a</span>
  <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="s1">&#39;number&#39;</span> <span class="o">or</span> <span class="nx">x</span> <span class="o">isnt</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">x</span> <span class="k">then</span> <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Left argument to / must be an integer or a vector of integers&#39;</span>
    <span class="nx">sr</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">x</span>
    <span class="nx">nNonNegative</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

  <span class="nx">isExtensive</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nx">isExpansive</span> <span class="o">=</span> <span class="nx">isHyperexpansive</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="k">if</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">isnt</span> <span class="mi">1</span>
    <span class="nx">isExtensive</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">isExpansive</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
    <span class="nx">isHyperexpansive</span> <span class="o">=</span> <span class="o">not</span> <span class="nx">isExpansive</span>
    <span class="k">if</span> <span class="nx">isHyperexpansive</span> <span class="o">and</span> <span class="p">(</span><span class="nx">nNonNegative</span> <span class="o">isnt</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">])</span>
      <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;For A/B, the length of B along the selected axis &#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;must be equal either to one, &#39;</span> <span class="o">+</span>                 <span class="c1"># extension</span>
                  <span class="s1">&#39;or the length of A, &#39;</span> <span class="o">+</span>                          <span class="c1"># expansion</span>
                  <span class="s1">&#39;or to the number of non-negative elements in A.&#39;</span> <span class="c1"># hyperexpansion</span>
  <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">ni</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sb</span><span class="p">[...</span> <span class="nx">axis</span><span class="p">]</span>
  <span class="nx">nj</span> <span class="o">=</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span>
  <span class="nx">nk</span> <span class="o">=</span> <span class="nx">prod</span> <span class="nx">sb</span><span class="p">[</span><span class="nx">axis</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">...]</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">ni</span><span class="p">]</span>
    <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span>
      <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">x</span><span class="p">]</span>
          <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">nk</span><span class="p">]</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span> <span class="o">+</span> <span class="nx">nk</span><span class="o">*</span><span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">)]</span>
        <span class="nx">j</span> <span class="o">+=</span> <span class="nx">isExpansive</span> <span class="o">or</span> <span class="nx">isHyperexpansive</span>
      <span class="k">else</span>
        <span class="nx">filler</span> <span class="o">=</span> <span class="nx">prototypeOf</span><span class="p">(</span><span class="k">if</span> <span class="nx">isExpansive</span> <span class="k">then</span> <span class="p">[</span><span class="nx">b</span><span class="p">[</span><span class="nx">nk</span><span class="o">*</span><span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">)]]</span> <span class="k">else</span> <span class="p">[</span><span class="nx">b</span><span class="p">[</span><span class="nx">nk</span><span class="o">*</span><span class="nx">nj</span><span class="o">*</span><span class="nx">i</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="o">-</span><span class="nx">x</span><span class="o">*</span><span class="nx">nk</span><span class="p">]</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">filler</span>
        <span class="nx">j</span> <span class="o">+=</span> <span class="nx">isExpansive</span>

  <span class="nx">withShape</span> <span class="nx">sr</span><span class="p">,</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p><code>/</code> Reduce, compress, or replicate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixOperator</span> <span class="nx">named</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
    <span class="nx">reduce</span> <span class="nx">a</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span>
  <span class="k">else</span>
    <span class="nx">compressOrReplicate</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p><code>⌿</code> 1st axis reduce, compress, or replicate</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixOperator</span> <span class="nx">named</span> <span class="s1">&#39;⌿&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
    <span class="nx">reduce</span> <span class="nx">a</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">axis</span>
  <span class="k">else</span>
    <span class="nx">compressOrReplicate</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">axis</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p><code>¨</code> Each</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixOperator</span> <span class="nx">named</span> <span class="s1">&#39;¨&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">b</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">arrayValueOf</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">isSimple</span> <span class="nx">a</span> <span class="k">then</span> <span class="k">return</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">arrayValueOf</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="k">then</span> <span class="k">return</span> <span class="p">(</span><span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
  <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">return</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">x</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="k">return</span> <span class="p">(</span><span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span> <span class="k">then</span> <span class="nx">f</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Length error&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p><code>∘.</code> Outer product</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">prefixOperator</span> <span class="nx">named</span> <span class="s1">&#39;∘.&#39;</span><span class="p">,</span> <span class="nx">outerProduct</span> <span class="o">=</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">f</span> <span class="o">=</span> <span class="nx">cpsify</span> <span class="nx">f</span>
  <span class="nx">cps</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">b</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-&gt;</span> <span class="nx">callback</span> <span class="nb">Error</span> <span class="s1">&#39;Operator ∘. (Outer product) works only with dyadic functions&#39;</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="nx">arrayValueOf</span> <span class="nx">a</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">arrayValueOf</span> <span class="nx">b</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">ia</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">loopA</span> <span class="o">=</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">ia</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">ib</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nx">loopB</span> <span class="o">=</span> <span class="o">-&gt;</span>
          <span class="k">if</span> <span class="nx">ib</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span>
            <span class="o">-&gt;</span> <span class="nx">f</span> <span class="nx">a</span><span class="p">[</span><span class="nx">ia</span><span class="p">],</span> <span class="nx">b</span><span class="p">[</span><span class="nx">ib</span><span class="p">],</span> <span class="kc">null</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span>
              <span class="k">if</span> <span class="nx">err</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-&gt;</span> <span class="nx">callback</span> <span class="nx">err</span>
              <span class="nx">r</span><span class="p">.</span><span class="nx">push</span> <span class="nx">x</span>
              <span class="nx">ib</span><span class="o">++</span><span class="p">;</span> <span class="nx">loopB</span>
          <span class="k">else</span>
            <span class="nx">ia</span><span class="o">++</span><span class="p">;</span> <span class="nx">loopA</span>
      <span class="k">else</span>
        <span class="o">-&gt;</span> <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">withShape</span> <span class="p">(</span><span class="nx">shapeOf</span> <span class="nx">a</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">shapeOf</span> <span class="nx">b</span><span class="p">),</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p><code>.</code> Inner product
todo: the general formula for higher dimensions is
<code>A f.g B   &lt;=&gt;   f/¨ (⊂[⍴⍴A]A)∘.g ⊂[1]B</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">infixOperator</span> <span class="nx">named</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">g</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">F</span> <span class="o">=</span> <span class="nx">reduce</span> <span class="nx">f</span>
  <span class="nx">G</span> <span class="o">=</span> <span class="nx">outerProduct</span> <span class="nx">g</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">shapeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="k">throw</span> <span class="nb">Error</span> <span class="s1">&#39;Inner product operator (.) is implemented only for arrays of rank no more than 1.&#39;</span>
    <span class="nx">F</span> <span class="nx">g</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p><code>⍣</code> Power operator</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">postfixOperator</span> <span class="nx">named</span> <span class="s1">&#39;⍣&#39;</span><span class="p">,</span> <span class="nx">cps</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">f</span> <span class="o">isnt</span> <span class="s1">&#39;function&#39;</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-&gt;</span> <span class="nx">callback0</span> <span class="nb">Error</span> <span class="s1">&#39;Left argument to ⍣ must be a function.&#39;</span>
  <span class="nx">f</span> <span class="o">=</span> <span class="nx">cpsify</span> <span class="nx">f</span>
  <span class="o">-&gt;</span> <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">cps</span> <span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">callback1</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">n</span> <span class="o">isnt</span> <span class="s1">&#39;number&#39;</span> <span class="o">or</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">n</span> <span class="o">isnt</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">n</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-&gt;</span> <span class="nx">callback</span> <span class="nb">Error</span> <span class="s1">&#39;Right argument to ⍣ must be a non-negative integer.&#39;</span>
    <span class="o">-&gt;</span> <span class="nx">callback1</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">cps</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">callback2</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="nx">F</span> <span class="o">=</span> <span class="o">-&gt;</span>
        <span class="k">if</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span>
          <span class="nx">f</span> <span class="nx">a</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="o">-&gt;</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="k">then</span> <span class="k">return</span> <span class="o">-&gt;</span> <span class="nx">callback2</span> <span class="nx">err</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">;</span> <span class="nx">F</span>
        <span class="k">else</span>
          <span class="o">-&gt;</span> <span class="nx">callback2</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">a</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 